<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hertz - Playlists</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #181818; color: #fff; margin: 0; padding-bottom: 100px; }
    header { position: sticky; top: 0; background: #121212; padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .logo-btn { font-size: 1.7rem; font-weight: bold; color: #1db954; background: transparent; border: 2px solid #1db954; border-radius: 30px; padding: 0.4rem 1.6rem; text-decoration: none; letter-spacing: 2px; cursor: pointer; transition: background 0.2s, color 0.2s;}
    .logo-btn:hover, .logo-btn:focus { background: #1db954; color: #181818; outline: none;}
    nav { display: flex; gap: 1rem;}
    nav a { text-decoration: none; color: #fff; background: #282828; padding: 0.6rem 1.4rem; border-radius: 30px; font-weight: 500; transition: background 0.2s, color 0.2s; border: 2px solid transparent;}
    nav a:hover, nav a.active { background: #1db954; color: #181818; border-color: #1db954;}
    .mobile-menu-btn { display: none; background: none; border: 2px solid #1db954; color: #1db954; font-size: 1.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
    .mobile-menu-btn:hover { background: #1db954; color: #181818; }
    .mobile-nav { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(18, 18, 18, 0.95); z-index: 1000; padding-top: 4rem; }
    .mobile-nav.active { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
    .mobile-nav a { color: #fff; background: #282828; padding: 1rem 2rem; border-radius: 30px; font-weight: 500; text-decoration: none; font-size: 1.1rem; border: 2px solid transparent; transition: all 0.2s; }
    .mobile-nav a:hover, .mobile-nav a.active { background: #1db954; color: #181818; border-color: #1db954; }
    .mobile-nav .close-btn { position: absolute; top: 1rem; right: 2rem; background: none; border: none; color: #fff; font-size: 2rem; cursor: pointer; }
    
    .main-container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
    .page-header { margin-bottom: 2rem; }
    .page-header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; font-weight: 700; }
    .page-header p { color: #b3b3b3; font-size: 1.1rem; }
    
    .search-section { margin-bottom: 2rem; }
    .search-bar { display: flex; gap: 1rem; align-items: center; max-width: 500px; }
    .search-bar input { flex: 1; padding: 0.75rem; border-radius: 25px; border: none; background: #282828; color: #fff; font-size: 1rem; }
    .search-bar button { padding: 0.75rem 1.5rem; border-radius: 25px; background: #1db954; color: #181818; border: none; font-weight: bold; cursor: pointer; transition: background 0.2s; }
    .search-bar button:hover { background: #17a74a; }
    
    .create-section { margin-bottom: 3rem; }
    .create-playlist-btn { padding: 1rem 2rem; background: #1db954; color: #181818; border: none; border-radius: 30px; font-weight: bold; font-size: 1.1rem; cursor: pointer; transition: all 0.2s; }
    .create-playlist-btn:hover { background: #17a74a; transform: translateY(-2px); }
    
    .templates-section { margin-bottom: 3rem; }
    .section-title { font-size: 1.8rem; font-weight: bold; margin-bottom: 1.5rem; color: #fff; }
    .template-row { margin-bottom: 2.5rem; }
    .template-row h3 { font-size: 1.3rem; margin-bottom: 1rem; color: #b3b3b3; }
    .template-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1.5rem; }
    
    .template-card { 
      background: #1a1a1a; 
      padding: 1.5rem; 
      border-radius: 15px; 
      border: 2px dashed #404040;
      cursor: pointer; 
      transition: all 0.3s ease;
      position: relative;
      min-height: 280px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .template-card:hover { 
      border-color: #1db954; 
      background: #232323; 
      transform: translateY(-3px); 
      box-shadow: 0 6px 25px rgba(29, 185, 84, 0.2); 
    }
    
    .template-cover { 
      width: 140px; 
      height: 140px; 
      border-radius: 12px; 
      background: linear-gradient(135deg, #404040, #282828);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      font-size: 2.5rem;
      color: #666;
      border: 2px solid #404040;
      transition: all 0.3s ease;
    }
    .template-card:hover .template-cover { 
      border-color: #1db954; 
      color: #1db954; 
    }
    
    .template-title { 
      font-weight: bold; 
      font-size: 1.2rem; 
      margin-bottom: 0.5rem; 
      color: #fff;
    }
    .template-description { 
      color: #b3b3b3; 
      font-size: 0.9rem; 
      margin-bottom: 1rem; 
      line-height: 1.4; 
    }
    
    .template-actions { 
      display: flex; 
      gap: 0.5rem; 
      margin-top: auto;
    }
    .template-btn { 
      padding: 0.5rem 1rem; 
      border: none; 
      border-radius: 20px; 
      font-size: 0.9rem; 
      cursor: pointer; 
      transition: all 0.2s;
      font-weight: 500;
    }
    .rename-btn { 
      background: #404040; 
      color: #fff; 
    }
    .rename-btn:hover { 
      background: #505050; 
    }
    .create-btn { 
      background: #1db954; 
      color: #181818; 
    }
    .create-btn:hover { 
      background: #17a74a; 
    }
    
    .template-name-input { 
      background: #282828; 
      border: 2px solid #1db954; 
      color: #fff; 
      padding: 0.4rem; 
      border-radius: 6px; 
      font-size: 0.9rem; 
      width: 100%; 
      margin-bottom: 0.5rem;
    }
    
    .playlists-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 2rem; }
    .playlist-card { 
      background: #232526; 
      padding: 1.5rem; 
      border-radius: 15px; 
      cursor: pointer; 
      transition: all 0.3s ease;
      position: relative;
      min-height: 280px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .playlist-card:hover { background: #2a2a2a; transform: translateY(-5px); box-shadow: 0 8px 30px rgba(0,0,0,0.4); }
    
    .playlist-cover { 
      width: 140px; 
      height: 140px; 
      border-radius: 12px; 
      object-fit: cover; 
      margin-bottom: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .playlist-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 0.5rem; }
    .playlist-artist { color: #b3b3b3; font-size: 0.95rem; margin-bottom: 0.5rem; }
    .playlist-description { color: #b3b3b3; font-size: 0.85rem; margin-bottom: 0.5rem; line-height: 1.4; }
    .playlist-track-count { color: #b3b3b3; font-size: 0.9rem; font-weight: 500; }
    
    .playlist-actions { 
      position: absolute; 
      top: 15px; 
      right: 15px; 
      display: flex; 
      gap: 8px;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .playlist-card:hover .playlist-actions { opacity: 1; }
    
    .action-btn { 
      background: #1db954; 
      border: none; 
      border-radius: 50%; 
      width: 35px; 
      height: 35px; 
      cursor: pointer; 
      display: flex; 
      align-items: center; 
      justify-content: center;
      color: #181818;
      font-size: 1rem;
      transition: all 0.2s;
    }
    .action-btn:hover { background: #17a74a; transform: scale(1.1); }
    
    .cover-upload-btn { 
      position: absolute; 
      bottom: 100px; 
      right: 15px; 
      background: #1db954; 
      border: none; 
      border-radius: 50%; 
      width: 30px; 
      height: 30px; 
      cursor: pointer; 
      display: flex; 
      align-items: center; 
      justify-content: center;
      color: #181818;
      font-size: 0.9rem;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .playlist-card:hover .cover-upload-btn { opacity: 1; }
    
    .modal { 
      display: none; 
      position: fixed; 
      z-index: 2000; 
      left: 0; 
      top: 0; 
      width: 100%; 
      height: 100%; 
      background-color: rgba(0,0,0,0.8); 
    }
    .modal-content { 
      background-color: #232526; 
      margin: 5% auto; 
      padding: 2rem; 
      border-radius: 15px; 
      width: 90%; 
      max-width: 500px; 
      max-height: 80vh; 
      overflow-y: auto;
    }
    .close { 
      color: #aaa; 
      float: right; 
      font-size: 28px; 
      font-weight: bold; 
      cursor: pointer; 
    }
    .close:hover { color: #fff; }
    
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; margin-bottom: 0.5rem; color: #fff; font-weight: 500; }
    .form-group input, .form-group textarea { 
      width: 100%; 
      padding: 0.75rem; 
      border: none; 
      border-radius: 8px; 
      background: #181818; 
      color: #fff; 
      font-size: 1rem;
      box-sizing: border-box;
    }
    .form-group textarea { resize: vertical; min-height: 80px; }
    .cover-preview { 
      width: 100px; 
      height: 100px; 
      border-radius: 8px; 
      object-fit: cover; 
      margin-top: 0.5rem; 
    }
    
    .empty-state { 
      text-align: center; 
      padding: 3rem; 
      color: #b3b3b3; 
    }
    .empty-state h3 { color: #fff; margin-bottom: 1rem; }
    .empty-state p { margin-bottom: 2rem; }
    
    /* Template Playlists Styles */
    .template-playlists-section { margin-top: 3rem; }
    .section-header { margin-bottom: 2rem; }
    .section-header h2 { font-size: 2rem; margin-bottom: 0.5rem; font-weight: 700; }
    .section-header p { color: #b3b3b3; font-size: 1rem; }
    
    .template-row { margin-bottom: 3rem; }
    .template-row h3 { font-size: 1.5rem; margin-bottom: 1rem; font-weight: 600; }
    .template-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
      gap: 1.5rem; 
    }
    
    .template-card { 
      background: #1a1a1a; 
      padding: 1.2rem; 
      border-radius: 12px; 
      cursor: pointer; 
      transition: all 0.3s ease;
      position: relative;
      min-height: 240px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      border: 2px solid transparent;
    }
    .template-card:hover { 
      background: #252525; 
      transform: translateY(-3px); 
      box-shadow: 0 6px 25px rgba(0,0,0,0.3);
      border-color: #1db954;
    }
    
    .template-cover { 
      width: 120px; 
      height: 120px; 
      border-radius: 10px; 
      object-fit: cover; 
      margin-bottom: 1rem;
      box-shadow: 0 3px 15px rgba(0,0,0,0.2);
      background: linear-gradient(135deg, #1db954, #1ed760);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }
    
    .template-title { 
      font-weight: bold; 
      font-size: 1.1rem; 
      margin-bottom: 0.5rem; 
      color: #fff;
    }
    .template-description { 
      color: #b3b3b3; 
      font-size: 0.85rem; 
      margin-bottom: 1rem; 
      line-height: 1.3; 
    }
    
    .template-actions { 
      display: flex; 
      gap: 0.5rem; 
      margin-top: auto;
    }
    .template-btn { 
      padding: 0.4rem 0.8rem; 
      border: none; 
      border-radius: 20px; 
      font-size: 0.85rem; 
      font-weight: 600; 
      cursor: pointer; 
      transition: all 0.2s;
    }
    .template-btn.primary { 
      background: #1db954; 
      color: #181818; 
    }
    .template-btn.primary:hover { 
      background: #17a74a; 
      transform: scale(1.05); 
    }
    .template-btn.secondary { 
      background: #282828; 
      color: #fff; 
      border: 1px solid #404040;
    }
    .template-btn.secondary:hover { 
      background: #404040; 
    }
    
    .name-edit-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      border-radius: 12px;
      padding: 1rem;
    }
    .name-edit-overlay.active { display: flex; }
    .name-edit-overlay input {
      width: 100%;
      padding: 0.5rem;
      border: none;
      border-radius: 6px;
      background: #282828;
      color: #fff;
      font-size: 1rem;
      margin-bottom: 1rem;
      text-align: center;
    }
    .name-edit-buttons {
      display: flex;
      gap: 0.5rem;
    }
    
    @media (max-width: 768px) { 
      nav { display: none; } 
      .mobile-menu-btn { display: block; }
      header { flex-wrap: wrap; padding: 1rem; }
      .main-container { padding: 1rem; }
      .page-header h1 { font-size: 2rem; }
      .playlists-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem; }
      .playlist-card { min-height: 240px; padding: 1rem; }
      .playlist-cover { width: 100px; height: 100px; }
    }
  </style>
</head>
<body>
  <header>
    <a href="Hertz App.html" class="logo-btn" aria-label="Go to Hertz homepage">Hertz</a>
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">☰</button>
    <nav>
      <a href="Hertz App.html">Home</a>
      <a href="Online App.html">Online</a>
      <a href="Offline App.html">Offline</a>
      <a href="Playlist App.html" class="active">Playlists</a>
      <a href="Favorites App.html">Favorites</a>
      <a href="Liked App.html">Liked</a>
      <a href="Account App.html">Account</a>
      <a href="Settings App.html">Settings</a>
    </nav>
    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
      <button class="close-btn" onclick="toggleMobileMenu()">&times;</button>
      <a href="Hertz App.html">Home</a>
      <a href="Online App.html">Online</a>
      <a href="Offline App.html">Offline</a>
      <a href="Playlist App.html" class="active">Playlists</a>
      <a href="Favorites App.html">Favorites</a>
      <a href="Liked App.html">Liked</a>
      <a href="Account App.html">Account</a>
      <a href="Settings App.html">Settings</a>
    </div>
  </header>

  <div class="main-container">
    <div class="page-header">
      <h1>Your Playlists</h1>
      <p>Create and manage your personal music collections</p>
    </div>

    <div class="search-section">
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search your playlists...">
        <button onclick="searchPlaylists()">Search</button>
      </div>
    </div>

    <div class="create-section">
      <button class="create-playlist-btn" onclick="showCreateModal()">
        ✨ Create New Playlist
      </button>
    </div>

    <div class="playlists-grid" id="playlistsGrid">
      <!-- Playlists will be populated here -->
    </div>

    <!-- Default/Template Playlists Sections -->
    <div class="template-playlists-section" id="templatePlaylistsSection">
      <div class="section-header">
        <h2>Made for You</h2>
        <p>Ready-made playlists you can customize</p>
      </div>
      
      <div class="template-row">
        <h3>Quick Start Playlists</h3>
        <div class="template-grid" id="quickStartGrid">
          <!-- Quick start templates will be populated here -->
        </div>
      </div>

      <div class="template-row">
        <h3>Genre Collections</h3>
        <div class="template-grid" id="genreGrid">
          <!-- Genre templates will be populated here -->
        </div>
      </div>

      <div class="template-row">
        <h3>Mood & Activity</h3>
        <div class="template-grid" id="moodGrid">
          <!-- Mood templates will be populated here -->
        </div>
      </div>
    </div>

    <div class="empty-state" id="emptyState" style="display: none;">
      <h3>No playlists yet</h3>
      <p>Create your first playlist to get started with organizing your music</p>
      <button class="create-playlist-btn" onclick="showCreateModal()">
        Create Your First Playlist
      </button>
    </div>
  </div>

  <!-- Create/Edit Playlist Modal -->
  <div id="playlistModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="hideModal()">&times;</span>
      <h3 id="modalTitle">Create New Playlist</h3>
      <form id="playlistForm">
        <div class="form-group">
          <label for="playlistName">Playlist Name:</label>
          <input type="text" id="playlistName" required>
        </div>
        <div class="form-group">
          <label for="playlistArtist">Created by:</label>
          <input type="text" id="playlistArtist" value="You">
        </div>
        <div class="form-group">
          <label for="playlistDescription">Description:</label>
          <textarea id="playlistDescription" placeholder="Add a description..."></textarea>
        </div>
        <div class="form-group">
          <label for="playlistCover">Cover Image:</label>
          <input type="file" id="playlistCover" accept="image/*">
          <img id="coverPreview" class="cover-preview" style="display: none;">
        </div>
        <button type="submit" style="width: 100%; padding: 0.75rem; background: #1db954; color: #181818; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Save Playlist</button>
      </form>
    </div>
  </div>

  <script>
    // --- Mobile Menu Toggle ---
    function toggleMobileMenu() {
      const mobileNav = document.getElementById('mobileNav');
      mobileNav.classList.toggle('active');
    }

    // --- Global Variables ---
    let playlists = [];
    let currentEditingPlaylist = null;
    let filteredPlaylists = [];

    // --- Template Playlists Data ---
    const templatePlaylists = {
      quickStart: [
        {
          id: 'template_favorites',
          name: 'My Favorites',
          description: 'Your most loved tracks',
          icon: '❤️',
          category: 'personal'
        },
        {
          id: 'template_recent',
          name: 'Recently Played',
          description: 'Tracks you\'ve been listening to',
          icon: '🕒',
          category: 'personal'
        },
        {
          id: 'template_workout',
          name: 'Workout Mix',
          description: 'High energy tracks for exercise',
          icon: '💪',
          category: 'activity'
        },
        {
          id: 'template_chill',
          name: 'Chill Vibes',
          description: 'Relaxing music for any time',
          icon: '😌',
          category: 'mood'
        }
      ],
      genres: [
        {
          id: 'template_pop',
          name: 'Pop Hits',
          description: 'Latest and greatest pop music',
          icon: '🎵',
          category: 'genre'
        },
        {
          id: 'template_rock',
          name: 'Rock Classics',
          description: 'Timeless rock anthems',
          icon: '🎸',
          category: 'genre'
        },
        {
          id: 'template_hip_hop',
          name: 'Hip Hop',
          description: 'Best of hip hop and rap',
          icon: '🎤',
          category: 'genre'
        },
        {
          id: 'template_electronic',
          name: 'Electronic',
          description: 'Electronic and dance music',
          icon: '🎛️',
          category: 'genre'
        }
      ],
      moods: [
        {
          id: 'template_happy',
          name: 'Feel Good',
          description: 'Music to boost your mood',
          icon: '😊',
          category: 'mood'
        },
        {
          id: 'template_focus',
          name: 'Focus Flow',
          description: 'Music for concentration',
          icon: '🎯',
          category: 'activity'
        },
        {
          id: 'template_sleep',
          name: 'Sleep Sounds',
          description: 'Peaceful music for rest',
          icon: '🌙',
          category: 'mood'
        },
        {
          id: 'template_party',
          name: 'Party Mix',
          description: 'Upbeat tracks for celebrations',
          icon: '🎉',
          category: 'activity'
        }
      ]
    };

    // --- Playlist Data Structure ---
    function createPlaylist(name, artist = 'You', description = '', coverImage = null) {
      return {
        id: Date.now() + Math.random(),
        name: name,
        artist: artist,
        description: description,
        cover: coverImage || 'https://via.placeholder.com/140x140/282828/ffffff?text=♪',
        tracks: [],
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
    }

    // --- Data Management ---
    function loadPlaylists() {
      const saved = localStorage.getItem('hertzPlaylists');
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          // Migrate old string-based playlists
          playlists = parsed.map(p => {
            if (typeof p === 'string') {
              return createPlaylist(p);
            }
            return p;
          });
          savePlaylists();
        } catch (e) {
          console.error('Error loading playlists:', e);
          playlists = [];
        }
      } else {
        playlists = [];
      }
      filteredPlaylists = [...playlists];
    }

    function savePlaylists() {
      localStorage.setItem('hertzPlaylists', JSON.stringify(playlists));
    }

    // --- UI Rendering ---
    function renderPlaylists() {
      const grid = document.getElementById('playlistsGrid');
      const emptyState = document.getElementById('emptyState');
      
      if (filteredPlaylists.length === 0) {
        grid.style.display = 'none';
        emptyState.style.display = 'block';
      } else {
        grid.style.display = 'grid';
        emptyState.style.display = 'none';
        
        grid.innerHTML = filteredPlaylists.map((playlist, index) => {
          const trackCount = playlist.tracks ? playlist.tracks.length : 0;
          
          return `
            <div class="playlist-card" onclick="openPlaylist('${playlist.id}')">
              <div class="playlist-actions">
                <button class="action-btn" onclick="event.stopPropagation(); editPlaylist('${playlist.id}')" title="Edit">
                  ✏️
                </button>
                <button class="action-btn" onclick="event.stopPropagation(); deletePlaylist('${playlist.id}')" title="Delete">
                  🗑️
                </button>
              </div>
              <button class="cover-upload-btn" onclick="event.stopPropagation(); changeCover('${playlist.id}')" title="Change cover">
                📷
              </button>
              <input type="file" id="coverFile_${playlist.id}" accept="image/*" style="display: none;" onchange="handleCoverChange('${playlist.id}', this)">
              <img src="${playlist.cover}" alt="${playlist.name}" class="playlist-cover">
              <div class="playlist-title">${playlist.name}</div>
              <div class="playlist-artist">By ${playlist.artist}</div>
              <div class="playlist-description">${playlist.description || 'No description'}</div>
              <div class="playlist-track-count">${trackCount} track${trackCount !== 1 ? 's' : ''}</div>
            </div>
          `;
        }).join('');
      }
      
      // Render template playlists
      renderTemplatePlaylists();
    }

    function renderTemplatePlaylists() {
      renderTemplateGrid('quickStartGrid', templatePlaylists.quickStart);
      renderTemplateGrid('genreGrid', templatePlaylists.genres);
      renderTemplateGrid('moodGrid', templatePlaylists.moods);
    }

    function renderTemplateGrid(gridId, templates) {
      const grid = document.getElementById(gridId);
      if (!grid) return;
      
      grid.innerHTML = templates.map(template => `
        <div class="template-card" id="template_${template.id}">
          <div class="template-cover">
            ${template.icon}
          </div>
          <div class="template-title" id="title_${template.id}">${template.name}</div>
          <div class="template-description">${template.description}</div>
          <div class="template-actions">
            <button class="template-btn primary" onclick="createFromTemplate('${template.id}')">
              Create
            </button>
            <button class="template-btn secondary" onclick="editTemplateName('${template.id}')">
              Rename
            </button>
          </div>
          <div class="name-edit-overlay" id="overlay_${template.id}">
            <input type="text" id="input_${template.id}" value="${template.name}" placeholder="Enter playlist name">
            <div class="name-edit-buttons">
              <button class="template-btn primary" onclick="saveTemplateName('${template.id}')">Save</button>
              <button class="template-btn secondary" onclick="cancelEditName('${template.id}')">Cancel</button>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    // --- Modal Management ---
    function showCreateModal() {
      currentEditingPlaylist = null;
      document.getElementById('modalTitle').textContent = 'Create New Playlist';
      document.getElementById('playlistForm').reset();
      document.getElementById('playlistArtist').value = 'You';
      document.getElementById('coverPreview').style.display = 'none';
      document.getElementById('playlistModal').style.display = 'block';
    }

    function showEditModal(playlist) {
      currentEditingPlaylist = playlist;
      document.getElementById('modalTitle').textContent = 'Edit Playlist';
      document.getElementById('playlistName').value = playlist.name;
      document.getElementById('playlistArtist').value = playlist.artist;
      document.getElementById('playlistDescription').value = playlist.description || '';
      
      const preview = document.getElementById('coverPreview');
      if (playlist.cover && playlist.cover !== 'https://via.placeholder.com/140x140/282828/ffffff?text=♪') {
        preview.src = playlist.cover;
        preview.style.display = 'block';
      } else {
        preview.style.display = 'none';
      }
      
      document.getElementById('playlistModal').style.display = 'block';
    }

    function hideModal() {
      document.getElementById('playlistModal').style.display = 'none';
      currentEditingPlaylist = null;
    }

    // --- Event Handlers ---
    function editPlaylist(playlistId) {
      const playlist = playlists.find(p => p.id === playlistId);
      if (playlist) {
        showEditModal(playlist);
      }
    }

    function deletePlaylist(playlistId) {
      if (confirm('Are you sure you want to delete this playlist? This action cannot be undone.')) {
        playlists = playlists.filter(p => p.id !== playlistId);
        savePlaylists();
        applyCurrentSearch();
        renderPlaylists();
      }
    }

    function changeCover(playlistId) {
      document.getElementById(`coverFile_${playlistId}`).click();
    }

    function handleCoverChange(playlistId, input) {
      const file = input.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const playlist = playlists.find(p => p.id === playlistId);
          if (playlist) {
            playlist.cover = e.target.result;
            playlist.updatedAt = new Date().toISOString();
            savePlaylists();
            applyCurrentSearch();
            renderPlaylists();
          }
        };
        reader.readAsDataURL(file);
      }
    }

    function openPlaylist(playlistId) {
      const playlist = playlists.find(p => p.id === playlistId);
      if (playlist) {
        // Store playlist in sessionStorage and navigate to playlist view
        sessionStorage.setItem('currentPlaylist', JSON.stringify(playlist));
        window.location.href = 'playlist-view.html';
      }
    }

    // --- Search Functionality ---
    function searchPlaylists() {
      const query = document.getElementById('searchInput').value.toLowerCase().trim();
      applySearch(query);
    }

    function applySearch(query = '') {
      if (!query) {
        filteredPlaylists = [...playlists];
      } else {
        filteredPlaylists = playlists.filter(playlist => 
          playlist.name.toLowerCase().includes(query) ||
          playlist.artist.toLowerCase().includes(query) ||
          (playlist.description && playlist.description.toLowerCase().includes(query))
        );
      }
      renderPlaylists();
    }

    function applyCurrentSearch() {
      const query = document.getElementById('searchInput').value.toLowerCase().trim();
      applySearch(query);
    }

    // --- Template Playlist Functions ---
    function createFromTemplate(templateId) {
      const template = findTemplateById(templateId);
      if (!template) return;
      
      const newPlaylist = createPlaylist(
        template.name,
        'You',
        template.description,
        generateCoverForTemplate(template)
      );
      
      // Add some sample tracks based on template category
      newPlaylist.tracks = generateSampleTracks(template.category);
      
      playlists.push(newPlaylist);
      savePlaylists();
      applyCurrentSearch();
      renderPlaylists();
      
      // Show success message
      showNotification(`Created playlist "${template.name}"!`);
    }

    function editTemplateName(templateId) {
      const overlay = document.getElementById(`overlay_${templateId}`);
      const input = document.getElementById(`input_${templateId}`);
      
      overlay.classList.add('active');
      input.focus();
      input.select();
    }

    function saveTemplateName(templateId) {
      const input = document.getElementById(`input_${templateId}`);
      const titleEl = document.getElementById(`title_${templateId}`);
      const newName = input.value.trim();
      
      if (newName) {
        // Update the template name
        const template = findTemplateById(templateId);
        if (template) {
          template.name = newName;
          titleEl.textContent = newName;
        }
      }
      
      cancelEditName(templateId);
    }

    function cancelEditName(templateId) {
      const overlay = document.getElementById(`overlay_${templateId}`);
      const input = document.getElementById(`input_${templateId}`);
      const template = findTemplateById(templateId);
      
      if (template) {
        input.value = template.name; // Reset to original name
      }
      
      overlay.classList.remove('active');
    }

    function findTemplateById(templateId) {
      const allTemplates = [
        ...templatePlaylists.quickStart,
        ...templatePlaylists.genres,
        ...templatePlaylists.moods
      ];
      return allTemplates.find(t => t.id === templateId);
    }

    function generateCoverForTemplate(template) {
      // Generate a gradient cover based on category
      const gradients = {
        personal: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        activity: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
        mood: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
        genre: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
      };
      
      const gradient = gradients[template.category] || gradients.personal;
      
      // Create a canvas to generate the cover image
      const canvas = document.createElement('canvas');
      canvas.width = 140;
      canvas.height = 140;
      const ctx = canvas.getContext('2d');
      
      // Create gradient
      const grd = ctx.createLinearGradient(0, 0, 140, 140);
      grd.addColorStop(0, template.category === 'personal' ? '#667eea' : 
                          template.category === 'activity' ? '#f093fb' :
                          template.category === 'mood' ? '#4facfe' : '#43e97b');
      grd.addColorStop(1, template.category === 'personal' ? '#764ba2' : 
                          template.category === 'activity' ? '#f5576c' :
                          template.category === 'mood' ? '#00f2fe' : '#38f9d7');
      
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, 140, 140);
      
      // Add icon
      ctx.font = '48px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = 'white';
      ctx.fillText(template.icon, 70, 70);
      
      return canvas.toDataURL();
    }

    function generateSampleTracks(category) {
      const sampleTracks = {
        personal: [
          { id: Date.now() + 1, name: 'Your Song 1', artist: 'Artist 1', cover: null, audioUrl: null, duration: '3:42' },
          { id: Date.now() + 2, name: 'Your Song 2', artist: 'Artist 2', cover: null, audioUrl: null, duration: '4:15' }
        ],
        activity: [
          { id: Date.now() + 3, name: 'High Energy Track', artist: 'Energetic Artist', cover: null, audioUrl: null, duration: '3:28' },
          { id: Date.now() + 4, name: 'Pump It Up', artist: 'Motivation Squad', cover: null, audioUrl: null, duration: '4:02' }
        ],
        mood: [
          { id: Date.now() + 5, name: 'Peaceful Melody', artist: 'Calm Artist', cover: null, audioUrl: null, duration: '5:21' },
          { id: Date.now() + 6, name: 'Relaxing Tune', artist: 'Zen Master', cover: null, audioUrl: null, duration: '4:45' }
        ],
        genre: [
          { id: Date.now() + 7, name: 'Genre Hit 1', artist: 'Popular Artist', cover: null, audioUrl: null, duration: '3:35' },
          { id: Date.now() + 8, name: 'Genre Hit 2', artist: 'Chart Topper', cover: null, audioUrl: null, duration: '3:58' }
        ]
      };
      
      return sampleTracks[category] || sampleTracks.personal;
    }

    function showNotification(message) {
      // Create a simple notification
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #1db954;
        color: #181818;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        font-weight: bold;
        z-index: 3000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        transform: translateX(100%);
        transition: transform 0.3s ease;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      // Show notification
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      // Hide and remove notification after 3 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // --- Form Handling ---
    document.getElementById('playlistForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const name = document.getElementById('playlistName').value;
      const artist = document.getElementById('playlistArtist').value;
      const description = document.getElementById('playlistDescription').value;
      const coverFile = document.getElementById('playlistCover').files[0];
      
      function savePlaylist(coverImage) {
        if (currentEditingPlaylist) {
          // Edit existing playlist
          const playlist = playlists.find(p => p.id === currentEditingPlaylist.id);
          if (playlist) {
            playlist.name = name;
            playlist.artist = artist;
            playlist.description = description;
            if (coverImage) playlist.cover = coverImage;
            playlist.updatedAt = new Date().toISOString();
            showNotification(`Updated playlist "${name}"!`);
          }
        } else {
          // Create new playlist
          const newPlaylist = createPlaylist(name, artist, description, coverImage);
          playlists.push(newPlaylist);
          showNotification(`Created playlist "${name}"!`);
        }
        
        savePlaylists();
        applyCurrentSearch();
        renderPlaylists();
        hideModal();
      }
      
      if (coverFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
          savePlaylist(e.target.result);
        };
        reader.readAsDataURL(coverFile);
      } else {
        savePlaylist(null);
      }
    });

    // --- Cover Preview ---
    document.getElementById('playlistCover').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const preview = document.getElementById('coverPreview');
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        preview.style.display = 'none';
      }
    });

    // --- Search Input Handler ---
    document.getElementById('searchInput').addEventListener('input', function(e) {
      const query = e.target.value.toLowerCase().trim();
      applySearch(query);
    });

    // --- Modal Click Outside to Close ---
    document.getElementById('playlistModal').addEventListener('click', function(e) {
      if (e.target === this) {
        hideModal();
      }
    });

    // --- Escape Key to Close Modal ---
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        hideModal();
      }
    });

    // --- Make Functions Global ---
    window.toggleMobileMenu = toggleMobileMenu;
    window.showCreateModal = showCreateModal;
    window.hideModal = hideModal;
    window.editPlaylist = editPlaylist;
    window.deletePlaylist = deletePlaylist;
    window.changeCover = changeCover;
    window.handleCoverChange = handleCoverChange;
    window.openPlaylist = openPlaylist;
    window.searchPlaylists = searchPlaylists;
    window.createFromTemplate = createFromTemplate;
    window.editTemplateName = editTemplateName;
    window.saveTemplateName = saveTemplateName;
    window.cancelEditName = cancelEditName;

    // --- Initialize ---
    document.addEventListener('DOMContentLoaded', function() {
      loadPlaylists();
      renderPlaylists();
    });
  </script>
</body>
</html>