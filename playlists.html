<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hertz - Playlists</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #181818; color: #fff; margin: 0; }
    header { position: sticky; top: 0; background: #121212; padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .logo-btn { font-size: 1.7rem; font-weight: bold; color: #1db954; background: transparent; border: 2px solid #1db954; border-radius: 30px; padding: 0.4rem 1.6rem; text-decoration: none; letter-spacing: 2px; cursor: pointer; transition: background 0.2s, color 0.2s;}
    .logo-btn:hover, .logo-btn:focus { background: #1db954; color: #181818; outline: none;}
    nav { display: flex; gap: 1rem;}
    nav a { text-decoration: none; color: #fff; background: #282828; padding: 0.6rem 1.4rem; border-radius: 30px; font-weight: 500; transition: background 0.2s, color 0.2s; border: 2px solid transparent;}
    nav a:hover, nav a.active { background: #1db954; color: #181818; border-color: #1db954;}
    .mobile-menu-btn { display: none; background: none; border: 2px solid #1db954; color: #1db954; font-size: 1.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
    .mobile-menu-btn:hover { background: #1db954; color: #181818; }
    .mobile-nav { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(18, 18, 18, 0.95); z-index: 1000; padding-top: 4rem; }
    .mobile-nav.active { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
    .mobile-nav a { color: #fff; background: #282828; padding: 1rem 2rem; border-radius: 30px; font-weight: 500; text-decoration: none; font-size: 1.1rem; border: 2px solid transparent; transition: all 0.2s; }
    .mobile-nav a:hover, .mobile-nav a.active { background: #1db954; color: #181818; border-color: #1db954; }
    .mobile-nav .close-btn { position: absolute; top: 1rem; right: 2rem; background: none; border: none; color: #fff; font-size: 2rem; cursor: pointer; }
    .feature-container { max-width: 600px; margin: 3rem auto; background: #232526; padding: 2rem; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);}
    h2 { margin-bottom: 1.5rem; }
    .playlist-form { margin-bottom: 2rem; }
    input[type="text"] { padding: 0.5rem; border-radius: 8px; border: none; width: 70%; }
    button { padding: 0.5rem 1.2rem; border-radius: 30px; background: #1db954; color: #181818; font-weight: bold; border: none; cursor: pointer; margin-left: 1rem;}
    button:hover { background: #17a74a; color: #fff;}
    .playlist-list { margin-top: 1rem; }
    .playlist-item { margin-bottom: 1rem; background: #181818; padding: 1rem; border-radius: 10px;}
    .playlist-title { font-weight: bold; }
    @media (max-width: 768px) { 
      nav { display: none; } 
      .mobile-menu-btn { display: block; }
      header { flex-wrap: wrap; padding: 1rem; }
      .feature-container { margin: 1rem; padding: 1.5rem; }
      .search-bar { order: 3; width: 100%; margin-top: 1rem; margin-left: 0 !important; }
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="logo-btn" aria-label="Go to Hertz homepage">Hertz</a>
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">â˜°</button>
    <nav style="display:flex;align-items:center;gap:1rem;">
      <a href="index.html">Home</a>
      <a href="online.html">Online</a>
      <a href="offline.html">Offline</a>
      <a href="playlists.html" class="active">Playlists</a>
      <a href="favorites.html">Favorites</a>
      <a href="liked.html" id="likedNavBtn">Liked</a>
      <a href="Account.html">Account</a>
      <a href="settings.html">Settings</a>
      <!-- Search bar aligned with Settings button -->
      <div class="search-bar" style="display:flex;align-items:center;gap:1rem;margin-left:0.5rem;height:100%;">
        <input type="text" id="playlistSearchInput" placeholder="Search your playlists..." style="flex:1; padding:0.7rem; border-radius:20px; border:none; font-size:1rem; width:180px;">
        <button id="playlistSearchBtn" style="padding:0.7rem 1.5rem; border-radius:20px; border:none; background:#1db954; color:#181818; font-weight:bold; cursor:pointer; transition:background 0.2s;">Search</button>
      </div>
    </nav>
    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
      <button class="close-btn" onclick="toggleMobileMenu()">&times;</button>
      <a href="index.html">Home</a>
      <a href="online.html">Online</a>
      <a href="offline.html">Offline</a>
      <a href="playlists.html" class="active">Playlists</a>
      <a href="favorites.html">Favorites</a>
      <a href="liked.html">Liked</a>
      <a href="Account.html">Account</a>
      <a href="settings.html">Settings</a>
    </div>
  </header>
  <div class="feature-container">
    <h2>Your Playlists</h2>
    <form class="playlist-form" id="playlistForm">
      <input type="text" id="playlistName" placeholder="New playlist name" required>
      <button type="submit">Add Playlist</button>
    </form>
    <div class="playlist-list" id="playlistList"></div>
    <!-- Injected track rows will appear here -->
    <div id="trackRowsContainer"></div>
  </div>
  <script>
    // --- Mobile Menu Toggle ---
    function toggleMobileMenu() {
      const mobileNav = document.getElementById('mobileNav');
      mobileNav.classList.toggle('active');
    }

    // --- Playlists logic (existing) ---
    const playlistForm = document.getElementById('playlistForm');
    const playlistName = document.getElementById('playlistName');
    const playlistList = document.getElementById('playlistList');
    function renderPlaylists() {
      const playlists = JSON.parse(localStorage.getItem('hertzPlaylists')) || [];
      playlistList.innerHTML = '';
      playlists.forEach((pl, i) => {
        const div = document.createElement('div');
        div.className = 'playlist-item';
        div.innerHTML = `<span class="playlist-title">${pl}</span>
          <button onclick="removePlaylist(${i})" style="float:right;">Delete</button>`;
        playlistList.appendChild(div);
      });
    }
    function removePlaylist(i) {
      const playlists = JSON.parse(localStorage.getItem('hertzPlaylists')) || [];
      playlists.splice(i, 1);
      localStorage.setItem('hertzPlaylists', JSON.stringify(playlists));
      renderPlaylists();
    }
    window.removePlaylist = removePlaylist;
    playlistForm.onsubmit = function(e) {
      e.preventDefault();
      const playlists = JSON.parse(localStorage.getItem('hertzPlaylists')) || [];
      playlists.push(playlistName.value);
      localStorage.setItem('hertzPlaylists', JSON.stringify(playlists));
      playlistName.value = '';
      renderPlaylists();
    };
    renderPlaylists();

    // --- Track Rows Logic (from index.html, adapted) ---
    const mostPopularTracks = Array.from({length:25}, (_,i)=>({
      name: `Popular Track ${i+1}`,
      artist: `Artist ${i+1}`,
      cover: `https://placehold.co/100x100/1db954/fff?text=P${i+1}`,
      id: `popular_${i+1}`
    }));
    const recommendedTracks = Array.from({length:25}, (_,i)=>({
      name: `Recommended Track ${i+1}`,
      artist: `Artist ${i+26}`,
      cover: `https://placehold.co/100x100/1db954/fff?text=R${i+1}`,
      id: `recommended_${i+1}`
    }));
    const trendingTracks = Array.from({length:25}, (_,i)=>({
      name: `Trending Track ${i+1}`,
      artist: `Artist ${i+51}`,
      cover: `https://placehold.co/100x100/1db954/fff?text=T${i+1}`,
      id: `trending_${i+1}`
    }));

    function saveCustomTrackMeta(trackId, meta) {
      let metas = JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}');
      metas[trackId] = { ...(metas[trackId] || {}), ...meta };
      localStorage.setItem('hertzCustomTrackMeta', JSON.stringify(metas));
    }
    function getCustomTrackMeta(trackId) {
      let metas = JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}');
      return metas[trackId] || {};
    }

    function createTrackRow(title, tracks, rowId) {
      const row = document.createElement('div');
      row.className = 'track-row';
      row.style.margin = '2.5rem 0 1.5rem 0';
      row.innerHTML = `<div style="font-size:1.3rem;font-weight:600;margin-bottom:1rem;">${title}</div>
        <div class="track-row-list" id="${rowId}" style="display:flex;overflow-x:auto;gap:1.2rem;padding-bottom:0.5rem;">
          ${tracks.map(track => {
            const meta = getCustomTrackMeta(track.id);
            const customCover = meta.cover || track.cover;
            const customName = meta.name || track.name;
            const customArtist = meta.artist || track.artist;
            const hasMp3 = !!meta.mp3;
            return `
              <div class="track-card" style="background:#232526;border-radius:14px;min-width:170px;max-width:170px;box-shadow:0 2px 8px rgba(0,0,0,0.10);padding:1rem;display:flex;flex-direction:column;align-items:center;position:relative;">
                <div style="display:flex;align-items:center;width:100%;justify-content:center;margin-bottom:0.5rem;">
                  <input type="file" accept="audio/mp3,audio/mpeg" id="mp3file_${track.id}" style="display:none">
                  <button title="Browse for mp3" class="mp3-btn" data-trackid="${track.id}" style="background:#1db954;border:none;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;padding:0;margin-right:7px;">
                    <span style="font-size:1.1em;color:#181818;">&#128190;</span>
                  </button>
                  <img id="cover_${track.id}" src="${customCover}" alt="${customName} cover" style="width:100px;height:100px;border-radius:8px;object-fit:cover;">
                  <input type="file" accept="image/*" id="file_${track.id}" style="display:none">
                  <button title="Change cover" class="cover-btn" data-trackid="${track.id}" style="position:absolute;top:6px;right:6px;background:#1db954;border:none;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;padding:0;">
                    <span style="font-size:1.1em;color:#181818;">&#128247;</span>
                  </button>
                </div>
                <div style="font-weight:600;font-size:1.05rem;text-align:center;margin-bottom:0.3rem;">
                  <span id="name_${track.id}" style="cursor:pointer;">${customName}</span>
                  <input type="text" id="input_name_${track.id}" value="${customName}" style="display:none;width:90%;margin-top:2px;border-radius:6px;border:none;padding:2px 6px;">
                  <button title="Edit name" class="edit-name-btn" data-trackid="${track.id}" style="background:none;border:none;cursor:pointer;padding:0 0 0 4px;color:#1db954;font-size:1em;">&#9998;</button>
                </div>
                <div style="color:#b3b3b3;font-size:0.97rem;text-align:center;">
                  <span id="artist_${track.id}" style="cursor:pointer;">${customArtist}</span>
                  <input type="text" id="input_artist_${track.id}" value="${customArtist}" style="display:none;width:90%;margin-top:2px;border-radius:6px;border:none;padding:2px 6px;">
                  <button title="Edit artist" class="edit-artist-btn" data-trackid="${track.id}" style="background:none;border:none;cursor:pointer;padding:0 0 0 4px;color:#1db954;font-size:1em;">&#9998;</button>
                </div>
                <div style="margin-top:0.5rem;">
                  <button class="play-mp3-btn" data-trackid="${track.id}" style="background:#282828;border:none;border-radius:20px;padding:0.2rem 1.1rem;font-size:0.97rem;cursor:pointer;color:${hasMp3 ? '#1db954' : '#b3b3b3'};font-weight:600;">
                    ${hasMp3 ? 'Play' : 'No MP3'}
                  </button>
                </div>
              </div>
            `;
          }).join('')}
        </div>`;
      return row;
    }

    // --- Sticky Player Logic (identical to offline.html, fully functional) ---
    let allTracks = [];
    let currentIndex = 0;
    let isPlaying = false;
    let isLoop = false;
    let isShuffle = false;

    // Sticky player elements will be created if not present
    function ensureStickyPlayer() {
      if (document.getElementById('stickyPlayer')) return;
      const playerDiv = document.createElement('div');
      playerDiv.className = 'sticky-player';
      playerDiv.id = 'stickyPlayer';
      playerDiv.style.display = 'none';
      playerDiv.style.flexDirection = 'column';
      playerDiv.innerHTML = `
        <div style="display:flex;align-items:center;width:100%;">
          <div class="player-controls">
            <button class="player-btn" id="prevBtn" title="Previous">&#9198;</button>
            <button class="player-btn" id="playPauseBtn" title="Play/Pause">&#9654;</button>
            <button class="player-btn" id="nextBtn" title="Next">&#9197;</button>
            <button class="player-btn player-loop" id="loopBtn" title="Loop">&#128257;</button>
            <button class="player-btn player-shuffle" id="shuffleBtn" title="Shuffle">&#128256;</button>
            <label for="volumeRange" style="margin-left:1rem;color:#b3b3b3;font-size:0.95em;">Volume</label>
            <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="0.7" style="width:100px;">
          </div>
          <span class="player-title" id="playerTrackTitle"></span>
          <div style="display:flex;align-items:center;gap:0.7rem;width:320px;max-width:90%;">
            <span id="currentTime" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
            <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1" style="flex:1;">
            <span id="duration" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
          </div>
          <button id="likeBtn" title="Like" style="margin-left:1.5rem;background:none;border:none;cursor:pointer;font-size:1.7rem;color:#b3b3b3;transition:color 0.2s;">&#10084;</button>
        </div>
        <audio id="playerAudio" class="player-audio"></audio>
      `;
      document.body.appendChild(playerDiv);
    }
    ensureStickyPlayer();

    const stickyPlayer = document.getElementById('stickyPlayer');
    const playerAudio = document.getElementById('playerAudio');
    const playerTrackTitle = document.getElementById('playerTrackTitle');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const loopBtn = document.getElementById('loopBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const volumeRange = document.getElementById('volumeRange');
    const progressBar = document.getElementById('progressBar');
    const currentTimeSpan = document.getElementById('currentTime');
    const durationSpan = document.getElementById('duration');

    function savePlayerState() {
      if (!allTracks[currentIndex]) return;
      sessionStorage.setItem('hertzPlayerTrack', JSON.stringify({
        name: allTracks[currentIndex].name,
        id: allTracks[currentIndex].id,
        url: allTracks[currentIndex].url || null
      }));
      sessionStorage.setItem('hertzPlayerTime', playerAudio.currentTime || 0);
      sessionStorage.setItem('hertzPlayerIsPlaying', isPlaying);
    }

    function restorePlayerState() {
      const data = sessionStorage.getItem('hertzPlayerTrack');
      if (!data) return;
      const track = JSON.parse(data);
      const idx = allTracks.findIndex(t => t.id === track.id);
      if (idx !== -1 && allTracks[idx].url) {
        loadTrack(idx, false);
        playerAudio.currentTime = parseFloat(sessionStorage.getItem('hertzPlayerTime') || 0);
        if (sessionStorage.getItem('hertzPlayerIsPlaying') === 'true') {
          playPause();
        }
      }
    }

    function loadTrack(idx, autoplay = true) {
      if (!allTracks[idx] || !allTracks[idx].url) return;
      stickyPlayer.style.display = 'flex';
      playerAudio.src = allTracks[idx].url;
      playerTrackTitle.textContent = allTracks[idx].name;
      currentIndex = idx;
      playPauseBtn.innerHTML = '&#9654;';
      isPlaying = false;
      progressBar.value = 0;
      currentTimeSpan.textContent = "0:00";
      durationSpan.textContent = "0:00";
      if (autoplay) playPause();
      savePlayerState();
    }
    function playPause() {
      if (!allTracks[currentIndex] || !allTracks[currentIndex].url) return;
      if (isPlaying) {
        playerAudio.pause();
        playPauseBtn.innerHTML = '&#9654;';
        isPlaying = false;
      } else {
        playerAudio.play();
        playPauseBtn.innerHTML = '&#10073;&#10073;';
        isPlaying = true;
      }
      savePlayerState();
    }
    function playNext() {
      if (isShuffle) {
        currentIndex = Math.floor(Math.random() * allTracks.length);
      } else {
        currentIndex = (currentIndex + 1) % allTracks.length;
      }
      loadTrack(currentIndex);
    }
    function playPrev() {
      if (isShuffle) {
        currentIndex = Math.floor(Math.random() * allTracks.length);
      } else {
        currentIndex = (currentIndex - 1 + allTracks.length) % allTracks.length;
      }
      loadTrack(currentIndex);
    }
    function toggleLoop() {
      isLoop = !isLoop;
      playerAudio.loop = isLoop;
      loopBtn.classList.toggle('active', isLoop);
    }
    function toggleShuffle() {
      isShuffle = !isShuffle;
      shuffleBtn.classList.toggle('active', isShuffle);
    }
    playerAudio.addEventListener('timeupdate', function() {
      if (!playerAudio.duration) return;
      progressBar.value = (playerAudio.currentTime / playerAudio.duration) * 100;
      currentTimeSpan.textContent = formatTime(playerAudio.currentTime);
      durationSpan.textContent = formatTime(playerAudio.duration);
      savePlayerState();
    });
    progressBar.addEventListener('input', function() {
      if (!playerAudio.duration) return;
      playerAudio.currentTime = (progressBar.value / 100) * playerAudio.duration;
      savePlayerState();
    });
    volumeRange.addEventListener('input', function() {
      playerAudio.volume = volumeRange.value;
    });
    playPauseBtn.addEventListener('click', playPause);
    prevBtn.addEventListener('click', playPrev);
    nextBtn.addEventListener('click', playNext);
    loopBtn.addEventListener('click', toggleLoop);
    shuffleBtn.addEventListener('click', toggleShuffle);
    playerAudio.addEventListener('ended', function() {
      if (isLoop) {
        playerAudio.currentTime = 0;
        playerAudio.play();
      } else {
        playNext();
      }
    });
    function formatTime(sec) {
      sec = Math.floor(sec);
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return m + ':' + (s < 10 ? '0' : '') + s;
    }

    function updateAllTracksFromRows() {
      allTracks = [];
      [
        ...mostPopularTracks,
        ...recommendedTracks,
        ...trendingTracks
      ].forEach(track => {
        const meta = getCustomTrackMeta(track.id);
        if (meta.mp3) {
          allTracks.push({
            name: (meta.name || track.name) + " - " + (meta.artist || track.artist),
            id: track.id,
            url: meta.mp3
          });
        }
      });
    }

    window.addEventListener('DOMContentLoaded', function() {
      // Inject track rows
      const container = document.getElementById('trackRowsContainer');
      if (container) {
        const rows = [
          createTrackRow('Most Popular', mostPopularTracks, 'mostPopularRow'),
          createTrackRow('Recommended', recommendedTracks, 'recommendedRow'),
          createTrackRow('Trending', trendingTracks, 'trendingRow')
        ];
        rows.forEach(row => container.appendChild(row));
      }

      // Cover image upload, mp3 upload, edit, play logic
      [
        ...mostPopularTracks,
        ...recommendedTracks,
        ...trendingTracks
      ].forEach(track => {
        // Cover
        const fileInput = document.getElementById('file_' + track.id);
        if (fileInput) {
          fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(ev) {
              const dataUrl = ev.target.result;
              saveCustomTrackMeta(track.id, { cover: dataUrl });
              const img = document.getElementById('cover_' + track.id);
              if (img) img.src = dataUrl;
            };
            reader.readAsDataURL(file);
          });
        }
        // MP3
        const mp3Input = document.getElementById('mp3file_' + track.id);
        if (mp3Input) {
          mp3Input.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(ev) {
              const dataUrl = ev.target.result;
              saveCustomTrackMeta(track.id, { mp3: dataUrl });
              // Update play button
              const playBtn = document.querySelector(`.play-mp3-btn[data-trackid="${track.id}"]`);
              if (playBtn) {
                playBtn.textContent = 'Play';
                playBtn.style.color = '#1db954';
              }
              updateAllTracksFromRows();
            };
            reader.readAsDataURL(file);
          });
        }
      });

      // Cover button
      document.querySelectorAll('.cover-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const trackId = btn.getAttribute('data-trackid');
          document.getElementById('file_' + trackId).click();
        });
      });
      // MP3 button
      document.querySelectorAll('.mp3-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const trackId = btn.getAttribute('data-trackid');
          document.getElementById('mp3file_' + trackId).click();
        });
      });

      // Edit name/artist
      document.querySelectorAll('.edit-name-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const trackId = btn.getAttribute('data-trackid');
          document.getElementById('name_' + trackId).style.display = 'none';
          document.getElementById('input_name_' + trackId).style.display = 'inline-block';
          document.getElementById('input_name_' + trackId).focus();
        });
      });
      document.querySelectorAll('.edit-artist-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const trackId = btn.getAttribute('data-trackid');
          document.getElementById('artist_' + trackId).style.display = 'none';
          document.getElementById('input_artist_' + trackId).style.display = 'inline-block';
          document.getElementById('input_artist_' + trackId).focus();
        });
      });

      [
        ...mostPopularTracks,
        ...recommendedTracks,
        ...trendingTracks
      ].forEach(track => {
        // Name
        const nameInput = document.getElementById('input_name_' + track.id);
        const nameSpan = document.getElementById('name_' + track.id);
        if (nameInput && nameSpan) {
          nameInput.addEventListener('blur', function() {
            nameSpan.textContent = nameInput.value;
            nameSpan.style.display = 'inline';
            nameInput.style.display = 'none';
            saveCustomTrackMeta(track.id, { name: nameInput.value });
            updateAllTracksFromRows();
          });
          nameInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') nameInput.blur();
          });
          nameSpan.addEventListener('click', function() {
            nameSpan.style.display = 'none';
            nameInput.style.display = 'inline-block';
            nameInput.focus();
          });
        }
        // Artist
        const artistInput = document.getElementById('input_artist_' + track.id);
        const artistSpan = document.getElementById('artist_' + track.id);
        if (artistInput && artistSpan) {
          artistInput.addEventListener('blur', function() {
            artistSpan.textContent = artistInput.value;
            artistSpan.style.display = 'inline';
            artistInput.style.display = 'none';
            saveCustomTrackMeta(track.id, { artist: artistInput.value });
            updateAllTracksFromRows();
          });
          artistInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') artistInput.blur();
          });
          artistSpan.addEventListener('click', function() {
            artistSpan.style.display = 'none';
            artistInput.style.display = 'inline-block';
            artistInput.focus();
          });
        }
        // Play mp3
        const playBtn = document.querySelector(`.play-mp3-btn[data-trackid="${track.id}"]`);
        if (playBtn) {
          playBtn.addEventListener('click', function() {
            updateAllTracksFromRows();
            const idx = allTracks.findIndex(t => t.id === track.id);
            if (idx !== -1) {
              loadTrack(idx, true);
            }
          });
        }
      });

      // Initial tracks and player state
      updateAllTracksFromRows();
      restorePlayerState();
    });

    // Playlist search logic
    const playlistSearchInput = document.getElementById('playlistSearchInput');
    const playlistSearchBtn = document.getElementById('playlistSearchBtn');
    playlistSearchBtn.onclick = searchPlaylists;
    playlistSearchInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') searchPlaylists();
    });

    function searchPlaylists() {
      const query = playlistSearchInput.value.trim().toLowerCase();
      const playlists = JSON.parse(localStorage.getItem('hertzPlaylists')) || [];
      playlistList.innerHTML = '';
      playlists.forEach((pl, i) => {
        if (!query || pl.toLowerCase().includes(query)) {
          const div = document.createElement('div');
          div.className = 'playlist-item';
          div.innerHTML = `<span class="playlist-title">${pl}</span>
            <button onclick="removePlaylist(${i})" style="float:right;">Delete</button>`;
          playlistList.appendChild(div);
        }
      });
    }

    // Update renderPlaylists to use search if a query is present
    function renderPlaylists() {
      if (playlistSearchInput && playlistSearchInput.value.trim()) {
        searchPlaylists();
        return;
      }
      const playlists = JSON.parse(localStorage.getItem('hertzPlaylists')) || [];
      playlistList.innerHTML = '';
      playlists.forEach((pl, i) => {
        const div = document.createElement('div');
        div.className = 'playlist-item';
        div.innerHTML = `<span class="playlist-title">${pl}</span>
          <button onclick="removePlaylist(${i})" style="float:right;">Delete</button>`;
        playlistList.appendChild(div);
      });
    }
  </script>
</body>
</html>