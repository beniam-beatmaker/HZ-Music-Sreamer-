<!DOCTYPE html>
<html lang="en">
<head>
<title>HZ Music Streamer - Ethical Artist-First Streaming</title>
<meta name="description" content="Listen to all Bangers here! HZ Music Streamer is a globally inclusive, artist-first platform offering fair pricing and ethical streaming. Visit hz-streams.com to learn more">
<meta name="keywords" content="HZ Music Streamer, hz-streams, ethical streaming, artist-first platform, global music">
  <!-- EmailJS SDK for sending emails from frontend -->
  <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script type="text/javascript">
    (function(){
      emailjs.init('PXA4_rTjGjzYdHrtv'); // TODO: Replace with your EmailJS user ID
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HZ Music Streamer</title>
   <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
   
  <style>
  .card-display { background: linear-gradient(135deg, #232526 0%, #414345 100%); border-radius: 16px; box-shadow: 0 4px 24px rgba(0,0,0,0.18); padding: 22px 28px 18px 28px; margin: 0 auto 18px auto; min-width: 270px; max-width: 340px; color: #fff; font-family: 'Segoe UI', Arial, sans-serif; position: relative; display: flex; flex-direction: column; align-items: flex-start; gap: 10px; border: 1.5px solid #333; }
  .card-chip { width: 38px; height: 24px; background: linear-gradient(90deg, #e0e0e0 0%, #bdbdbd 100%); border-radius: 6px; margin-bottom: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.12); }
  .card-number { font-size: 1.25rem; letter-spacing: 2.5px; font-family: 'Roboto Mono', 'Courier New', monospace; margin-bottom: 6px; font-weight: 700; color: #fff; text-shadow: 0 1px 4px rgba(0,0,0,0.18); }
  .card-details-row { display: flex; align-items: center; gap: 12px; width: 100%; }
  .card-label { font-size: 0.85rem; color: #bdbdbd; font-weight: 600; margin-right: 6px; }
  .card-expiry { font-size: 1.05rem; font-family: 'Roboto Mono', 'Courier New', monospace; color: #fff; font-weight: 700; letter-spacing: 1.5px; }
  :root {
  /* Default (Dark) theme */
    --bg-main: #000;
    --bg-secondary: #181818;
    --bg-tertiary: #222;
    --text-primary: #fff;
    --accent-color: #ffb700;
  }
  [data-theme="light"] {
    --bg-main: #fff;
    --bg-secondary: #f3f3f3;
    --bg-tertiary: #eaeaea;
    --text-primary: #181818;
    --accent-color: #1db954;
  }
  [data-theme="green"] {
    --bg-main: #1db954;
    --bg-secondary: #1ed760;
    --bg-tertiary: #b2f5c5;
    --text-primary: #181818;
    --accent-color: #1db954;
  }
  [data-theme="ocean-blue"] {
    --bg-main: #185a9d;
    --bg-secondary: #43cea2;
    --bg-tertiary: #0a2540;
    --text-primary: #ffffff;
    --accent-color: #3ec6ff;
  }
  [data-theme="purple-vibes"] {
    --bg-main: #7b2ff2;
    --bg-secondary: #f357a8;
    --bg-tertiary: #4f2c91;
    --text-primary: #ffffff;
    --accent-color: #e040fb;
  }
  /* Add more custom themes as needed */
    /* Spotify-Authentic Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-size: 16px;
    }

  body {
    font-family: 'Spotify Circular', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: var(--bg-main);
    color: var(--text-primary);
    min-height: 100vh;
    overflow-x: hidden;
    line-height: 1.6;
  }

  .container {
    display: flex;
    min-height: 100vh;
    position: relative;
    background: var(--bg-main);
  }

    /* Spotify Main Content Layout */
  .main-content {
    flex: 1;
    padding: 0;
    background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-tertiary) 15%, var(--bg-main) 100%);
    min-height: 100vh;
    overflow-y: auto;
    border-radius: 8px 8px 0 0;
    margin: 8px 8px 0 8px;
  }

    /* Spotify Header */
    .page-header {
      padding: 16px 32px 24px 32px;
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, rgba(26, 26, 26, 0.8) 0%, rgba(18, 18, 18, 0.6) 50%, transparent 100%);
      backdrop-filter: blur(16px);
      z-index: 50;
      border-bottom: none;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      max-width: none;
      margin: 0;
      padding-bottom: 0;
    }

    .greeting-section {
      flex: 1;
    }

    .greeting-text {
      font-size: 2rem;
      font-weight: 900;
      margin: 0;
      color: #ffffff;
      letter-spacing: -0.04em;
      line-height: 1.2;
    }

    .time-based-message {
      font-size: 0.875rem;
      color: #a7a7a7;
      margin-top: 4px;
      font-weight: 400;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .upgrade-btn {
      background: transparent;
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 4px 16px;
      border-radius: 500px;
      font-weight: 700;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.1s ease;
      display: flex;
      align-items: center;
      gap: 4px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      height: 32px;
    }

    .upgrade-btn:hover {
      transform: scale(1.04);
      border-color: #ffffff;
      background: rgba(255, 255, 255, 0.1);
    }

    .premium-icon {
      font-size: 0.875rem;
    }

    /* Spotify Content Sections */
    .content-section {
      margin-bottom: 40px;
      padding: 0 32px;
      max-width: none;
      margin-left: 0;
      margin-right: 0;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

  .section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
    letter-spacing: -0.04em;
    line-height: 1.3;
  }

    .show-all-link {
      color: #a7a7a7;
      text-decoration: none;
      font-size: 0.75rem;
      font-weight: 700;
      transition: color 0.1s ease;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .show-all-link:hover {
      color: #ffffff;
      text-decoration: underline;
    }

    .content-row {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 24px;
      overflow-x: auto;
      padding-bottom: 8px;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .content-row::-webkit-scrollbar {
      display: none;
    }

    /* Spotify Content Cards */
    .content-card {
      background: #181818;
      border-radius: 8px;
      padding: 16px;
      transition: all 0.3s cubic-bezier(0.3, 0, 0, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      border: none;
      box-shadow: none;
    }

    .content-card:hover {
      background: #282828;
      transform: translateY(0);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    }

    .card-image, .card-cover {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 4px;
      object-fit: cover;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #333333, #1a1a1a);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
      transition: box-shadow 0.3s ease;
    }

    .content-card:hover .card-image,
    .content-card:hover .card-cover {
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.7);
    }

    .card-title, .card-title-text {
      font-weight: 700;
      font-size: 1rem;
      color: #ffffff;
      margin-bottom: 4px;
      line-height: 1.3;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      line-clamp: 1;
      -webkit-box-orient: vertical;
      letter-spacing: -0.04em;
    }

    .card-subtitle, .card-description {
      font-size: 0.875rem;
      color: #a7a7a7;
      line-height: 1.3;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      font-weight: 400;
    }

    /* Artist Cards - Circular */
    .artist-card .card-cover,
    .artist-card .card-image {
      border-radius: 50%;
    }

    /* Content Cards Container - Horizontal Layout */
    .content-cards {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      padding-bottom: 8px;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .content-cards::-webkit-scrollbar {
      display: none;
    }

    /* Small Content Cards */
    .content-card-small {
      padding: 12px;
      width: 140px;
      flex-shrink: 0;
    }

    .card-image-small {
      width: 100%;
      height: 100px;
      margin-bottom: 8px;
    }

    .card-title-small {
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 2px;
      line-height: 1.2;
    }

    .card-description-small {
      font-size: 0.7rem;
      line-height: 1.2;
      -webkit-line-clamp: 2;
      line-clamp: 2;
    }

    /* Spotify Play Button */
    .play-button, .play-overlay {
      position: absolute;
      bottom: 16px;
      right: 16px;
      width: 48px;
      height: 48px;
      background: #1db954;
      border: none;
      border-radius: 50%;
      color: #000000;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transform: translateY(8px);
      transition: all 0.3s cubic-bezier(0.3, 0, 0, 1);
      box-shadow: 0 8px 8px rgba(0, 0, 0, 0.3);
      z-index: 10;
    }

    .content-card:hover .play-button,
    .content-card:hover .play-overlay {
      opacity: 1;
      transform: translateY(0);
    }

    .play-button:hover,
    .play-overlay:hover {
      transform: scale(1.05);
      background: #1ed760;
    }

    /* Streaming Platform Track Display */
    .track-list-container {
      background: transparent;
      border-radius: 8px;
      margin: 32px 0;
      padding: 0 32px;
    }

    .track-list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .track-list-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffffff;
      margin: 0;
      letter-spacing: -0.04em;
    }

    .track-list-controls {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .play-all-btn {
      background: #1db954;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      color: #000000;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.1s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .play-all-btn:hover {
      transform: scale(1.05);
      background: #1ed760;
    }

    .track-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }

    .track-table-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      height: 36px;
    }

    .track-table-header th {
      text-align: left;
      font-size: 0.75rem;
      font-weight: 400;
      color: #a7a7a7;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 0 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .track-table-header th:first-child {
      width: 40px;
      padding-left: 0;
    }

    .track-table-header th:nth-child(2) {
      width: 50%;
    }

    .track-table-header th:nth-child(3) {
      width: 25%;
    }

    .track-table-header th:nth-child(4) {
      width: 15%;
    }

    .track-table-header th:last-child {
      width: 60px;
      padding-right: 0;
    }

    .track-row {
      height: 56px;
      border-radius: 4px;
      transition: all 0.1s ease;
      cursor: pointer;
    }

    .track-row:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .track-row td {
      padding: 8px 16px;
      border: none;
      vertical-align: middle;
    }

    .track-row td:first-child {
      padding-left: 0;
      width: 40px;
    }

    .track-row td:last-child {
      padding-right: 0;
      width: 60px;
    }

    .track-number {
      font-size: 1rem;
      color: #a7a7a7;
      font-weight: 400;
      text-align: center;
      width: 40px;
    }

    .track-row:hover .track-number {
      opacity: 0;
    }

    .track-row:hover .track-play-btn {
      opacity: 1;
    }

    .track-play-btn {
      background: transparent;
      border: none;
      color: #ffffff;
      font-size: 1rem;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.1s ease;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .track-info {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .track-artwork {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      object-fit: cover;
      background: linear-gradient(135deg, #333333, #1a1a1a);
    }

    .track-details {
      min-width: 0;
      flex: 1;
    }

    .track-name {
      font-size: 1rem;
      font-weight: 400;
      color: #ffffff;
      margin-bottom: 2px;
      line-height: 1.3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .track-artist {
      font-size: 0.875rem;
      color: #a7a7a7;
      line-height: 1.3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .track-album {
      font-size: 0.875rem;
      color: #a7a7a7;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .track-album:hover {
      color: #ffffff;
      text-decoration: underline;
    }

    .track-duration {
      font-size: 0.875rem;
      color: #a7a7a7;
      font-weight: 400;
      text-align: right;
    }

    .track-actions {
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.1s ease;
    }

    .track-row:hover .track-actions {
      opacity: 1;
    }

    .track-like-btn, .track-menu-btn {
      background: transparent;
      border: none;
      color: #a7a7a7;
      font-size: 1rem;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.1s ease;
    }

    .track-like-btn:hover, .track-menu-btn:hover {
      color: #ffffff;
      background: rgba(255, 255, 255, 0.1);
    }

    .track-like-btn.liked {
      color: #1db954;
    }

    /* Recently Played Tracks Section */
    .recently-played-tracks {
      margin: 32px 0;
      padding: 0 32px;
    }

    .recently-played-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .recently-played-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .recent-track-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      border-radius: 4px;
      transition: all 0.1s ease;
      cursor: pointer;
    }

    .recent-track-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .recent-track-artwork {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      object-fit: cover;
      background: linear-gradient(135deg, #333333, #1a1a1a);
    }

    .recent-track-info {
      flex: 1;
      min-width: 0;
    }

    .recent-track-name {
      font-size: 0.875rem;
      font-weight: 400;
      color: #ffffff;
      margin-bottom: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .recent-track-artist {
      font-size: 0.75rem;
      color: #a7a7a7;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .recent-track-time {
      font-size: 0.75rem;
      color: #a7a7a7;
      white-space: nowrap;
    }

    /* Spotify Quick Access Cards */
    .quick-access-card:hover {
      transform: scale(1.02);
      filter: brightness(1.1);
    }

    /* Navigation Buttons - Hide main nav since we use hamburger */
    .nav-buttons {
      display: none;
    }

    .nav-btn {
      background: linear-gradient(45deg, #0066ff, #4d94ff);
      color: #fff;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 25px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 102, 255, 0.4);
    }

    .nav-btn.active {
      background: linear-gradient(45deg, #003366, #0066ff);
      box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
    }

    .nav-btn.active:hover {
      box-shadow: 0 6px 20px rgba(0, 102, 255, 0.4);
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: var(--accent-color);
      font-size: 2.5rem;
      text-shadow: 0 0 20px rgba(29, 185, 84, 0.5);
      transition: color 0.3s ease;
    }

    /* Track Lists */
    .track-list {
      background: var(--bg-tertiary);
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .section-title {
      color: var(--accent-color);
      font-size: 1.2rem;
      margin-bottom: 1rem;
      font-weight: 600;
      transition: color 0.3s ease;
    }

    .welcome {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 1.2rem;
      color: var(--text-primary);
      text-align: center;
      transition: color 0.3s ease;
    }

    .desc {
      color: var(--text-secondary);
      font-size: 1.1rem;
      margin-bottom: 2rem;
      text-align: center;
      transition: color 0.3s ease;
    }

    .action-buttons {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 2rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .action-buttons a, .action-buttons button {
      background: linear-gradient(45deg, #0066ff, #4d94ff);
      color: #fff;
      border: none;
      padding: 0.8rem 2.2rem;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .action-buttons a:hover, .action-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 102, 255, 0.4);
    }

    .action-buttons a.secondary {
      background: transparent;
      color: #FFD700;
      border: 2px solid #FFD700;
    }

    .action-buttons a.secondary:hover {
      background: #FFD700;
      color: #000;
    }

    /* Search Box */
    .search-container {
      position: relative;
      margin-bottom: 2rem;
    }

        .search-box {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 25px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .search-box:focus {
            background: var(--bg-quaternary);
            border-color: var(--accent-color);
            transform: scale(1.02);
        }

        .search-box::placeholder {
            color: var(--text-secondary);
        }

        /* Legacy compatibility styles */
        aside {
            width: 220px;
            background: linear-gradient(135deg, #ffb700 0%, #ff6a00 100%);
            color: #181818;
            box-shadow: 0 4px 24px rgba(255,186,0,0.10);
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            border-right: 1px solid #333;
        }

        aside h2 {
            font-size: 1.1rem;
            color: #1db954;
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }

        aside ul {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        aside ul li a {
            color: #b3b3b3;
            text-decoration: none;
            font-size: 1rem;
            transition: color 0.2s;
        }

        aside ul li a:hover {
            color: #1db954;
        }

        .upload-btn {
            background: linear-gradient(45deg, #0066ff, #4d94ff);
            color: #181818;
            font-weight: 900;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
            margin: 0.25rem;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 102, 255, 0.4);
        }

        /* Track Items */
        .track-item {
            background: #181818;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #333;
            transition: all 0.3s ease;
        }

        .track-item:hover {
            background: #282828;
            border-color: #1db954;
            transform: translateY(-2px);
        }

        .track-info {
            flex: 1;
        }

        .track-title {
            font-weight: 600;
            color: #fff;
            font-size: 0.95rem;
            margin-bottom: 0.2rem;
        }

        .track-artist {
            font-size: 0.85rem;
            color: #b3b3b3;
        }

        .play-btn {
            background: linear-gradient(45deg, #1db954, #1ed760);
            color: #fff;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(29, 185, 84, 0.3);
            min-width: 80px;
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(29, 185, 84, 0.5);
        }

        /* Storage indicator styling */
        #storageIndicator {
            background: #2a2a2a;
            color: #1db954;
            border: 1px solid #404040;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        #storageIndicator:hover {
            background: #1db954;
            color: #fff;
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            aside {
                display: none;
            }

            .main-content {
                padding: 1rem;
                padding-bottom: 120px; /* Extra space for bottom nav */
            }

            .nav-buttons {
                gap: 0.5rem;
                margin: 1.5rem 0;
            }

            .nav-btn {
                padding: 0.6rem 1rem;
                font-size: 0.8rem;
            }

            .action-buttons {
                flex-direction: column;
                gap: 1rem;
            }

            .bottom-nav {
                padding: 0.3rem 0.5rem 0.5rem 0.5rem;
            }

            .bottom-nav-item {
                min-width: 45px;
                padding: 0.1rem;
            }

            .bottom-nav-icon {
                font-size: 1.2rem;
            }

            .bottom-nav-label {
                font-size: 0.6rem;
            }

            .search-popup {
                width: 95%;
                padding: 1.5rem;
                margin: 1rem;
            }

            .page-content {
                padding: 1rem;
                padding-bottom: 120px;
            }

            .page-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .page-title {
                font-size: 1.5rem;
            }
        }

        /* Ensure main content has bottom padding for the bottom nav */
        .main-content {
            padding-bottom: 100px;
        }

        /* Hide sticky player on very small screens when bottom nav is visible */
        @media (max-width: 480px) {
            .sticky-player {
                bottom: 80px; /* Move above bottom nav */
            }
        }

        .track-section {
            margin: 2.5rem 0;
        }

    .track-row-list {
      display: flex;
      overflow-x: auto;
      gap: 1.2rem;
      padding: 1rem 0;
      scrollbar-width: thin;
      scrollbar-color: #1db954 #181818;
    }

    .track-row-list::-webkit-scrollbar {
      height: 8px;
    }

    .track-row-list::-webkit-scrollbar-track {
      background: #181818;
      border-radius: 4px;
    }

    .track-row-list::-webkit-scrollbar-thumb {
      background: #1db954;
      border-radius: 4px;
    }

    .track-row-list::-webkit-scrollbar-thumb:hover {
      background: #17a74a;
    }

    .track-card button:hover {
      transform: scale(1.05);
    }

    .track-card input[type="file"] {
      display: none !important;
    }

    .track-card input[type="text"] {
      background: #181818;
      color: #fff;
      border: 1px solid #1db954;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .track-card input[type="text"]:focus {
      outline: none;
      border-color: #17a74a;
      box-shadow: 0 0 0 2px rgba(29, 185, 84, 0.2);
    }

    /* Track section styling */
    .section-header {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      margin-top: 3rem;
      color: #fff;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      padding-bottom: 0.5rem;
    }

    .section-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, #1db954, #1ed760);
      border-radius: 2px;
    }

    .track-section {
      margin: 2.5rem 0;
    }

    /* Hamburger Menu Styles */
    .hamburger-menu {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 2000;
        background: linear-gradient(45deg, #FFD700, #FFA500);
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 4px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
    }

    .hamburger-menu:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
    }

    .hamburger-line {
        width: 20px;
        height: 2px;
        background: #000;
        border-radius: 1px;
        transition: all 0.3s ease;
    }

    .hamburger-menu.active .hamburger-line:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
    }

    .hamburger-menu.active .hamburger-line:nth-child(2) {
        opacity: 0;
    }

    .hamburger-menu.active .hamburger-line:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -6px);
    }

    /* Navigation Dropdown */
  .nav-dropdown {
    position: fixed;
    top: 80px;
    left: 20px;
    z-index: 1900;
    background: linear-gradient(145deg, #1a1a1a 0%, #2a2a2a 100%);
    border-radius: 15px;
    padding: 1rem;
    min-width: 200px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    border: 2px solid #404040;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-20px);
    transition: all 0.3s ease;
    overflow: hidden;
  }

    .nav-dropdown.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

  .nav-dropdown .nav-btn {
    display: block;
    width: 100%;
    box-sizing: border-box;
    margin-bottom: 0.5rem;
    text-align: left;
    padding: 0.8rem 1rem;
    border-radius: 8px;
    background: transparent;
    border: 1px solid transparent;
    transition: all 0.2s ease;
    overflow: hidden;
  }

    .nav-dropdown .nav-btn:last-child {
        margin-bottom: 0;
    }

    .nav-dropdown .nav-btn:hover {
        background: linear-gradient(45deg, #FFD700, #FFA500);
        color: #000;
        transform: translateX(5px);
        border-color: #FFD700;
    }

    .nav-dropdown .nav-btn.active {
        background: linear-gradient(45deg, #0066ff, #4d94ff);
        color: #fff;
        border-color: #0066ff;
    }

    .nav-dropdown .nav-btn.active:hover {
        background: linear-gradient(45deg, #FFD700, #FFA500);
        color: #000;
        border-color: #FFD700;
    }

    /* Hide the main navigation buttons since we're using hamburger menu */
    .nav-buttons {
        display: none;
    }

    /* Spotify-style Bottom Navigation */
    .bottom-nav {
        position: fixed;
        bottom: 32px; /* Raised above copyright footer */
        left: 0;
        right: 0;
        background: rgba(18, 18, 18, 0.95);
        backdrop-filter: blur(10px);
        border-top: 1px solid var(--border-color);
        padding: 0.4rem 1rem 0.6rem 1rem;
        z-index: 1500;
        display: flex;
        justify-content: space-around;
        align-items: center;
        border-radius: 0;
    }

    .bottom-nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        padding: 0.2rem;
        border-radius: 0;
        transition: color 0.2s ease;
        background: transparent;
        border: none;
        color: #a7a7a7; /* Spotify/SoundCloud-like neutral gray */
        min-width: 50px;
        font-family: inherit;
    }

    .bottom-nav-item:hover {
        color: #ffffff; /* White on hover like Spotify */
    }

    .bottom-nav-item.active {
        color: #ffffff; /* Active state remains white */
    }

    .bottom-nav-icon {
        font-size: 1.4rem;
        margin-bottom: 0.1rem;
        transition: inherit;
        color: inherit; /* Inherit color from parent for consistency */
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
    }

    .bottom-nav-icon svg {
        width: 100%;
        height: 100%;
        fill: currentColor; /* Ensure SVG uses the current text color */
        transition: inherit;
    }

    .bottom-nav-label {
        font-size: 0.65rem;
        font-weight: 400;
        transition: inherit;
    }

    /* Search Popup Overlay - Spotify Style */
    .search-popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #121212;
        z-index: 2000;
        display: none;
        align-items: flex-start;
        justify-content: center;
        backdrop-filter: none;
        padding-top: 0;
    }

    .search-popup {
        background: var(--bg-primary);
        border-radius: 0;
        padding: 0;
        width: 100%;
        max-width: 100%;
        height: 100vh;
        overflow-y: auto;
        border: none;
        box-shadow: none;
        position: relative;
    }

    .search-header {
        position: sticky;
        top: 0;
        background: var(--bg-primary);
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        z-index: 10;
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .search-popup h3 {
        color: var(--text-primary);
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
        transition: color 0.3s ease;
    }

    .search-popup .search-container {
        margin: 1.5rem 0;
        position: relative;
    }

    .search-popup .search-box {
        width: 100%;
        padding: 0.75rem 3rem 0.75rem 1rem;
        border: none;
        border-radius: 50px;
        background: var(--bg-secondary);
        color: var(--text-primary);
        font-size: 1rem;
        outline: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 2px solid transparent;
    }

    .search-popup .search-box:focus {
        background: var(--bg-tertiary);
        border-color: var(--accent-color);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transform: none;
    }

    .search-popup .search-box::placeholder {
        color: var(--text-secondary);
        font-weight: 400;
    }

    .search-icon {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
        font-size: 1.2rem;
        pointer-events: none;
        transition: color 0.3s ease;
    }

    .search-close-btn {
        position: absolute;
        top: 1rem;
        right: 1.5rem;
        background: none;
        border: none;
        color: var(--text-secondary);
        font-size: 1.8rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        transition: all 0.3s ease;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .search-close-btn:hover {
        color: var(--text-primary);
        background: var(--bg-tertiary);
        transform: scale(1.1);
    }

    .search-content {
        padding: 0 1.5rem 2rem 1.5rem;
    }

    .search-categories {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .search-category {
        background: var(--bg-secondary);
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
    }

    .search-category:hover {
        background: var(--bg-tertiary);
        border-color: var(--accent-color);
        transform: translateY(-2px);
    }

    .search-category-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        display: block;
    }

    .search-category-title {
        color: var(--text-primary);
        font-weight: 600;
        font-size: 0.9rem;
        transition: color 0.3s ease;
    }

    .search-results {
        margin-top: 2rem;
        display: none;
    }

    .search-results.active {
        display: block;
    }

    .search-results-header {
        color: var(--text-primary);
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 1rem;
        transition: color 0.3s ease;
    }

    .search-result-item {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 0.5rem;
    }

    .search-result-item:hover {
        background: var(--bg-secondary);
    }

    .search-result-icon {
        width: 48px;
        height: 48px;
        background: var(--bg-tertiary);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1.2rem;
        color: var(--text-secondary);
        transition: all 0.3s ease;
    }

    .search-result-info {
        flex: 1;
    }

    .search-result-title {
        color: var(--text-primary);
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 0.2rem;
        transition: color 0.3s ease;
    }

    .search-result-subtitle {
        color: var(--text-secondary);
        font-size: 0.85rem;
        transition: color 0.3s ease;
    }

    .search-result-action {
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .search-result-action:hover {
        background: var(--accent-color);
        color: var(--bg-primary);
        border-color: var(--accent-color);
    }

    /* Recent searches */
    .recent-searches {
        margin-bottom: 2rem;
    }

    .recent-searches-header {
        color: var(--text-primary);
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: color 0.3s ease;
    }

    .clear-recent-btn {
        color: var(--text-secondary);
        background: none;
        border: none;
        cursor: pointer;
        font-size: 0.85rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        transition: all 0.3s ease;
    }

    .clear-recent-btn:hover {
        color: var(--text-primary);
        background: var(--bg-secondary);
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
        .search-popup {
            padding-top: 0;
        }

        .search-header {
            padding: 1rem;
        }

        .search-content {
            padding: 0 1rem 2rem 1rem;
        }

        .search-categories {
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
        }

        .search-category {
            padding: 0.75rem;
        }

        .search-close-btn {
            right: 1rem;
            width: 36px;
            height: 36px;
            font-size: 1.5rem;
        }
    }

    /* Page Overlay for liked, account, settings */
    .page-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(18, 18, 18, 0.98);
        z-index: 1800;
        display: none;
        backdrop-filter: blur(10px);
    }

    .page-content {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow-y: auto;
        padding: 2rem;
        padding-bottom: 100px; /* Space for bottom nav */
        background: var(--bg-primary);
        transition: background-color 0.3s ease;
    }

    .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border-color);
        transition: border-color 0.3s ease;
    }

    .page-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--accent-color);
        transition: color 0.3s ease;
    }

    .page-close-btn {
        background: transparent;
            color: #333;
        border: 1px solid #a7a7a7;
        padding: 8px 16px;
        border-radius: 500px;
        cursor: pointer;
        font-weight: 700;
        font-size: 0.75rem;
        transition: all 0.1s ease;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        height: 32px;
    }

    .page-close-btn:hover {
        transform: scale(1.04);
        border-color: #ffffff;
        color: #ffffff;
    }

    /* Copyright Footer */
    .copyright-footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        background: rgba(18, 18, 18, 0.95);
        color: var(--text-secondary);
        text-align: center;
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
        z-index: 500; /* Lower than bottom nav so it stays behind */
        backdrop-filter: blur(10px);
        transition: background-color 0.3s ease, color 0.3s ease;
        pointer-events: none; /* Prevents interaction while staying visible */
        user-select: none; /* Prevents text selection */
    }

    .copyright-footer:hover {
        background: rgba(18, 18, 18, 0.98);
        color: var(--text-primary);
        pointer-events: auto; /* Re-enable interaction on hover if needed */
    }

    /* Adjust main content to account for copyright footer */
    .main-content {
        padding-bottom: 140px; /* Increased for bottom nav + copyright */
        max-height: calc(100vh - 40px); /* Allow scrolling with some top margin */
        overflow-y: auto; /* Enable vertical scrolling */
    }

    .page-content {
        padding-bottom: 140px; /* Increased for bottom nav + copyright */
    }

    /* Hide copyright on very small screens to avoid overlap */
    @media (max-width: 480px) {
        .copyright-footer {
            display: none;
        }

        .main-content {
            padding-bottom: 100px; /* Back to original on mobile */
        }

        .page-content {
            padding-bottom: 120px; /* Back to original on mobile */
        }
    }
  </style>
</head>
<body>

  <!-- Mini Video Player Overlay & Container (from Offline25App.html) -->
  <style>
    .video-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1999;
      display: none;
    }
    .video-mini-player {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 320px;
      height: 180px;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.6);
      z-index: 2000;
      display: none;
      border: 2px solid #1db954;
      cursor: pointer;
    }
    .video-mini-player video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center center;
      background: #000;
    }
    .video-mini-play-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: none;
      border: none;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all 0.3s;
      z-index: 10;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }
    .video-mini-player:hover .video-mini-play-center { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
    .video-mini-play-center:hover { transform: translate(-50%, -50%) scale(1.2) !important; text-shadow: 2px 2px 6px rgba(0,0,0,1); }
    .video-mini-mute, .video-mini-fullscreen, .video-close-mini {
      position: absolute;
      background: none;
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all 0.3s;
      z-index: 10;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }
    .video-mini-player:hover .video-mini-mute,
    .video-mini-player:hover .video-mini-fullscreen,
    .video-mini-player:hover .video-close-mini { opacity: 1; }
    .video-mini-mute { bottom: 8px; left: 8px; }
    .video-mini-fullscreen { top: 8px; left: 8px; }
    .video-close-mini { top: 8px; right: 8px; background: rgba(0,0,0,0.8); width: 30px; height: 30px; border-radius: 50%; font-size: 18px; font-weight: bold; }
    .video-close-mini:hover { background: rgba(0,0,0,1); transform: scale(1.1); }
    .video-mini-controls { display: none; }
    .video-mini-btn { background: none; border: none; color: white; font-size: 16px; cursor: pointer; padding: 4px; border-radius: 4px; transition: all 0.2s; }
    .video-fullscreen { position: fixed !important; top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important; max-width: none !important; transform: none !important; border-radius: 0 !important; z-index: 2001; }
    .video-fullscreen video { max-height: 100vh !important; }
  </style>

  <div id="videoOverlay" class="video-overlay"></div>
  <div id="miniVideoPlayer" class="video-mini-player">
    <video id="miniVideoElement" src="" preload="metadata"></video>
    <button class="video-mini-play-center" id="miniPlayPauseBtn">▶</button>
    <button class="video-mini-mute" id="miniMuteBtn">🔇</button>
    <button class="video-mini-fullscreen" id="miniFullscreenBtn">⛶</button>
    <button class="video-close-mini" id="miniCloseBtn">×</button>
  </div>

  <div class="container">
    <!-- Hamburger Menu Button -->
    <button class="hamburger-menu" id="hamburgerMenu">
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
    </button>

    <!-- Navigation Dropdown Menu -->
    <div class="nav-dropdown" id="navDropdown">
        <a href="index.html" class="nav-btn active">🏠 Home</a>
        <a href="Online25App.html" class="nav-btn">🌐 Online</a>
        <a href="Offline25App.html" class="nav-btn">📱 Offline</a>
        <a href="Playlist25App.html" class="nav-btn">📋 Playlists</a>
        <a href="Liked25App.html" class="nav-btn">❤️ Liked</a>
        <a href="Account25App.html" class="nav-btn">👤 Account</a>
        <a href="Settings25App.html" class="nav-btn">⚙️ Settings</a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <h1> <span style="color:#FFD700;"></span> <span style="color:#0066ff; font-size:2.0rem;"></span></h1>

      <!-- Navigation Buttons -->
      <div class="nav-buttons">
        <a href=index.html" class="nav-btn active">🏠 Home</a>
        <a href="Online25App.html" class="nav-btn">🌐 Online</a>
        <a href="Offline25App.html" class="nav-btn">📱 Offline</a>
        <a href="Playlist25App.html" class="nav-btn">📋 Playlists</a>

        <a href="Liked25App.html" class="nav-btn">❤️ Liked</a>
        <a href="Account25App.html" class="nav-btn">👤 Account</a>
        <a href="Settings25App.html" class="nav-btn">⚙️ Settings</a>
      </div>

      <!-- Spotify Homepage Header -->
      <div class="spotify-header">
        <div class="spotify-greeting">
          <h1 id="greetingText">Shine & Prosper</h1>
        </div>
        <div class="header-actions">
          <button class="upgrade-btn" id="openPaymentModalBtn">Upgrade to Premium</button>
        </div>
    <!-- Payment Modal Popup -->
    <div id="paymentModal" class="payment-modal" style="display:none;">
      <div class="payment-modal-content">
        <button class="payment-modal-close" id="closePaymentModalBtn" title="Close">&times;</button>
        <h2 class="payment-modal-title">Upgrade to Premium</h2>
        <!-- Professional Card Display -->
        <div id="cardDisplay" class="card-display">
          <div class="card-chip"></div>
          <div class="card-number" id="displayCardNumber">1111 1111 1111 1111</div>
          <div class="card-details-row">
            <div class="card-label">Expiry</div>
            <div class="card-expiry" id="displayCardExpiry">11/11</div>
          </div>
        </div>
        <form id="paymentForm" autocomplete="off">
          <label for="userEmail" class="payment-label">Email</label>
          <input type="email" id="userEmail" name="userEmail" class="payment-input" placeholder="you@email.com" required>
          <label for="cardNumber" class="payment-label">Card Number</label>
          <input type="text" id="cardNumber" name="cardNumber" class="payment-input" maxlength="19" placeholder="1234 5678 9012 3456" required pattern="[0-9 ]{15,19}">
          <div class="payment-row">
            <div style="flex:2;">
              <label for="cardExpiry" class="payment-label">Expiry</label>
              <input type="text" id="cardExpiry" name="cardExpiry" class="payment-input" maxlength="5" placeholder="MM/YY" required pattern="(0[1-9]|1[0-2])\/\d{2}">
            </div>
            <div style="flex:1; margin-left:8px;">
              <label for="cardCVV" class="payment-label">CVV</label>
              <input type="password" id="cardCVV" name="cardCVV" class="payment-input" maxlength="4" placeholder="123" required pattern="\d{3,4}">
            </div>
          </div>
          <button type="submit" class="payment-submit-btn">Pay $9.99</button>
        </form>
      </div>
    </div>
  <style>
      .payment-modal {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.85);
        display: flex; align-items: center; justify-content: center;
        z-index: 9999;
        transition: opacity 0.2s;
      }
      .payment-modal-content {
        background: linear-gradient(180deg, #181818 0%, #121212 100%);
        border-radius: 16px;
        padding: 32px 28px 24px 28px;
        min-width: 340px; max-width: 95vw;
        box-shadow: 0 8px 32px rgba(0,0,0,0.7);
        position: relative;
        color: #fff;
        font-family: inherit;
        animation: fadeInModal 0.3s;
      }
      @keyframes fadeInModal { from { opacity: 0; transform: scale(0.98);} to { opacity: 1; transform: scale(1);} }
      .payment-modal-close {
        position: absolute; top: 16px; right: 16px;
        background: none; border: none; color: #fff;
        font-size: 2rem; font-weight: 700; cursor: pointer;
        transition: color 0.15s;
        z-index: 2;
      }
      .payment-modal-close:hover { color: #ffb700; }
      .payment-modal-title {
        font-size: 1.5rem; font-weight: 900; margin-bottom: 1.5rem; text-align: center;
        letter-spacing: -0.03em;
      }
      .payment-label {
        display: block; font-size: 0.95rem; font-weight: 700; margin-bottom: 4px; margin-top: 16px;
        color: #fff;
      }
      .payment-input {
        width: 100%; padding: 10px 12px; border-radius: 6px; border: 1px solid #282828;
        background: #181818; color: #fff; font-size: 1rem; margin-bottom: 0;
        outline: none; transition: border 0.2s;
        font-family: inherit;
      }
      .payment-input:focus { border: 1.5px solid #1db954; background: #222; }
      .payment-row { display: flex; gap: 8px; }
      .payment-submit-btn {
        width: 100%; margin-top: 28px; padding: 12px 0; border-radius: 500px;
        background: linear-gradient(90deg, #ffb700 0%, #ff6a00 100%);
        color: #181818; font-weight: 900; font-size: 1.1rem; border: none; cursor: pointer;
        box-shadow: 0 2px 8px rgba(255,186,0,0.08);
        letter-spacing: 0.04em; transition: background 0.2s, color 0.2s;
      }
      .payment-submit-btn:hover { background: linear-gradient(90deg, #ff6a00 0%, #ffb700 100%); color: #fff; }
      @media (max-width: 500px) {
        .payment-modal-content { padding: 18px 4vw; min-width: 0; }
      }
    </style>
    <script>
      // EmailJS send function for Bluetooth connectivity prompt
      function sendBluetoothPromptEmail(toEmail) {
  emailjs.send('service_p6dv7ey', 'template_46ef7mf', {
          to_email: toEmail,
          hz_subject: 'Hertz25: Device Connectivity',
          hz_message: 'To connect your devices via Bluetooth, please ensure Bluetooth is enabled and both devices are discoverable. Then use the Host/Join feature in the app. If you have any issues, reply to this email for support.\n\nThank you for using Hertz25!'
        })
        .then(function(response) {
          console.log('Email sent successfully:', response);
        }, function(error) {
          console.error('Email send failed:', error);
        });
      }
      // Card Display Live Update
      const cardNumberInput = document.getElementById('cardNumber');
      const displayCardNumber = document.getElementById('displayCardNumber');
      const cardExpiryInput2 = document.getElementById('cardExpiry');
      const displayCardExpiry = document.getElementById('displayCardExpiry');
      function formatCardNumber(num) {
        return num.replace(/[^\d]/g, '').replace(/(.{4})/g, '$1 ').trim();
      }
      cardNumberInput.addEventListener('input', function(e) {
        let value = this.value.replace(/[^\d]/g, '');
        let formatted = value.replace(/(.{4})/g, '$1 ').trim();
        // Set the formatted value back to the input, preserving caret position
        let caret = this.selectionStart;
        let prevLength = this.value.length;
        this.value = formatted;
        let nextLength = formatted.length;
        if (nextLength > prevLength && caret % 5 === 0 && caret < nextLength) {
          this.selectionStart = this.selectionEnd = caret + 1;
        } else {
          this.selectionStart = this.selectionEnd = caret;
        }
        displayCardNumber.textContent = formatted || '1111 1111 1111 1111';
      });
      cardExpiryInput2.addEventListener('input', function() {
        displayCardExpiry.textContent = this.value || '11/11';
      });
      // Payment Modal Logic
      const openBtn = document.getElementById('openPaymentModalBtn');
      const modal = document.getElementById('paymentModal');
      const closeBtn = document.getElementById('closePaymentModalBtn');
      openBtn.addEventListener('click', () => { modal.style.display = 'flex'; document.body.style.overflow = 'hidden'; });
      closeBtn.addEventListener('click', () => { modal.style.display = 'none'; document.body.style.overflow = ''; });
      window.addEventListener('keydown', function(e) { if (e.key === 'Escape' && modal.style.display === 'flex') { modal.style.display = 'none'; document.body.style.overflow = ''; } });
      modal.addEventListener('click', function(e) { if (e.target === modal) { modal.style.display = 'none'; document.body.style.overflow = ''; } });
      /* ...existing CSS... */
  <!-- All JavaScript code should be placed inside <script> tags below, not inside <style> or outside tags. -->

      // Expiry auto-formatting (MM/YY)
      const cardExpiryInput = document.getElementById('cardExpiry');
      cardExpiryInput.addEventListener('input', function(e) {
        let value = this.value.replace(/[^\d]/g, '').slice(0, 4);
        if (value.length > 2) value = value.slice(0,2) + '/' + value.slice(2);
        this.value = value;
      });

      // Payment Form Submission
      document.getElementById('paymentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('userEmail').value.trim();
        const card = cardNumberInput.value.replace(/\s+/g, '');
        const expiry = cardExpiryInput.value.trim();
        const cvv = document.getElementById('cardCVV').value.trim();
        if (!email || !card || !expiry || !cvv) {
          alert('Please fill in all fields.');
          return;
        }
        // Send Bluetooth prompt email via EmailJS
        sendBluetoothPromptEmail(email);
        // Only inject HTML, never <script> or <!-- ... -->
        const confirmationHTML = `
          <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px 0;">
            <div style="font-size:3rem;color:var(--accent-color);margin-bottom:16px;">✔️</div>
            <h2 style="color:var(--accent-color);margin-bottom:8px;">Payment Successful</h2>
            <div style="color:var(--text-primary);font-size:1.1rem;margin-bottom:18px;text-align:center;">Welcome to Premium!<br>Your subscription is now active.</div>
            <button id="closeAfterPay" style="margin-top:12px;padding:10px 32px;border-radius:500px;background:var(--accent-color);color:var(--bg-main);font-weight:700;font-size:1rem;border:none;cursor:pointer;">Close</button>
          </div>
        `;
        modal.querySelector('.payment-modal-content').innerHTML = confirmationHTML;
        // Re-attach close handler after DOM update
        const closeAfterPayBtn = document.getElementById('closeAfterPay');
        if (closeAfterPayBtn) {
          closeAfterPayBtn.onclick = function() {
            modal.style.display = 'none';
            document.body.style.overflow = '';
            setTimeout(() => { location.reload(); }, 200);
          };
        }
      });
    </script>
      </div>

      <!-- Recently Played Tracks -->
      <div class="recently-played-tracks">
        <div class="recently-played-header">
          <h2 class="track-list-title">Recently played</h2>
        </div>
        <div class="recently-played-list">
          <div class="recent-track-item" onclick="playTrack('track1')">
            <div class="recent-track-artwork"></div>
            <div class="recent-track-info">
              <div class="recent-track-name">Sunshine</div>
              <div class="recent-track-artist">OneRepublic</div>
            </div>
            <div class="recent-track-time">2 hours ago</div>
          </div>
          <div class="recent-track-item" onclick="playTrack('track2')">
            <div class="recent-track-artwork"></div>
            <div class="recent-track-info">
              <div class="recent-track-name">Shape of You</div>
              <div class="recent-track-artist">Ed Sheeran</div>
            </div>
            <div class="recent-track-time">Yesterday</div>
          </div>
          <div class="recent-track-item" onclick="playTrack('track3')">
            <div class="recent-track-artwork"></div>
            <div class="recent-track-info">
              <div class="recent-track-name">Watermelon Sugar</div>
              <div class="recent-track-artist">Harry Styles</div>
            </div>
            <div class="recent-track-time">3 days ago</div>
          </div>
        </div>
      </div>

      <!-- Popular Tracks List -->
      <div class="track-list-container">
        <div class="track-list-header">
          <h2 class="track-list-title">Popular tracks</h2>
          <div class="track-list-controls">
            <button class="play-all-btn" onclick="playAllTracks()" title="Play all">▶</button>
          </div>
        </div>

        <table class="track-table">
          <thead class="track-table-header">
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Album</th>
              <th>Date added</th>
              <th>⏱</th>
            </tr>
          </thead>
          <tbody>
            <tr class="track-row" onclick="playTrack('popular1')">
              <td>
                <div class="track-number">1</div>
                <button class="track-play-btn">▶</button>
              </td>
              <td>
                <div class="track-info">
                  <div class="track-artwork"></div>
                  <div class="track-details">
                    <div class="track-name">Shake It Off</div>
                    <div class="track-artist">Taylor Swift</div>
                  </div>
                </div>
              </td>
              <td>
                <div class="track-album">1989</div>
              </td>
              <td>
                <div class="track-duration">2 days ago</div>
              </td>
              <td>
                <div class="track-actions">
                  <button class="track-like-btn" onclick="toggleLike(this, event)">♡</button>
                  <button class="track-menu-btn" onclick="showTrackMenu(event)">⋯</button>
                </div>
              </td>
            </tr>
            <tr class="track-row" onclick="playTrack('popular2')">
              <td>
                <div class="track-number">2</div>
                <button class="track-play-btn">▶</button>
              </td>
              <td>
                <div class="track-info">
                  <div class="track-artwork"></div>
                  <div class="track-details">
                    <div class="track-name">As It Was</div>
                    <div class="track-artist">Harry Styles</div>
                  </div>
                </div>
              </td>
              <td>
                <div class="track-album">Harry's House</div>
              </td>
              <td>
                <div class="track-duration">1 week ago</div>
              </td>
              <td>
                <div class="track-actions">
                  <button class="track-like-btn" onclick="toggleLike(this, event)">♡</button>
                  <button class="track-menu-btn" onclick="showTrackMenu(event)">⋯</button>
                </div>
              </td>
            </tr>
            <tr class="track-row" onclick="playTrack('popular3')">
              <td>
                <div class="track-number">3</div>
                <button class="track-play-btn">▶</button>
              </td>
              <td>
                <div class="track-info">
                  <div class="track-artwork"></div>
                  <div class="track-details">
                    <div class="track-name">Flowers</div>
                    <div class="track-artist">Miley Cyrus</div>
                  </div>
                </div>
              </td>
              <td>
                <div class="track-album">Endless Summer Vacation</div>
              </td>
              <td>
                <div class="track-duration">3 days ago</div>
              </td>
              <td>
                <div class="track-actions">
                  <button class="track-like-btn" onclick="toggleLike(this, event)">♡</button>
                  <button class="track-menu-btn" onclick="showTrackMenu(event)">⋯</button>
                </div>
              </td>
            </tr>
            <tr class="track-row" onclick="playTrack('popular4')">
              <td>
                <div class="track-number">4</div>
                <button class="track-play-btn">▶</button>
              </td>
              <td>
                <div class="track-info">
                  <div class="track-artwork"></div>
                  <div class="track-details">
                    <div class="track-name">Good 4 U</div>
                    <div class="track-artist">Olivia Rodrigo</div>
                  </div>
                </div>
              </td>
              <td>
                <div class="track-album">SOUR</div>
              </td>
              <td>
                <div class="track-duration">5 days ago</div>
              </td>
              <td>
                <div class="track-actions">
                  <button class="track-like-btn" onclick="toggleLike(this, event)">♡</button>
                  <button class="track-menu-btn" onclick="showTrackMenu(event)">⋯</button>
                </div>
              </td>
            </tr>
            <tr class="track-row" onclick="playTrack('popular5')">
              <td>
                <div class="track-number">5</div>
                <button class="track-play-btn">▶</button>
              </td>
              <td>
                <div class="track-info">
                  <div class="track-artwork"></div>
                  <div class="track-details">
                    <div class="track-name">Happy</div>
                    <div class="track-artist">Pharrell Williams</div>
                  </div>
                </div>
              </td>
              <td>
                <div class="track-album">Girl</div>
              </td>
              <td>
                <div class="track-duration">1 week ago</div>
              </td>
              <td>
                <div class="track-actions">
                  <button class="track-like-btn liked" onclick="toggleLike(this, event)">♥</button>
                  <button class="track-menu-btn" onclick="showTrackMenu(event)">⋯</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Made For You Section -->
      <div class="content-section">
        <div class="section-header">
          <h2 class="section-title">Made for you</h2>
          <a href="#" class="see-all-link">See all</a>
        </div>
        <div class="content-cards">
          <div class="content-card content-card-small">
            <div class="card-image card-image-small" style="background: linear-gradient(135deg, #FF6B6B, #4ECDC4);"></div>
            <h3 class="card-title card-title-small">Lovely Mix</h3>
            <p class="card-description card-description-small">Taylor Swift, Ariana Grande, Dua Lipa and more</p>
          </div>
          <div class="content-card content-card-small">
            <div class="card-image card-image-small" style="background: linear-gradient(135deg, #A8E6CF, #FFD93D);"></div>
            <h3 class="card-title card-title-small">Tunes</h3>
            <p class="card-description card-description-small">Your weekly mixtape of fresh music</p>
          </div>
          <div class="content-card content-card-small">
            <div class="card-image card-image-small" style="background: linear-gradient(135deg, #FAD0C4, #FFD1FF);"></div>
            <h3 class="card-title card-title-small">New Releases</h3>
            <p class="card-description card-description-small">Catch all the latest music from artists you follow</p>
          </div>
          <div class="content-card content-card-small">
            <div class="card-image card-image-small" style="background: linear-gradient(135deg, #84FAB0, #8FD3F4);"></div>
            <h3 class="card-title card-title-small">Liked Songs</h3>
            <p class="card-description card-description-small">382 liked songs</p>
          </div>
        </div>
      </div>

  </div>
      <!-- Track rows will be injected here -->
      <div id="spotifyTrackCardsSection" style="margin:2.5rem 0 2.5rem 0;">
        <!-- Spotify-style track cards will be injected here -->
      </div>

      <!-- Copyright Footer -->
      <div class="copyright-footer">
        © 2025 <span style="color: #FFD700; font-weight: 600;">Hertz</span> Music Platform by Beniam Endale Tedla. All rights reserved.
      </div>

      </div>
    </main>
  </div>

  <!-- Sticky Player (identical to offline.html) -->
  <div class="sticky-player" id="stickyPlayer" style="display:none; flex-direction:column;">
    <div style="display:flex;align-items:center;width:100%;">
      <div class="player-controls">
        <button class="player-btn" id="prevBtn" title="Previous">&#9198;</button>
        <button class="player-btn" id="playPauseBtn" title="Play/Pause">&#9654;</button>
        <button class="player-btn" id="nextBtn" title="Next">&#9197;</button>
        <button class="player-btn player-loop" id="loopBtn" title="Loop">&#128257;</button>
        <button class="player-btn player-shuffle" id="shuffleBtn" title="Shuffle">&#128256;</button>
        <label for="volumeRange" style="margin-left:1rem;color:#b3b3b3;font-size:0.95em;">Volume</label>
        <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="0.7" style="width:100px;">
      </div>
      <span class="player-title" id="playerTrackTitle"></span>
      <div style="display:flex;align-items:center;gap:0.7rem;width:320px;max-width:90%;">
        <span id="currentTime" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
        <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1" style="flex:1;">
        <span id="duration" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
      </div>
      <button id="likeBtn" title="Like" style="margin-left:1.5rem;background:none;border:none;cursor:pointer;font-size:1.7rem;color:#b3b3b3;transition:color 0.2s;">&#10084;</button>
    </div>
    <audio id="playerAudio" class="player-audio"></audio>
  </div>

  <!-- Spotify-style Bottom Navigation -->
  <div class="bottom-nav">
    <button class="bottom-nav-item active" onclick="goToHome()">
      <div class="bottom-nav-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2.1L1 12h3v9h6v-6h4v6h6v-9h3L12 2.1z"/>
        </svg>
      </div>
      <div class="bottom-nav-label">Home</div>
    </button>
    <button class="bottom-nav-item" onclick="openSearchPopup()">
      <div class="bottom-nav-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
      </div>
      <div class="bottom-nav-label">Search</div>
    </button>
    <button class="bottom-nav-item" onclick="openLikedPage()">
      <div class="bottom-nav-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
      </div>
      <div class="bottom-nav-label">Liked</div>
    </button>
    <button class="bottom-nav-item" onclick="openAccountPage()">
      <div class="bottom-nav-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
      </div>
      <div class="bottom-nav-label">Account</div>
    </button>
    <button class="bottom-nav-item" onclick="openSettingsPage()">
      <div class="bottom-nav-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
        </svg>
      </div>
      <div class="bottom-nav-label">Settings</div>
    </button>
  </div>

  <!-- Search Popup Overlay -->
  <div class="search-popup-overlay" id="searchPopupOverlay" onclick="closeSearchPopup(event)">
    <div class="search-popup" onclick="event.stopPropagation()">
      <div class="search-header">
        <h3>Search</h3>
        <button class="search-close-btn" onclick="closeSearchPopup()">×</button>
        <div class="search-container">
          <input type="text" id="popupSearchInput" class="search-box"
                 placeholder="What do you want to listen to?"
                 oninput="handleSearchInput(this.value)"
                 onblur="hidePopupSearchSuggestions()"
                 onfocus="showPopupSearchSuggestions(this.value)">
          <div class="search-icon">🔍</div>
        </div>
      </div>

      <div class="search-content">
        <!-- Recent Searches -->
        <div class="recent-searches" id="recentSearches" style="display: none;">
          <div class="recent-searches-header">
            <span>Recent searches</span>
            <button class="clear-recent-btn" onclick="clearRecentSearches()">Clear recent searches</button>
          </div>
          <div id="recentSearchesList"></div>
        </div>

        <!-- Browse Categories -->
        <div class="browse-categories" id="browseCategories">
          <h4 style="color: var(--text-primary); font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; transition: color 0.3s ease;">Browse all</h4>
          <div class="search-categories">
            <div class="search-category" onclick="searchCategory('pop')" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52);">
              <span class="search-category-icon">🎵</span>
              <span class="search-category-title">Pop</span>
            </div>
            <div class="search-category" onclick="searchCategory('rock')" style="background: linear-gradient(135deg, #4ecdc4, #44a08d);">
              <span class="search-category-icon">🎸</span>
              <span class="search-category-title">Rock</span>
            </div>
            <div class="search-category" onclick="searchCategory('hip-hop')" style="background: linear-gradient(135deg, #45b7d1, #96c93d);">
              <span class="search-category-icon">🎤</span>
              <span class="search-category-title">Hip-Hop</span>
            </div>
            <div class="search-category" onclick="searchCategory('electronic')" style="background: linear-gradient(135deg, #667eea, #764ba2);">
              <span class="search-category-icon">🎛️</span>
              <span class="search-category-title">Electronic</span>
            </div>
            <div class="search-category" onclick="searchCategory('jazz')" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
              <span class="search-category-icon">🎺</span>
              <span class="search-category-title">Jazz</span>
            </div>
            <div class="search-category" onclick="searchCategory('classical')" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
              <span class="search-category-icon">🎼</span>
              <span class="search-category-title">Classical</span>
            </div>
            <div class="search-category" onclick="searchCategory('indie')" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
              <span class="search-category-icon">🎹</span>
              <span class="search-category-title">Indie</span>
            </div>
            <div class="search-category" onclick="searchCategory('country')" style="background: linear-gradient(135deg, #fa709a, #fee140);">
              <span class="search-category-icon">🤠</span>
              <span class="search-category-title">Country</span>
            </div>
            <div class="search-category" onclick="searchCategory('reggae')" style="background: linear-gradient(135deg, #a8edea, #fed6e3);">
              <span class="search-category-icon">🌴</span>
              <span class="search-category-title">Reggae</span>
            </div>
            <div class="search-category" onclick="searchCategory('ambient')" style="background: linear-gradient(135deg, #d299c2, #fef9d7);">
              <span class="search-category-icon">🌙</span>
              <span class="search-category-title">Ambient</span>
            </div>
          </div>
        </div>

        <!-- Search Results -->
        <div class="search-results" id="searchResults">
          <div class="search-results-header">Search results</div>
          <div id="searchResultsList"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Page Overlays -->
  <div class="page-overlay" id="likedPageOverlay">
    <div class="page-content">
      <div class="page-header">
        <h1 class="page-title">❤️ Liked Songs</h1>
        <button class="page-close-btn" onclick="closePage('likedPageOverlay')">Close</button>
      </div>
      <div id="likedSongsContent">
        <div style="text-align: center; padding: 2rem; color: #b3b3b3;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">🎵</div>
          <h3 style="color: #fff; margin-bottom: 1rem;">No Liked Songs Yet</h3>
          <p>Songs you like will appear here. Start exploring and like your favorite tracks!</p>
        </div>
      </div>
    </div>
  </div>

  <div class="page-overlay" id="accountPageOverlay">
    <div class="page-content">
      <div class="page-header">
        <h1 class="page-title">👤 Account</h1>
        <button class="page-close-btn" onclick="closePage('accountPageOverlay')">Close</button>
      </div>
      <div id="accountContent">
        <!-- Profile Section (Only) -->
        <div class="track-list">
          <h3 class="section-title">👤 Profile Information</h3>
          <div style="display: flex; align-items: center; gap: 2rem; margin-bottom: 1.5rem;">
            <div id="userAvatar" style="width: 100px; height: 100px; background: linear-gradient(45deg, #1db954, #1ed760); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: white; font-weight: bold; background-size: cover; background-position: center; border: 2px solid #FFD700;">ML</div>
            <div style="flex: 1;">
              <h2 id="userName" style="color: #fff; margin-bottom: 0.5rem; font-size: 1.8rem;">Music Lover</h2>
              <p id="userUsername" style="color: #FFD700; margin-bottom: 0.3rem; font-weight: 500;">@username</p>
              <p id="userEmail" style="color: #b3b3b3; margin-bottom: 0.3rem;">📧 <span id="profileEmail"></span></p>
              <p id="userCountry" style="color: #b3b3b3; margin-bottom: 0.3rem;">🌍 Country: Not specified</p>
              <p id="userBio" style="color: #b3b3b3; margin-bottom: 0.3rem; font-style: italic;">✨ Bio: Tell us about yourself...</p>
              <p id="memberSince" style="color: #b3b3b3; margin-bottom: 0.3rem;">📅 Member Since: January 2025</p>
              <p id="userPlan" style="color: #1db954; font-weight: bold;">🎵 Free Plan</p>
            </div>
          </div>
          <!-- Stats -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">
            <div style="background: #333; padding: 1rem; border-radius: 8px; text-align: center;">
              <div id="likedSongsCount" style="font-size: 1.5rem; color: #1db954; font-weight: bold;">0</div>
              <div style="color: #b3b3b3; font-size: 0.9rem;">Liked Songs</div>
            </div>
            <div style="background: #333; padding: 1rem; border-radius: 8px; text-align: center;">
              <div id="hoursListenedCount" style="font-size: 1.5rem; color: #1db954; font-weight: bold;">0</div>
              <div style="color: #b3b3b3; font-size: 0.9rem;">Hours Listened</div>
            </div>
            <div style="background: #333; padding: 1rem; border-radius: 8px; text-align: center;">
              <div id="playlistsCount" style="font-size: 1.5rem; color: #1db954; font-weight: bold;">0</div>
              <div style="color: #b3b3b3; font-size: 0.9rem;">Playlists</div>
            </div>
            <div style="background: #333; padding: 1rem; border-radius: 8px; text-align: center;">
              <div id="artistsFollowedCount" style="font-size: 1.5rem; color: #1db954; font-weight: bold;">0</div>
              <div style="color: #b3b3b3; font-size: 0.9rem;">Artists Followed</div>
            </div>
          </div>
        </div>
        <!-- Upgrade to Premium Button (shows same modal as Hertz25App.html) -->
        <div style="margin-top:2rem; text-align:center;">
          <button class="upgrade-btn" id="openPaymentModalBtnAccount" style="background: white; color: #1db954; border: none; padding: 0.8rem 1.5rem; border-radius: 25px; font-weight: bold; cursor: pointer;">
            Upgrade to Premium
          </button>
        </div>
        <script>
        // Set profile email from Account25App.html
        document.addEventListener('DOMContentLoaded', function() {
          var email = localStorage.getItem('accountEmail');
          document.getElementById('profileEmail').textContent = email ? email : 'No email set';
        });
        // Upgrade to Premium button logic (show same modal as Hertz25App.html)
        document.getElementById('openPaymentModalBtnAccount').onclick = function() {
          var modal = document.getElementById('paymentModal');
          if(modal) { modal.style.display = 'flex'; document.body.style.overflow = 'hidden'; }
        };
        </script>

        <!-- Activity & Data -->
        <div class="track-list">
          <h3 class="section-title">📊 Activity & Data</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <button class="upload-btn" onclick="viewHistory()" style="background: linear-gradient(45deg, #6c5ce7, #a29bfe);">
              🎵 Listening History
            </button>
            <button class="upload-btn" onclick="downloadData()" style="background: linear-gradient(45deg, #e17055, #fdcb6e);">
              📥 Download My Data
            </button>
            <button class="upload-btn" onclick="shareProfile()" style="background: linear-gradient(45deg, #00cec9, #81ecec);">
              📤 Share Profile
            </button>
            <button class="upload-btn" onclick="connectSocial()" style="background: linear-gradient(45deg, #fd79a8, #fdcb6e);">
              🔗 Connect Social
            </button>
          </div>
        </div>

        <!-- Danger Zone -->
        <div class="track-list">
          <h3 class="section-title" style="color: #ff4757;">⚠️ Danger Zone</h3>
          <div style="border: 2px solid #ff4757; border-radius: 8px; padding: 1rem; background: rgba(255, 71, 87, 0.1);">
            <p style="color: #ff4757; margin-bottom: 1rem; font-weight: bold;">These actions cannot be undone. Please proceed with caution.</p>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
              <button class="upload-btn" onclick="deactivateAccount()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a52);">
                ⏸️ Deactivate Account
              </button>
              <button class="upload-btn" onclick="deleteAccount()" style="background: linear-gradient(45deg, #d63031, #ff7675);">
                🗑️ Delete Account
              </button>
            </div>
          </div>
        </div>

        <!-- Copyright Footer -->
        <div style="text-align: center; padding: 2rem 1rem 1rem 1rem; margin-top: 2rem; border-top: 1px solid #404040;">
          <div style="color: #b3b3b3; font-size: 0.85rem; margin-bottom: 0.5rem;">
            © 2025 <span style="color: #FFD700; font-weight: 600;">Hertz</span> Music Platform by Beniam Endale Tedla. All rights reserved.
          </div>
          <div style="color: #666; font-size: 0.75rem;">
            Built with ❤️ for music lovers worldwide
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="page-overlay" id="settingsPageOverlay">
    <div class="page-content">
      <div class="page-header">
        <h1 class="page-title">⚙️ Settings</h1>
        <button class="page-close-btn" onclick="closePage('settingsPageOverlay')">Close</button>
      </div>
      <div id="settingsContent">
        <!-- Audio Settings -->
        <div class="track-list">
          <h3 class="section-title">🔊 Audio Settings</h3>
          <div style="padding: 1rem 0;">
            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: var(--accent-color); font-weight: bold; margin-bottom: 0.5rem; transition: color 0.3s ease;">Master Volume</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <span style="color: var(--text-secondary); transition: color 0.3s ease;">🔉</span>
                <input type="range" id="masterVolume" min="0" max="100" value="70" style="flex: 1; height: 6px; background: var(--bg-quaternary); border-radius: 3px; outline: none;">
                <span style="color: var(--text-secondary); transition: color 0.3s ease;">🔊</span>
                <span id="volumeDisplay" style="color: var(--accent-color); font-weight: bold; min-width: 35px; transition: color 0.3s ease;">70%</span>
              </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: var(--accent-color); font-weight: bold; margin-bottom: 0.5rem; transition: color 0.3s ease;">Audio Quality</label>
              <select id="audioQuality" style="background: var(--bg-tertiary); color: var(--text-primary); border: 2px solid var(--border-color); padding: 0.8rem; border-radius: 12px; width: 100%; font-size: 1rem; transition: all 0.3s ease;">
                <option value="low">💿 Low (96 kbps) - Data Saver</option>
                <option value="normal" selected>🎵 Normal (160 kbps) - Balanced</option>
                <option value="high">🎶 High (320 kbps) - Premium Quality</option>
                <option value="lossless">💎 Lossless - Audiophile</option>
              </select>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: var(--accent-color); font-weight: bold; margin-bottom: 0.5rem; transition: color 0.3s ease;">Equalizer Preset</label>
              <select id="equalizerPreset" style="background: var(--bg-tertiary); color: var(--text-primary); border: 2px solid var(--border-color); padding: 0.8rem; border-radius: 12px; width: 100%; font-size: 1rem; transition: all 0.3s ease;">
                <option value="flat">🎚️ Flat - No Enhancement</option>
                <option value="pop">🎤 Pop - Vocal Focus</option>
                <option value="rock">🎸 Rock - Guitar & Drums</option>
                <option value="jazz">🎺 Jazz - Smooth & Warm</option>
                <option value="classical">🎼 Classical - Orchestral</option>
                <option value="electronic">🎛️ Electronic - Bass Heavy</option>
                <option value="bass">🔊 Bass Boost</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Playback Settings -->
        <div class="track-list">
          <h3 class="section-title">▶️ Playback Settings</h3>
          <div style="padding: 1rem 0;">
            <label style="display: flex; align-items: center; justify-content: space-between; color: var(--text-secondary); margin-bottom: 1rem; cursor: pointer; padding: 0.5rem; background: var(--bg-quaternary); border-radius: 8px; transition: all 0.3s ease;">
              <span style="display: flex; align-items: center; gap: 0.5rem;">
                <span>🔄</span>
                <span>Autoplay similar tracks when queue ends</span>
              </span>
              <input type="checkbox" id="autoplay" style="transform: scale(1.2);">
            </label>


            <label style="display: flex; align-items: center; justify-content: space-between; color: var(--text-secondary); margin-bottom: 1rem; cursor: pointer; padding: 0.5rem; background: var(--bg-quaternary); border-radius: 8px; transition: all 0.3s ease;">
              <span style="display: flex; align-items: center; gap: 0.5rem;">
                <span>🎵</span>
                <span>Crossfade between tracks (smooth transitions)</span>
              </span>
              <input type="checkbox" id="crossfade" style="transform: scale(1.2);">
            </label>

            <label id="remoteControlLabel" style="display: flex; align-items: center; justify-content: space-between; color: var(--text-secondary); margin-bottom: 1rem; cursor: pointer; padding: 0.5rem; background: var(--bg-quaternary); border-radius: 8px; transition: all 0.3s ease; position: relative;">
              <span style="display: flex; align-items: center; gap: 0.5rem;">
                <span>📱</span>
                <span>Allow control from other devices</span>
              </span>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="checkbox" id="remoteControl" checked style="transform: scale(1.2);">
                <button id="addBluetoothDeviceBtn" type="button" style="background: #0066ff; color: #fff; border: none; border-radius: 50%; width: 28px; height: 28px; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; cursor: pointer; margin-left: 0.5rem;">+</button>
              </div>
            </label>
            <div id="selectedBluetoothDevice" style="margin: 0 0 1rem 2.5rem; color: #FFD700; font-weight: 600; display: none;"></div>

            <!-- Bluetooth Popup Modal -->
            <div id="bluetoothPopup" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
              <div style="background:#232526; padding:2rem 2.5rem; border-radius:18px; box-shadow:0 4px 24px #000a; min-width:320px; max-width:90vw; margin:auto; display:flex; flex-direction:column; align-items:center;">
                <h3 style="color:#FFD700; margin-bottom:1.2rem;">Add Bluetooth Device</h3>
                <div id="bluetoothDeviceList" style="width:100%; margin-bottom:1.5rem; color:#fff; text-align:left;"></div>
                <button id="closeBluetoothPopup" style="background:#444; color:#fff; border:none; border-radius:8px; padding:0.5rem 1.5rem; font-size:1rem; cursor:pointer;">Cancel</button>
              </div>
            </div>
<script>
// --- Simple WebSocket Remote Control ---
// Uses public relay: wss://ws.postman-echo.com/raw (for demo/testing)
let ws = null;
let wsRoom = '';
let wsIsHost = false;
function openWebSocketRoom(room) {
  if (ws) ws.close();
  wsRoom = room;
  ws = new WebSocket('wss://ws.postman-echo.com/raw');
  ws.onopen = () => {
    ws.send(JSON.stringify({ join: room }));
    if (wsIsHost) document.getElementById('wsStatus').textContent = 'Connected as host';
    else document.getElementById('wsStatus').textContent = 'Connected as guest';
  };
  ws.onclose = () => {
    document.getElementById('wsStatus').textContent = 'Disconnected';
  };
  ws.onerror = () => {
    document.getElementById('wsStatus').textContent = 'WebSocket error';
  };
  ws.onmessage = (event) => {
    try {
      const msg = JSON.parse(event.data);
      if (msg.room !== wsRoom) return;
      if (msg.cmd === 'play') document.getElementById('playPauseBtn')?.click();
      if (msg.cmd === 'pause') document.getElementById('playPauseBtn')?.click();
      if (msg.cmd === 'next') document.getElementById('nextBtn')?.click();
      if (msg.cmd === 'prev') document.getElementById('prevBtn')?.click();
      if (msg.cmd && msg.cmd.startsWith('search:')) {
        const query = msg.cmd.slice(7);
        const searchInput = document.querySelector('input[type="search"], input#searchBar, input.search-bar');
        if (searchInput) {
          searchInput.focus();
          searchInput.value = query;
          searchInput.dispatchEvent(new Event('input', { bubbles: true }));
        }
      }
      if (msg.cmd === 'openmenu') document.getElementById('hamburgerMenu')?.click();
      if (msg.cmd && msg.cmd.startsWith('selectpage:')) {
        const page = msg.cmd.slice(11);
        const navLinks = document.querySelectorAll('.nav-dropdown .nav-btn, .nav-btn');
        for (const link of navLinks) {
          if (link.getAttribute('href') === page || link.textContent.trim().toLowerCase().includes(page.trim().toLowerCase())) {
            link.click();
            break;
          }
        }
      }
    } catch {}
  };
}
function sendWsCmd(cmd) {
  if (ws && ws.readyState === 1 && wsRoom) {
    ws.send(JSON.stringify({ room: wsRoom, cmd }));
  }
}
// UI for remote control
document.addEventListener('DOMContentLoaded', function() {
  const wsDiv = document.createElement('div');
  wsDiv.style = 'margin:1rem 0 1rem 0; padding:1rem; background:#181818; border-radius:10px; color:#FFD700;';
  wsDiv.innerHTML = `
    <b>Remote Control (WebSocket)</b><br>
    <input id="wsRoomInput" placeholder="Enter room code" style="margin:0.5rem 0.5rem 0.5rem 0; padding:0.3rem; border-radius:5px; border:1px solid #FFD700;" />
    <button id="wsHostBtn" style="margin-right:0.5rem;">Host</button>
    <button id="wsJoinBtn">Join</button>
    <span id="wsStatus" style="margin-left:1rem; color:#FFD700;">Not connected</span>
  `;
  const settings = document.querySelector('.track-list');
  if (settings) settings.parentNode.insertBefore(wsDiv, settings);
  document.getElementById('wsHostBtn').onclick = () => {
    wsIsHost = true;
    openWebSocketRoom(document.getElementById('wsRoomInput').value.trim());
    setTimeout(() => {
      alert('Connectivity Check:\n\nAttempting to connect as Host.\n\nPlease ensure Bluetooth is enabled and both devices are discoverable.');
    }, 300);
  };
  document.getElementById('wsJoinBtn').onclick = () => {
    wsIsHost = false;
    openWebSocketRoom(document.getElementById('wsRoomInput').value.trim());
    setTimeout(() => {
      alert('Connectivity Check:\n\nAttempting to join session.\n\nPlease ensure Bluetooth is enabled and both devices are discoverable.');
    }, 300);
  };
  // Send commands on local actions
  document.getElementById('playPauseBtn')?.addEventListener('click', () => {
    const audio = document.getElementById('playerAudio');
    sendWsCmd(audio.paused ? 'pause' : 'play');
  });
  document.getElementById('nextBtn')?.addEventListener('click', () => sendWsCmd('next'));
  document.getElementById('prevBtn')?.addEventListener('click', () => sendWsCmd('prev'));
  const searchInput = document.querySelector('input[type="search"], input#searchBar, input.search-bar');
  if (searchInput) {
    searchInput.addEventListener('change', () => {
      sendWsCmd('search:' + searchInput.value);
    });
  }
  const hamburgerMenu = document.getElementById('hamburgerMenu');
  if (hamburgerMenu) {
    hamburgerMenu.addEventListener('click', () => {
      sendWsCmd('openmenu');
    });
  }
  document.querySelectorAll('.nav-dropdown .nav-btn, .nav-btn').forEach(link => {
    link.addEventListener('click', () => {
      const href = link.getAttribute('href') || link.textContent.trim();
      sendWsCmd('selectpage:' + href);
    });
  });
});
// Bluetooth device selection logic for Allow control from other devices
document.addEventListener('DOMContentLoaded', function() {
  const addBtn = document.getElementById('addBluetoothDeviceBtn');
  const popup = document.getElementById('bluetoothPopup');
  const closeBtn = document.getElementById('closeBluetoothPopup');
  const deviceListDiv = document.getElementById('bluetoothDeviceList');
  const selectedDiv = document.getElementById('selectedBluetoothDevice');
  let selectedDevice = null;

  // Use Web Bluetooth API for real device discovery
  addBtn.addEventListener('click', async function(e) {
    e.preventDefault();
    popup.style.display = 'flex';
    deviceListDiv.innerHTML = '<div style="color:#FFD700;">Scanning for Bluetooth devices...</div>';
    try {
      // Request Bluetooth device (scan for paired devices advertising standard services: Media Control, HID, or custom)
      const device = await navigator.bluetooth.requestDevice({
        acceptAllDevices: true,
        optionalServices: [
          'media_control',
          'human_interface_device',
          'generic_access',
          'generic_attribute',
          '0000abcd-0000-1000-8000-00805f9b34fb'
        ]
      });
      // Show the device in the list
  deviceListDiv.innerHTML = `<button type="button" data-id="${device.id}" style="width:100%;margin-bottom:0.5rem;padding:0.7rem 1rem;background:#181818;color:#FFD700;border:none;border-radius:8px;font-size:1rem;cursor:pointer;text-align:left;">${device.name || 'Unnamed Device'}</button>`;
      // Add click listener
      const btn = deviceListDiv.querySelector('button');
      btn.onclick = async function() {
        selectedDevice = device;
        selectedDiv.textContent = `Connected: ${device.name || 'Unnamed Device'}`;
        selectedDiv.style.display = 'block';
        popup.style.display = 'none';
        // Connect to GATT server and enable track control communication
        try {
          const server = await device.gatt.connect();
          // Try standard Media Control Service first, then fallback to custom
          let controlChar = null;
          let service = null;
          try {
            // Try Media Control Service (standard)
            service = await server.getPrimaryService('media_control');
            // Try to get characteristic for media control (play/pause/next/prev)
            // This is a placeholder, as the actual characteristic UUIDs may vary by device
            controlChar = await service.getCharacteristic('00002b93-0000-1000-8000-00805f9b34fb'); // Media Control Point
          } catch (e) {
            try {
              // Try HID Service (standard)
              service = await server.getPrimaryService('human_interface_device');
              // Try to get a characteristic (this is a placeholder, as HID is complex)
              controlChar = await service.getCharacteristic('00002a4d-0000-1000-8000-00805f9b34fb'); // HID Report
            } catch (e2) {
              try {
                // Fallback to custom service/characteristic
                service = await server.getPrimaryService('0000abcd-0000-1000-8000-00805f9b34fb');
                controlChar = await service.getCharacteristic('0000dcba-0000-1000-8000-00805f9b34fb');
              } catch (e3) {
                // Service/characteristic not found, show error
                selectedDiv.textContent = 'Device does not support remote control';
                setTimeout(() => { selectedDiv.style.display = 'none'; }, 2000);
                return;
              }
            }
          }

          // Listen for remote control commands (if supported)
          if (controlChar.properties.notify) {
            await controlChar.startNotifications();
            controlChar.addEventListener('characteristicvaluechanged', event => {
              const value = new TextDecoder().decode(event.target.value);
              // Handle received command: 'play', 'pause', 'next', 'prev', 'search:<query>', 'openmenu', 'selectpage:<page>'
              if (value === 'play') document.getElementById('playPauseBtn')?.click();
              if (value === 'pause') document.getElementById('playPauseBtn')?.click();
              if (value === 'next') document.getElementById('nextBtn')?.click();
              if (value === 'prev') document.getElementById('prevBtn')?.click();
              if (value.startsWith('search:')) {
                const query = value.slice(7);
                const searchInput = document.querySelector('input[type="search"], input#searchBar, input.search-bar');
                if (searchInput) {
                  searchInput.focus();
                  searchInput.value = query;
                  // Trigger input event for live search
                  searchInput.dispatchEvent(new Event('input', { bubbles: true }));
                }
              }
              if (value === 'openmenu') {
                document.getElementById('hamburgerMenu')?.click();
              }
              if (value.startsWith('selectpage:')) {
                const page = value.slice(11);
                // Find nav link by href or text and click it
                const navLinks = document.querySelectorAll('.nav-dropdown .nav-btn, .nav-btn');
                for (const link of navLinks) {
                  if (link.getAttribute('href') === page || link.textContent.trim().toLowerCase().includes(page.trim().toLowerCase())) {
                    link.click();
                    break;
                  }
                }
              }
            });
          }

          // Send local control commands to the connected device
          function sendControlCommand(cmd) {
            if (controlChar && controlChar.properties.write) {
              const data = new TextEncoder().encode(cmd);
              controlChar.writeValue(data).catch(() => {});
            }
          }
          // Attach to local player controls
          document.getElementById('playPauseBtn')?.addEventListener('click', () => {
            const audio = document.getElementById('playerAudio');
            sendControlCommand(audio.paused ? 'pause' : 'play');
          });
          document.getElementById('nextBtn')?.addEventListener('click', () => sendControlCommand('next'));
          document.getElementById('prevBtn')?.addEventListener('click', () => sendControlCommand('prev'));
          // Attach to search bar (send search:<query> command)
          const searchInput = document.querySelector('input[type="search"], input#searchBar, input.search-bar');
          if (searchInput) {
            searchInput.addEventListener('change', () => {
              sendControlCommand('search:' + searchInput.value);
            });
          }
          // Attach to hamburger menu (send openmenu command)
          const hamburgerMenu = document.getElementById('hamburgerMenu');
          if (hamburgerMenu) {
            hamburgerMenu.addEventListener('click', () => {
              sendControlCommand('openmenu');
            });
          }
          // Attach to nav links (send selectpage:<page> command)
          document.querySelectorAll('.nav-dropdown .nav-btn, .nav-btn').forEach(link => {
            link.addEventListener('click', () => {
              const href = link.getAttribute('href') || link.textContent.trim();
              sendControlCommand('selectpage:' + href);
            });
          });

          // Listen for disconnect
          device.addEventListener('gattserverdisconnected', () => {
            selectedDiv.textContent = 'Device disconnected';
            setTimeout(() => { selectedDiv.style.display = 'none'; }, 2000);
          });
        } catch (err) {
          selectedDiv.textContent = 'Failed to connect to device';
          setTimeout(() => { selectedDiv.style.display = 'none'; }, 2000);
        }
      };
    } catch (err) {
      if (err?.name === 'NotFoundError') {
        deviceListDiv.innerHTML = '<div style="color:#e17055;">No device selected.</div>';
      } else if (!navigator.bluetooth) {
        deviceListDiv.innerHTML = '<div style="color:#e17055;">Bluetooth not available in this browser. Please use Chrome, Edge, or a supported browser and enable Bluetooth.</div>';
      } else {
        deviceListDiv.innerHTML = `<div style="color:#e17055;">Bluetooth error: ${err.message || err}</div>`;
      }
    }
  });
  closeBtn.addEventListener('click', function() {
    popup.style.display = 'none';
  });
  // Hide popup if clicking outside modal
  popup.addEventListener('mousedown', function(e) {
    if (e.target === popup) popup.style.display = 'none';
  });
});
</script>

            <div style="margin-top: 1.5rem;">
              <label style="display: block; color: var(--accent-color); font-weight: bold; margin-bottom: 0.5rem; transition: color 0.3s ease;">Crossfade Duration</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <span style="color: var(--text-secondary); transition: color 0.3s ease;">0s</span>
                <input type="range" id="crossfadeDuration" min="0" max="10" value="3" step="1" style="flex: 1; height: 6px; background: var(--bg-quaternary); border-radius: 3px;">
                <span style="color: var(--text-secondary); transition: color 0.3s ease;">10s</span>
                <span id="crossfadeDisplay" style="color: var(--accent-color); font-weight: bold; min-width: 25px; transition: color 0.3s ease;">3s</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Display & Interface -->
        <div class="track-list">
          <h3 class="section-title">🎨 Display & Interface</h3>
          <div style="padding: 1rem 0;">
            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: var(--accent-color); font-weight: bold; margin-bottom: 0.5rem; transition: color 0.3s ease;">Theme</label>
              <select id="theme" style="background: var(--bg-tertiary); color: #ffb700; border: 2px solid var(--border-color); padding: 0.8rem; border-radius: 12px; width: 100%; font-size: 1rem; transition: all 0.3s ease;">
                <option value="dark" selected>🌙 Dark Mode</option>
                <option value="light">☀️ Light Mode</option>
                <option value="auto">🔄 Auto (System)</option>
                <option value="green">💚 Green Nature</option>
                <option value="ocean-blue">💙 Ocean Blue</option>
                <option value="purple-vibes">💜 Purple Vibes</option>
              </select>
            </div>

            <label style="display: flex; align-items: center; justify-content: space-between; color: var(--text-secondary); margin-bottom: 1rem; cursor: pointer; padding: 0.5rem; background: var(--bg-quaternary); border-radius: 8px; transition: all 0.3s ease;">
              <span style="display: flex; align-items: center; gap: 0.5rem;">
                <span>✨</span>
                <span>Show animated visualizations</span>
              </span>
              <input type="checkbox" id="visualizations" checked style="transform: scale(1.2);">
            </label>

          </div>
        </div>

  <!-- Privacy & Security section removed -->

        <!-- Data & Storage -->
        <div class="track-list">
          <h3 class="section-title">💾 Data & Storage</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <button class="upload-btn" onclick="resetSettings()" style="background: linear-gradient(45deg, #6c5ce7, #a29bfe); display: flex; align-items: center; gap: 0.5rem; justify-content: center;">
              <span>🔄</span> Reset Settings
            </button>
          </div>

          <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-quaternary); border-radius: 8px; transition: background-color 0.3s ease;">
            <p style="color: var(--accent-color); font-weight: bold; margin-bottom: 0.5rem; transition: color 0.3s ease;">Storage Usage</p>
            <div style="background: var(--bg-primary); border-radius: 4px; height: 8px; margin-bottom: 0.5rem; transition: background-color 0.3s ease;">
              <div style="background: linear-gradient(90deg, var(--accent-color), var(--accent-color)); height: 100%; width: 35%; border-radius: 4px; transition: background 0.3s ease;"></div>
            </div>
            <p style="color: var(--text-secondary); font-size: 0.9rem; transition: color 0.3s ease;">3.2 GB used of 10 GB available</p>
          </div>
        </div>

  <!-- Advanced section removed -->

        <!-- Copyright Footer -->
        <div style="text-align: center; padding: 2rem 1rem 1rem 1rem; margin-top: 2rem; border-top: 1px solid #404040;">
          <div style="color: #b3b3b3; font-size: 0.85rem; margin-bottom: 0.5rem;">
            © 2025 <span style="color: #FFD700; font-weight: 600;">HZ</span> Music Streamer by Beniam Endale Tedla. All rights reserved.
          </div>
          <div style="color: #666; font-size: 0.75rem;">
            Built with ❤️ for music lovers worldwide
          </div>
        </div>
      </div>
    </div>
  </div>  <script>
    // Hamburger Menu Functionality
    function initializeHamburgerMenu() {
        console.log('🍔 Initializing hamburger menu...');
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const navDropdown = document.getElementById('navDropdown');

        console.log('Elements found:', {
            hamburgerMenu: !!hamburgerMenu,
            navDropdown: !!navDropdown
        });

        if (!hamburgerMenu || !navDropdown) {
            console.error('❌ Hamburger menu elements not found!');
            return;
        }

        let isMenuOpen = false;

        function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            console.log('🔄 Toggling menu. Open:', isMenuOpen);
            hamburgerMenu.classList.toggle('active', isMenuOpen);
            navDropdown.classList.toggle('show', isMenuOpen);
        }

        function closeMenu() {
            isMenuOpen = false;
            console.log('❌ Closing menu');
            hamburgerMenu.classList.remove('active');
            navDropdown.classList.remove('show');
        }

        // Toggle menu when hamburger is clicked
        hamburgerMenu.addEventListener('click', function(e) {
            e.stopPropagation();
            console.log('🍔 Hamburger clicked!');
            toggleMenu();
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if (isMenuOpen && !navDropdown.contains(e.target) && !hamburgerMenu.contains(e.target)) {
                console.log('👆 Clicked outside menu, closing');
                closeMenu();
            }
        });

        // Close menu when pressing Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isMenuOpen) {
                console.log('⌨️ Escape pressed, closing menu');
                closeMenu();
            }
        });

        // Close menu when a navigation link is clicked
        const navLinks = navDropdown.querySelectorAll('.nav-btn');
        console.log(`📋 Found ${navLinks.length} nav links`);
        navLinks.forEach(link => {
            link.addEventListener('click', function() {
                console.log('🔗 Nav link clicked, closing menu');
                closeMenu();
            });
        });

        console.log('✅ Hamburger menu initialized successfully');
    }

    // Add missing functions to prevent JavaScript errors
    function updateStorageIndicator() {
      // Placeholder function - can be implemented later
      console.log('📊 Storage indicator updated');
    }

    function attachEventListeners() {
      // Placeholder function - can be implemented later
      console.log('🔗 Event listeners attached');
    }

    function updateAllTracksFromRows() {
      // Placeholder function - can be implemented later
      console.log('🎵 All tracks updated from rows');
    }

    // Define missing track data variables to prevent errors
    const mostPopularTracks = [];
    const trendingTracks = [];
    const recommendedTracks = [];
    const hertzMetadata = {
      featured: [],
      trending: [],
      recommended: [],
      tracks: []
    };

    // --- Spotify-style Track Cards Section ---
    function renderSpotifyTrackCards() {
      const container = document.getElementById('spotifyTrackCardsSection');
      if (!container) return;
      container.innerHTML = '';
      // Use first 25 tracks from mostPopularTracks, or fallback to trending/recommended
      const tracks = (typeof mostPopularTracks !== 'undefined' && mostPopularTracks.length >= 25)
        ? mostPopularTracks.slice(0, 25)
        : (typeof trendingTracks !== 'undefined' && trendingTracks.length >= 25)
          ? trendingTracks.slice(0, 25)
          : (typeof recommendedTracks !== 'undefined' && recommendedTracks.length >= 25)
            ? recommendedTracks.slice(0, 25)
            : [];

      const cardsHtml = tracks.map(track => `
        <div class="spotify-track-card" style="background:#232526;border-radius:22px;min-width:140px;max-width:160px;box-shadow:0 2px 8px rgba(0,0,0,0.10);padding:1.1rem 0.7rem 0.9rem 0.7rem;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:transform 0.18s;margin-bottom:1.2rem;">
          <div style='width:90px;height:90px;background:#0066ff;border-radius:20px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,102,255,0.18);margin-bottom:0.7rem;'>
            <span style="color:#fff;font-size:2.1rem;font-weight:700;">${track.title.split(' ').map(w => w[0]).join('').substring(0,2).toUpperCase()}</span>
          </div>
          <div style="font-weight:600;color:#fff;font-size:1.08rem;text-align:center;margin-bottom:${track.artist ? '0.2rem' : '0.7rem'};">${track.title}</div>
          ${track.artist ? `<div style='color:gold;font-size:0.98rem;text-align:center;'>${track.artist}</div>` : ''}
        </div>
      `).join('');

      container.innerHTML = `<div style="display:flex;flex-wrap:wrap;gap:1.2rem;justify-content:center;">${cardsHtml}</div>`;
    }

    // Initialize everything when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🎯 DOM Content Loaded - Initializing...');
      initializeUserData(); // Initialize user settings and account data
      initializeDemoData(); // Add some demo data if none exists
      initializeHamburgerMenu();
      initializeBottomNavigation();
      renderSpotifyTrackCards();

      // Only call functions that exist
      if (typeof initializeTrackCards === 'function') {
        initializeTrackCards();
      }
      if (typeof updateStorageIndicator === 'function') {
        updateStorageIndicator();
      }
    });

    // Add demo data for testing if no user data exists
    function initializeDemoData() {
      // Only add demo data if user has no existing data
      const existingLiked = JSON.parse(localStorage.getItem('hertzLikedTracks') || '{}');
      const existingPlaylists = JSON.parse(localStorage.getItem('hertzPlaylists') || '[]');

      if (Object.keys(existingLiked).length === 0) {
        console.log('📊 Adding demo data for new user...');

        // Add some demo liked tracks
        const demoTracks = {
          'demo1': {
            id: 'demo1',
            title: 'Midnight Dreams',
            artist: 'Luna Echo',
            album: 'Nocturnal Vibes',
            duration: '3:45',
            likedAt: new Date(Date.now() - 86400000).toISOString() // 1 day ago
          },
          'demo2': {
            id: 'demo2',
            title: 'Electric Thunder',
            artist: 'Storm Riders',
            album: 'Lightning Strikes',
            duration: '4:12',
            likedAt: new Date(Date.now() - 172800000).toISOString() // 2 days ago
          },
          'demo3': {
            id: 'demo3',
            title: 'Ocean Waves',
            artist: 'Calm Spirits',
            album: 'Peaceful Journey',
            duration: '5:30',
            likedAt: new Date(Date.now() - 259200000).toISOString() // 3 days ago
          },
          'demo4': {
            id: 'demo4',
            title: 'City Lights',
            artist: 'Urban Soul',
            album: 'Metropolitan',
            duration: '3:28',
            likedAt: new Date(Date.now() - 345600000).toISOString() // 4 days ago
          },
          'demo5': {
            id: 'demo5',
            title: 'Mountain High',
            artist: 'Nature Call',
            album: 'Wilderness',
            duration: '4:55',
            likedAt: new Date(Date.now() - 432000000).toISOString() // 5 days ago
          }
        };

        localStorage.setItem('hertzLikedTracks', JSON.stringify(demoTracks));
        localStorage.setItem('hertzLikedTracksUpdate', Date.now().toString());

        // Add demo playlists
        const demoPlaylists = [
          {
            id: 'playlist1',
            name: 'Favorites',
            tracks: Object.values(demoTracks).slice(0, 3),
            created: new Date(Date.now() - 604800000).toISOString(), // 1 week ago
            description: 'My favorite tracks collection'
          },
          {
            id: 'playlist2',
            name: 'Chill Vibes',
            tracks: [demoTracks.demo3, demoTracks.demo5],
            created: new Date(Date.now() - 518400000).toISOString(), // 6 days ago
            description: 'Perfect for relaxing'
          }
        ];

        localStorage.setItem('hertzPlaylists', JSON.stringify(demoPlaylists));

        // Add demo followed artists
        const demoArtists = [
          { id: 'artist1', name: 'Luna Echo', followed: new Date(Date.now() - 432000000).toISOString(), genre: 'Ambient' },
          { id: 'artist2', name: 'Storm Riders', followed: new Date(Date.now() - 345600000).toISOString(), genre: 'Rock' },
          { id: 'artist3', name: 'Calm Spirits', followed: new Date(Date.now() - 259200000).toISOString(), genre: 'New Age' }
        ];

        localStorage.setItem('hertzFollowedArtists', JSON.stringify(demoArtists));

        // Add some tracked listening time (5 hours = 18000 seconds)
        localStorage.setItem('hertzTotalListeningTime', '18000');

        console.log('✅ Demo data added: 5 liked tracks, 2 playlists, 3 artists, 5 hours listening time');
      }
    }

    // Bottom Navigation Functions
    function initializeBottomNavigation() {
      console.log('📱 Initializing bottom navigation...');

      // Set active state for home button initially
      updateBottomNavActive('home');

      // Add keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'k': // Ctrl+K for search
              e.preventDefault();
              openSearchPopup();
              break;
            case 'h': // Ctrl+H for home
              e.preventDefault();
              goToHome();
              break;
            case 'l': // Ctrl+L for liked
              e.preventDefault();
              openLikedPage();
              break;
          }
        }

        // Escape to close overlays
        if (e.key === 'Escape') {
          closeAllOverlays();
        }
      });

      console.log('✅ Bottom navigation initialized');
    }

    function updateBottomNavActive(activeTab) {
      // Remove active class from all items
      const items = document.querySelectorAll('.bottom-nav-item');
      items.forEach(item => item.classList.remove('active'));

      // Add active class to specific tab if found
      const activeMap = {
        'home': 0,
        'search': 1,
        'liked': 2,
        'account': 3,
        'settings': 4
      };

      if (activeMap[activeTab] !== undefined) {
        items[activeMap[activeTab]]?.classList.add('active');
      }
    }

    function goToHome() {
      console.log('🏠 Going to Home');
      updateBottomNavActive('home');
      closeAllOverlays();

      // Scroll to top smoothly
      window.scrollTo({ top: 0, behavior: 'smooth' });

      // Flash the home section briefly
      const mainContent = document.querySelector('.main-content');
      if (mainContent) {
        mainContent.style.transition = 'background-color 0.3s ease';
        mainContent.style.backgroundColor = 'rgba(29, 185, 84, 0.05)';
        setTimeout(() => {
          mainContent.style.backgroundColor = '';
        }, 300);
      }
    }

    function openSearchPopup() {
      console.log('🔍 Opening search popup');
      updateBottomNavActive('search');

      const overlay = document.getElementById('searchPopupOverlay');
      const input = document.getElementById('popupSearchInput');

      if (overlay && input) {
        overlay.style.display = 'flex';
        loadRecentSearches();
        // Focus the input after animation
        setTimeout(() => {
          input.focus();
        }, 100);
      }
    }

    function closeSearchPopup(event) {
      // Only close if clicking on overlay, not the popup content
      if (!event || event.target.classList.contains('search-popup-overlay')) {
        console.log('❌ Closing search popup');
        const overlay = document.getElementById('searchPopupOverlay');
        if (overlay) {
          overlay.style.display = 'none';
        }
        updateBottomNavActive('home');
      }
    }

    // Enhanced search functionality
    function handleSearchInput(query) {
      const trimmedQuery = query.trim();
      const searchResults = document.getElementById('searchResults');
      const browseCategories = document.getElementById('browseCategories');
      const recentSearches = document.getElementById('recentSearches');

      if (trimmedQuery.length > 0) {
        // Show search results, hide categories and recent searches
        searchResults.classList.add('active');
        browseCategories.style.display = 'none';
        recentSearches.style.display = 'none';
        performSearch(trimmedQuery);
      } else {
        // Show categories and recent searches, hide search results
        searchResults.classList.remove('active');
        browseCategories.style.display = 'block';
        loadRecentSearches();
      }
    }

    function performSearch(query) {
      console.log('🔍 Performing search for:', query);
      const resultsList = document.getElementById('searchResultsList');

      // Save search to recent searches
      saveRecentSearch(query);

      // Mock search results (in a real app, this would be an API call)
      const mockResults = [
        {
          type: 'track',
          title: `${query} - Best Hits`,
          subtitle: 'Various Artists',
          icon: '🎵'
        },
        {
          type: 'artist',
          title: `${query} Artist`,
          subtitle: 'Artist',
          icon: '👤'
        },
        {
          type: 'album',
          title: `The Best of ${query}`,
          subtitle: `${query} Collection`,
          icon: '💿'
        },
        {
          type: 'playlist',
          title: `${query} Mix`,
          subtitle: 'Curated Playlist',
          icon: '📋'
        }
      ];

      const resultsHtml = mockResults.map(result => `
        <div class="search-result-item" onclick="selectSearchResult('${result.type}', '${result.title}')">
          <div class="search-result-icon">${result.icon}</div>
          <div class="search-result-info">
            <div class="search-result-title">${result.title}</div>
            <div class="search-result-subtitle">${result.subtitle}</div>
          </div>
          <button class="search-result-action">Play</button>
        </div>
      `).join('');

      resultsList.innerHTML = resultsHtml;
    }

    function searchCategory(category) {
      console.log('🎵 Searching category:', category);
      const input = document.getElementById('popupSearchInput');
      input.value = category;
      handleSearchInput(category);
      saveRecentSearch(category);
    }

    function selectSearchResult(type, title) {
      console.log('▶️ Selected search result:', type, title);
      alert(`Playing: ${title}`);
      // In a real app, this would start playing the selected item
      closeSearchPopup();
    }

    function saveRecentSearch(query) {
      let recentSearches = JSON.parse(localStorage.getItem('hertzRecentSearches') || '[]');

      // Remove if already exists to move to top
      recentSearches = recentSearches.filter(search => search !== query);

      // Add to beginning
      recentSearches.unshift(query);

      // Keep only last 10 searches
      recentSearches = recentSearches.slice(0, 10);

      localStorage.setItem('hertzRecentSearches', JSON.stringify(recentSearches));
    }

    function loadRecentSearches() {
      const recentSearches = JSON.parse(localStorage.getItem('hertzRecentSearches') || '[]');
      const recentContainer = document.getElementById('recentSearches');
      const recentList = document.getElementById('recentSearchesList');

      if (recentSearches.length > 0) {
        recentContainer.style.display = 'block';
        const recentHtml = recentSearches.map(search => `
          <div class="search-result-item" onclick="selectRecentSearch('${search}')">
            <div class="search-result-icon">🕒</div>
            <div class="search-result-info">
              <div class="search-result-title">${search}</div>
              <div class="search-result-subtitle">Recent search</div>
            </div>
            <button class="search-result-action" onclick="removeRecentSearch('${search}'); event.stopPropagation();">×</button>
          </div>
        `).join('');
        recentList.innerHTML = recentHtml;
      } else {
        recentContainer.style.display = 'none';
      }
    }

    function selectRecentSearch(query) {
      const input = document.getElementById('popupSearchInput');
      input.value = query;
      handleSearchInput(query);
    }

    function removeRecentSearch(query) {
      let recentSearches = JSON.parse(localStorage.getItem('hertzRecentSearches') || '[]');
      recentSearches = recentSearches.filter(search => search !== query);
      localStorage.setItem('hertzRecentSearches', JSON.stringify(recentSearches));
      loadRecentSearches();
    }

    function clearRecentSearches() {
      localStorage.removeItem('hertzRecentSearches');
      loadRecentSearches();
    }

    function openLikedPage() {
      console.log('❤️ Opening liked page');
      updateBottomNavActive('liked');

      const overlay = document.getElementById('likedPageOverlay');
      if (overlay) {
        overlay.style.display = 'block';
        loadLikedSongs();
      }
    }

    function openAccountPage() {
      console.log('👤 Opening account page');
      updateBottomNavActive('account');

      const overlay = document.getElementById('accountPageOverlay');
      if (overlay) {
        overlay.style.display = 'block';
        loadAccountInfo();
      }
    }

    function openSettingsPage() {
      console.log('⚙️ Opening settings page');
      updateBottomNavActive('settings');

      const overlay = document.getElementById('settingsPageOverlay');
      if (overlay) {
        overlay.style.display = 'block';
        loadSettingsInfo();
      }
    }

    function closePage(overlayId) {
      console.log(`❌ Closing page: ${overlayId}`);
      const overlay = document.getElementById(overlayId);
      if (overlay) {
        overlay.style.display = 'none';
      }
      updateBottomNavActive('home');
    }

    function closeAllOverlays() {
      const overlays = document.querySelectorAll('.page-overlay, .search-popup-overlay');
      overlays.forEach(overlay => {
        overlay.style.display = 'none';
      });
      updateBottomNavActive('home');
    }

    // Legacy search functions (kept for compatibility)
    function showPopupSearchSuggestions(query) {
      // This function is now handled by handleSearchInput
      handleSearchInput(query);
    }

    function hidePopupSearchSuggestions() {
      // Function kept for compatibility but functionality moved to handleSearchInput
    }

    // Page Content Loading Functions
    function loadLikedSongs() {
      const content = document.getElementById('likedSongsContent');
      if (!content) return;

      // Get liked songs from localStorage or other storage
      const likedSongs = JSON.parse(localStorage.getItem('hertzLikedTracks') || '[]');

      if (likedSongs.length === 0) {
        content.innerHTML = `
          <div style="text-align: center; padding: 3rem; color: #b3b3b3;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">💔</div>
            <h3 style="color: #fff; margin-bottom: 1rem;">No Liked Songs Yet</h3>
            <p style="margin-bottom: 2rem;">Songs you like will appear here. Start exploring and like your favorite tracks!</p>
            <button onclick="closePage('likedPageOverlay')" class="upload-btn" style="background: linear-gradient(45deg, #1db954, #1ed760);">
              Explore Music
            </button>
          </div>
        `;
      } else {
        let songsHtml = '<div class="track-list"><h3 class="section-title">Your Liked Songs</h3>';

        likedSongs.forEach((song, index) => {
          songsHtml += `
            <div class="track-item">
              <div class="track-info">
                <div class="track-title">${song.title || song.name}</div>
                <div class="track-artist">${song.artist || 'Unknown Artist'}</div>
              </div>
              <button class="play-btn" onclick="playLikedSong('${song.id || index}')">Play</button>
            </div>
          `;
        });

        songsHtml += '</div>';
        content.innerHTML = songsHtml;
      }
    }

    function loadAccountInfo() {
      console.log('👤 Loading account information');

      // Load saved user data from Account25App.html
      const savedUserData = JSON.parse(localStorage.getItem('hertzUser') || '{}');

      // Load user stats from localStorage
      const likedTracks = JSON.parse(localStorage.getItem('hertzLikedTracks') || '[]');
      const username = savedUserData.name || localStorage.getItem('hertzUsername') || 'Music Lover';
      const memberSince = localStorage.getItem('hertzMemberSince') || 'January 2025';
      const userEmail = savedUserData.email || localStorage.getItem('hertzUserEmail') || 'user@hertz.music';

      // Calculate stats based on actual data
      const customTracks = Object.keys(JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}')).length;
      const offlineTracks = JSON.parse(localStorage.getItem('hertzOfflineTracks') || '[]').length;
      const totalTracksInteracted = likedTracks.length + customTracks + offlineTracks;

      // Calculate realistic listening time based on user activity
      const trackedTime = parseInt(localStorage.getItem('hertzTotalListeningTime') || '0');
      const baseHours = 15; // Starting hours for new users
      const hoursFromLiked = likedTracks.length * 3.5; // Average 3.5 hours per liked track
      const hoursFromCustom = customTracks * 2; // 2 hours per uploaded track
      const hoursFromOffline = offlineTracks * 4; // 4 hours per offline track
      const calculatedHours = baseHours + hoursFromLiked + hoursFromCustom + hoursFromOffline;

      // Use tracked time if available and greater than calculated, otherwise use calculated
      const hoursListened = Math.floor(Math.max(trackedTime / 3600, calculatedHours));

      // Calculate playlists (stored or estimated)
      const storedPlaylists = JSON.parse(localStorage.getItem('hertzPlaylists') || '[]');
      const playlistCount = Math.max(storedPlaylists.length, Math.floor(totalTracksInteracted / 8));

      // Calculate followed artists (stored or estimated)
      const followedArtists = JSON.parse(localStorage.getItem('hertzFollowedArtists') || '[]');
      const artistsCount = Math.max(followedArtists.length, Math.floor(totalTracksInteracted / 4));

      // Update profile information
      const userNameElement = document.getElementById('userName');
      const userUsernameElement = document.getElementById('userUsername');
      const userEmailElement = document.getElementById('userEmail');
      const userCountryElement = document.getElementById('userCountry');
      const userBioElement = document.getElementById('userBio');
      const memberSinceElement = document.getElementById('memberSince');
      const userAvatarElement = document.getElementById('userAvatar');

      if (userNameElement) {
        userNameElement.textContent = username;
      }

      if (userUsernameElement) {
        const usernameDisplay = savedUserData.username || username.toLowerCase().replace(/\s+/g, '');
        userUsernameElement.textContent = `@${usernameDisplay}`;
        userUsernameElement.style.display = savedUserData.username ? 'block' : 'none';
      }

      if (userEmailElement) {
        const email = userEmail.includes('@') ? userEmail : `${username.toLowerCase().replace(/\s+/g, '')}@hertz.music`;
        userEmailElement.textContent = `📧 ${email}`;
      }

      if (userCountryElement) {
        if (savedUserData.country) {
          const countryNames = {
            'us': 'United States',
            'uk': 'United Kingdom',
            'ca': 'Canada',
            'au': 'Australia',
            'fr': 'France',
            'de': 'Germany',
            'other': 'Other'
          };
          const countryDisplay = countryNames[savedUserData.country] || savedUserData.country;
          userCountryElement.textContent = `🌍 Country: ${countryDisplay}`;
        } else {
          userCountryElement.textContent = '🌍 Country: Not specified';
        }
      }

      if (userBioElement) {
        if (savedUserData.bio && savedUserData.bio.trim()) {
          userBioElement.textContent = `✨ ${savedUserData.bio}`;
        } else {
          userBioElement.textContent = '✨ Bio: Tell us about yourself...';
        }
      }

      if (memberSinceElement) {
        memberSinceElement.textContent = `📅 Member Since: ${memberSince}`;
      }

      if (userAvatarElement) {
        // Use saved profile image if available, otherwise show initials
        if (savedUserData.img && savedUserData.img !== 'https://ui-avatars.com/api/?name=User&background=232526&color=FFD700') {
          userAvatarElement.style.backgroundImage = `url(${savedUserData.img})`;
          userAvatarElement.style.backgroundSize = 'cover';
          userAvatarElement.style.backgroundPosition = 'center';
          userAvatarElement.textContent = ''; // Clear initials when showing image
        } else {
          // Generate initials from username
          const initials = username.split(' ').map(word => word.charAt(0).toUpperCase()).join('').substring(0, 2);
          userAvatarElement.textContent = initials;
          userAvatarElement.style.backgroundImage = '';
        }
      }

      // Update stats counters
      const likedSongsElement = document.getElementById('likedSongsCount');
      const hoursListenedElement = document.getElementById('hoursListenedCount');
      const playlistsElement = document.getElementById('playlistsCount');
      const artistsElement = document.getElementById('artistsFollowedCount');

      if (likedSongsElement) {
        likedSongsElement.textContent = likedTracks.length;
      }

      if (hoursListenedElement) {
        hoursListenedElement.textContent = hoursListened;
      }

      if (playlistsElement) {
        playlistsElement.textContent = playlistCount;
      }

      if (artistsElement) {
        artistsElement.textContent = artistsCount;
      }

      // Update account preferences from saved data
      const newsletterElement = document.getElementById('newsletterStatus');
      const privacyElement = document.getElementById('privacyStatus');
      const notificationElement = document.getElementById('notificationStatus');

      if (newsletterElement) {
        const isSubscribed = savedUserData.newsletter === true;
        newsletterElement.textContent = isSubscribed ? 'Subscribed ✓' : 'Not subscribed';
        newsletterElement.style.color = isSubscribed ? '#1db954' : '#b3b3b3';
      }

      if (privacyElement) {
        const isPrivate = savedUserData.privateProfile === true;
        privacyElement.textContent = isPrivate ? 'Private profile ✓' : 'Public profile';
        privacyElement.style.color = isPrivate ? '#FFD700' : '#b3b3b3';
      }

      if (notificationElement) {
        const notificationsEnabled = savedUserData.emailNotifications === true;
        notificationElement.textContent = notificationsEnabled ? 'Enabled ✓' : 'Disabled';
        notificationElement.style.color = notificationsEnabled ? '#1db954' : '#b3b3b3';
      }

      // Store calculated stats for future use
      localStorage.setItem('hertzStatsSnapshot', JSON.stringify({
        likedTracks: likedTracks.length,
        hoursListened: hoursListened,
        playlists: playlistCount,
        followedArtists: artistsCount,
        lastUpdated: new Date().toISOString()
      }));

      console.log(`📊 Account stats updated: ${likedTracks.length} liked, ${hoursListened}h listened, ${playlistCount} playlists, ${artistsCount} artists`);
      console.log('✅ Account info loaded with real data');
    }

    function loadSettingsInfo() {
      console.log('⚙️ Loading settings');

      // Load saved settings from localStorage
      const masterVolume = localStorage.getItem('hertzMasterVolume') || '70';
      const volumeSlider = document.getElementById('masterVolume');
      const volumeDisplay = document.getElementById('volumeDisplay');

      if (volumeSlider && volumeDisplay) {
        volumeSlider.value = masterVolume;
        volumeDisplay.textContent = masterVolume + '%';

        // Remove existing listeners to prevent duplicates
        volumeSlider.removeEventListener('input', volumeSlider._hertzVolumeHandler);

        // Add event listener for volume changes
        volumeSlider._hertzVolumeHandler = function() {
          localStorage.setItem('hertzMasterVolume', this.value);
          volumeDisplay.textContent = this.value + '%';

          // Apply volume to any playing audio
          const audioElements = document.querySelectorAll('audio');
          audioElements.forEach(audio => {
            audio.volume = this.value / 100;
          });

          console.log('🔊 Master volume set to:', this.value);

          // Show temporary feedback
          showTemporaryMessage(`Volume: ${this.value}%`);
        };
        volumeSlider.addEventListener('input', volumeSlider._hertzVolumeHandler);
      }

      // Crossfade duration display and functionality
      const crossfadeSlider = document.getElementById('crossfadeDuration');
      const crossfadeDisplay = document.getElementById('crossfadeDisplay');

      if (crossfadeSlider && crossfadeDisplay) {
        const savedCrossfadeDuration = localStorage.getItem('hertzCrossfadeDuration') || '3';
        crossfadeSlider.value = savedCrossfadeDuration;
        crossfadeDisplay.textContent = savedCrossfadeDuration + 's';

        crossfadeSlider.removeEventListener('input', crossfadeSlider._hertzCrossfadeHandler);
        crossfadeSlider._hertzCrossfadeHandler = function() {
          crossfadeDisplay.textContent = this.value + 's';
          localStorage.setItem('hertzCrossfadeDuration', this.value);
          console.log('🎵 Crossfade duration set to:', this.value + 's');
          showTemporaryMessage(`Crossfade: ${this.value}s`);
        };
        crossfadeSlider.addEventListener('input', crossfadeSlider._hertzCrossfadeHandler);
      }

      // Load checkbox settings with enhanced functionality
      const settings = {
        autoplay: localStorage.getItem('hertzAutoplay') !== 'false',
        notifications: localStorage.getItem('hertzNotifications') !== 'false',
        crossfade: localStorage.getItem('hertzCrossfade') === 'true',
        remoteControl: localStorage.getItem('hertzRemoteControl') !== 'false',
        shareData: localStorage.getItem('hertzShareData') === 'true',
        publicPlaylists: localStorage.getItem('hertzPublicPlaylists') === 'true',
        findByEmail: localStorage.getItem('hertzFindByEmail') === 'true',
        visualizations: localStorage.getItem('hertzVisualizations') !== 'false',
        albumBackground: localStorage.getItem('hertzAlbumBackground') === 'true'
      };

      // Set checkbox states with enhanced functionality
      Object.keys(settings).forEach(setting => {
        const checkbox = document.getElementById(setting);
        if (checkbox) {
          checkbox.checked = settings[setting];

          // Remove existing listeners to prevent duplicates
          checkbox.removeEventListener('change', checkbox._hertzChangeHandler);

          checkbox._hertzChangeHandler = function() {
            const settingKey = 'hertz' + setting.charAt(0).toUpperCase() + setting.slice(1);
            localStorage.setItem(settingKey, this.checked);
            console.log(`⚙️ ${setting} set to:`, this.checked);

            // Apply setting-specific functionality
            switch(setting) {
              case 'notifications':
                if (this.checked && 'Notification' in window) {
                  Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                      showTemporaryMessage('Desktop notifications enabled!');
                    }
                  });
                } else {
                  showTemporaryMessage(this.checked ? 'Notifications enabled' : 'Notifications disabled');
                }
                break;
              case 'visualizations':
                showTemporaryMessage(this.checked ? 'Visualizations enabled' : 'Visualizations disabled');
                break;
              case 'albumBackground':
                showTemporaryMessage(this.checked ? 'Album backgrounds enabled' : 'Album backgrounds disabled');
                break;
              case 'autoplay':
                showTemporaryMessage(this.checked ? 'Autoplay enabled' : 'Autoplay disabled');
                break;
              case 'crossfade':
                showTemporaryMessage(this.checked ? 'Crossfade enabled' : 'Crossfade disabled');
                break;
              case 'remoteControl':
                showTemporaryMessage(this.checked ? 'Remote control enabled' : 'Remote control disabled');
                break;
              case 'shareData':
                showTemporaryMessage(this.checked ? 'Data sharing enabled' : 'Data sharing disabled');
                break;
              case 'publicPlaylists':
                showTemporaryMessage(this.checked ? 'Public playlists by default' : 'Private playlists by default');
                break;
              case 'findByEmail':
                showTemporaryMessage(this.checked ? 'Discoverable by email' : 'Not discoverable by email');
                break;
            }
          };
          checkbox.addEventListener('change', checkbox._hertzChangeHandler);
        }
      });

      // Load select values with enhanced functionality
      const audioQuality = localStorage.getItem('hertzAudioQuality') || 'normal';
      const theme = localStorage.getItem('hertzTheme') || 'dark';
      const equalizerPreset = localStorage.getItem('hertzEqualizerPreset') || 'flat';

      const selects = { audioQuality, theme, equalizerPreset };
      Object.keys(selects).forEach(selectName => {
        const select = document.getElementById(selectName);
        if (select) {
          select.value = selects[selectName];

          // Remove existing listeners to prevent duplicates
          select.removeEventListener('change', select._hertzSelectHandler);

          select._hertzSelectHandler = function() {
            const settingKey = 'hertz' + selectName.charAt(0).toUpperCase() + selectName.slice(1);
            localStorage.setItem(settingKey, this.value);
            console.log(`⚙️ ${selectName} set to:`, this.value);

            // Apply select-specific functionality
            switch(selectName) {
              case 'theme':
                localStorage.setItem('hertzTheme', this.value);
                applyTheme(this.value);
                showTemporaryMessage(`Theme changed to: ${this.options[this.selectedIndex].text}`);
                break;
              case 'audioQuality':
                showTemporaryMessage(`Audio quality: ${this.options[this.selectedIndex].text}`);
                break;
              case 'equalizerPreset':
                applyEqualizerPreset(this.value);
                showTemporaryMessage(`Equalizer: ${this.options[this.selectedIndex].text}`);
                break;
            }
          };
          select.addEventListener('change', select._hertzSelectHandler);
        }
      });

      // Apply saved theme on load
      applyTheme(theme);

      // Apply saved equalizer preset
      applyEqualizerPreset(equalizerPreset);

      console.log('✅ Settings loaded and fully functional');
    }

    // Enhanced theme switching function
    function applyTheme(themeName) {
      console.log('🎨 Applying theme:', themeName);
      // Always set data-theme for all themes except dark
      if (themeName === 'dark') {
        document.documentElement.removeAttribute('data-theme');
      } else if (themeName === 'auto') {
        // Handle auto theme detection
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (prefersDark) {
          document.documentElement.removeAttribute('data-theme');
        } else {
          document.documentElement.setAttribute('data-theme', 'light');
        }
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
          if (localStorage.getItem('hertzTheme') === 'auto') {
            if (e.matches) {
              document.documentElement.removeAttribute('data-theme');
            } else {
              document.documentElement.setAttribute('data-theme', 'light');
            }
          }
        });
      } else {
        document.documentElement.setAttribute('data-theme', themeName);
      }
      console.log('✅ Theme applied:', themeName);
    }

    // New function to apply equalizer presets
    function applyEqualizerPreset(preset) {
      console.log('🎚️ Applying equalizer preset:', preset);

      // Store the preset for audio processing
      localStorage.setItem('hertzActiveEqualizerPreset', preset);

      // In a real implementation, this would adjust audio frequencies
      // For now, we'll just store the setting
      const presetSettings = {
        flat: { bass: 0, mid: 0, treble: 0 },
        pop: { bass: 2, mid: 1, treble: 3 },
        rock: { bass: 3, mid: 0, treble: 2 },
        jazz: { bass: 1, mid: 2, treble: 1 },
        classical: { bass: 0, mid: 1, treble: 2 },
        electronic: { bass: 4, mid: -1, treble: 2 },
        bass: { bass: 5, mid: 0, treble: 0 }
      };

      if (presetSettings[preset]) {
        localStorage.setItem('hertzEqualizerSettings', JSON.stringify(presetSettings[preset]));
      }

      console.log('✅ Equalizer preset applied:', preset);
    }

    // New function to show temporary feedback messages
    function showTemporaryMessage(message, duration = 2000) {
      // Remove any existing message
      const existingMessage = document.getElementById('tempMessage');
      if (existingMessage) {
        existingMessage.remove();
      }

      // Create new message element
      const messageEl = document.createElement('div');
      messageEl.id = 'tempMessage';
      messageEl.textContent = message;
      messageEl.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(45deg, #1db954, #1ed760);
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        font-weight: 600;
        z-index: 10000;
        box-shadow: 0 4px 15px rgba(29, 185, 84, 0.3);
        animation: slideInFromRight 0.3s ease-out;
      `;

      // Add animation keyframes if not already added
      if (!document.getElementById('tempMessageStyles')) {
        const styles = document.createElement('style');
        styles.id = 'tempMessageStyles';
        styles.textContent = `
          @keyframes slideInFromRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes slideOutToRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
          }
        `;
        document.head.appendChild(styles);
      }

      document.body.appendChild(messageEl);

      // Remove message after duration
      setTimeout(() => {
        if (messageEl && messageEl.parentNode) {
          messageEl.style.animation = 'slideOutToRight 0.3s ease-in';
          setTimeout(() => {
            if (messageEl && messageEl.parentNode) {
              messageEl.remove();
            }
          }, 300);
        }
      }, duration);
    }

    // Enhanced Account Functions
    function editProfile() {
      // Redirect to the dedicated Account page for editing
      window.location.href = 'Account25App.html';
    }

    function changePassword() {
      const currentPassword = prompt('Enter current password:');
      if (currentPassword) {
        const newPassword = prompt('Enter new password:');
        if (newPassword && newPassword.length >= 6) {
          const confirmPassword = prompt('Confirm new password:');
          if (newPassword === confirmPassword) {
            // In a real app, this would make an API call
            localStorage.setItem('hertzPasswordChanged', Date.now());
            alert('Password changed successfully!');
          } else {
            alert('Passwords do not match!');
          }
        } else {
          alert('Password must be at least 6 characters long!');
        }
      }
    }

    function manageNotifications() {
      const notificationTypes = [
        'New music releases',
        'Playlist updates',
        'Friend activity',
        'Concert alerts',
        'Weekly discovery'
      ];

      let message = 'Notification Preferences:\n\n';
      notificationTypes.forEach((type, index) => {
        message += `${index + 1}. ${type}\n`;
      });

      alert(message + '\nManage detailed notification settings in the main Settings > Playback section.');
    }

    function privacySettings() {
      const privacyOptions = [
        '• Data sharing preferences',
        '• Public playlist visibility',
        '• Friend discovery settings',
        '• Location-based features',
        '• Advertising preferences'
      ];

      alert('Privacy Settings:\n\n' + privacyOptions.join('\n') + '\n\nDetailed privacy controls are available in the Settings > Privacy & Security section.');
    }

    function billingHistory() {
      const history = [
        'Jan 2025 - Free Plan - $0.00',
        'Dec 2024 - Free Plan - $0.00',
        'Nov 2024 - Free Plan - $0.00'
      ];

      alert('Billing History:\n\n' + history.join('\n') + '\n\nUpgrade to Premium to see detailed billing information.');
    }

    function paymentMethods() {
      alert('Payment Methods:\n\nNo payment methods on file.\n\nAdd a payment method to upgrade to Premium and enjoy:\n• Ad-free listening\n• Offline downloads\n• High-quality audio\n• Unlimited skips');
    }

    function downloadData() {
      const userData = {
        profile: {
          username: localStorage.getItem('hertzUsername') || 'Music Lover',
          email: 'user@hertz.music',
          memberSince: 'January 2025'
        },
        likedTracks: JSON.parse(localStorage.getItem('hertzLikedTracks') || '[]'),
        settings: Object.keys(localStorage)
          .filter(key => key.startsWith('hertz'))
          .reduce((obj, key) => {
            obj[key] = localStorage.getItem(key);
            return obj;
          }, {}),
        exportDate: new Date().toISOString()
      };

      const dataStr = JSON.stringify(userData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'hertz-account-data.json';
      a.click();

      URL.revokeObjectURL(url);
      alert('Account data downloaded successfully!');
    }

    function shareProfile() {
      const profileUrl = 'https://hertz.music/user/music-lover';
      if (navigator.share) {
        navigator.share({
          title: 'Check out my Hertz profile!',
          text: 'Listen to music with me on Hertz',
          url: profileUrl
        });
      } else {
        navigator.clipboard.writeText(profileUrl).then(() => {
          alert('Profile link copied to clipboard!');
        });
      }
    }

    function connectSocial() {
      const services = ['Spotify', 'Apple Music', 'YouTube Music', 'SoundCloud', 'Instagram', 'Twitter'];
      alert('Connect Social Accounts:\n\n' + services.map(s => `• ${s}`).join('\n') + '\n\nShare your music taste and discover what your friends are listening to!');
    }

    function deactivateAccount() {
      if (confirm('Are you sure you want to deactivate your account?\n\nYour account will be hidden but can be reactivated later.')) {
        localStorage.setItem('hertzAccountDeactivated', Date.now());
        alert('Account deactivated. You can reactivate it anytime by logging back in.');
      }
    }

    // Enhanced Settings Functions
    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const data = JSON.parse(e.target.result);
              if (data.settings) {
                Object.keys(data.settings).forEach(key => {
                  if (key.startsWith('hertz')) {
                    localStorage.setItem(key, data.settings[key]);
                  }
                });
                alert('Settings imported successfully! Please refresh the page to see changes.');
              } else {
                alert('Invalid data file format.');
              }
            } catch (error) {
              alert('Error reading file: ' + error.message);
            }
          };
          reader.readAsText(file);
        }
      };
      input.click();
    }

    function resetSettings() {
      if (confirm('Are you sure you want to reset all settings to default?\n\nThis action cannot be undone.')) {
        const settingsKeys = Object.keys(localStorage).filter(key => key.startsWith('hertz') && !key.includes('LikedTracks') && !key.includes('CustomTrackMeta'));
        settingsKeys.forEach(key => localStorage.removeItem(key));
        alert('Settings reset to default. Please refresh the page to see changes.');
      }
    }

    function developerMode() {
      const isDeveloper = localStorage.getItem('hertzDeveloperMode') === 'true';
      if (!isDeveloper) {
        const code = prompt('Enter developer access code:');
        if (code === 'HERTZ2025') {
          localStorage.setItem('hertzDeveloperMode', 'true');
          alert('Developer mode enabled! You now have access to advanced debugging tools.');
        } else {
          alert('Invalid access code.');
        }
      } else {
        localStorage.removeItem('hertzDeveloperMode');
        alert('Developer mode disabled.');
      }
    }

    function betaFeatures() {
      const features = [
        '🎨 New UI themes',
        '🎵 AI-powered recommendations',
        '🗣️ Voice commands',
        '🎮 Music games',
        '📱 Mobile app sync',
        '🌍 Social listening rooms'
      ];

      alert('Beta Features Available:\n\n' + features.join('\n') + '\n\nJoin our beta program to try experimental features before they\'re released!');
    }

    function diagnostics() {
      const info = {
        browser: navigator.userAgent,
        storageUsed: (JSON.stringify(localStorage).length / 1024).toFixed(2) + ' KB',
        tracksStored: Object.keys(JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}')).length,
        likedTracks: JSON.parse(localStorage.getItem('hertzLikedTracks') || '[]').length,
        lastUpdate: localStorage.getItem('hertzLastUpdate') || 'Never'
      };

      let message = 'System Diagnostics:\n\n';
      Object.keys(info).forEach(key => {
        message += `${key}: ${info[key]}\n`;
      });

      alert(message);
    }

    function about() {
      alert('🎵 Hertz Music Player\n\nVersion: 2.5.0\nBuild: 2025.01.04\n\nA modern music streaming platform inspired by Spotify, YouTube Music, and SoundCloud.\n\nFeatures:\n• High-quality audio streaming\n• Offline music support\n• Smart playlists\n• Social music sharing\n• Advanced audio controls\n\n© 2025 Hertz Music. All rights reserved.');
    }

    // Initialize settings and account data when page loads
    function initializeUserData() {
      // Set default member since date if not exists
      if (!localStorage.getItem('hertzMemberSince')) {
        localStorage.setItem('hertzMemberSince', 'January 2025');
      }

      // Set default username if not exists
      if (!localStorage.getItem('hertzUsername')) {
        localStorage.setItem('hertzUsername', 'Music Lover');
      }

      // Initialize default settings if they don't exist
      const defaultSettings = {
        hertzMasterVolume: '70',
        hertzAudioQuality: 'normal',
        hertzTheme: 'dark',
        hertzEqualizerPreset: 'flat',
        hertzCrossfadeDuration: '3',
        hertzAutoplay: 'true',
        hertzNotifications: 'true',
        hertzCrossfade: 'false',
        hertzRemoteControl: 'true',
        hertzShareData: 'false',
        hertzPublicPlaylists: 'false',
        hertzFindByEmail: 'false',
        hertzVisualizations: 'true',
        hertzAlbumBackground: 'false'
      };

      Object.keys(defaultSettings).forEach(key => {
        if (!localStorage.getItem(key)) {
          localStorage.setItem(key, defaultSettings[key]);
        }
      });

      // Apply saved theme immediately on page load
      const savedTheme = localStorage.getItem('hertzTheme') || 'dark';
      applyTheme(savedTheme);

      console.log('✅ User data initialized with theme:', savedTheme);
    }

    function clearCache() {
      if (confirm('Are you sure you want to clear the cache? This will remove temporary data.')) {
        // Clear non-essential localStorage items
        const keysToKeep = ['hertzCustomTrackMeta', 'hertzLikedTracks', 'hertzMasterVolume'];
        const allKeys = Object.keys(localStorage);

        allKeys.forEach(key => {
          if (!keysToKeep.some(keepKey => key.startsWith(keepKey))) {
            localStorage.removeItem(key);
          }
        });

        alert('Cache cleared successfully!');
      }
    }

    function exportData() {
      const data = {
        likedTracks: JSON.parse(localStorage.getItem('hertzLikedTracks') || '[]'),
        customTracks: JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}'),
        settings: {
          masterVolume: localStorage.getItem('hertzMasterVolume') || '70'
        },
        exportDate: new Date().toISOString()
      };

      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'hertz-music-data.json';
      a.click();

      URL.revokeObjectURL(url);
      alert('Data exported successfully!');
    }

    function deleteAccount() {
      if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
        if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
          localStorage.clear();
          alert('Account data has been deleted. You can continue using Hertz as a new user.');
          location.reload();
        }
      }
    }

    function playLikedSong(songId) {
      console.log('▶️ Playing liked song:', songId);
      // Use existing play functions
      if (typeof playSuggestionTrack === 'function') {
        playSuggestionTrack(songId);
      }
    }

    // Global function to search tracks by name or genre
    window.searchHertzTracks = function(query) {
      if (!query) return [];

      const allTracks = hertzMetadata.tracks;
      const lowerQuery = query.toLowerCase();

      return allTracks.filter(track =>
        track.title.toLowerCase().includes(lowerQuery) ||
        track.artist.toLowerCase().includes(lowerQuery) ||
        track.genre.toLowerCase().includes(lowerQuery)
      );
    };

    // Get all available genres
    window.getHertzGenres = function() {
      const genres = [...new Set(hertzMetadata.tracks.map(track => track.genre))];
      return genres.sort();
    };

    // Immediate test to verify JavaScript is running
    console.log('JavaScript is executing...');
    console.log('Track data loaded:', {
      mostPopular: mostPopularTracks ? mostPopularTracks.length : 0,
      recommended: recommendedTracks ? recommendedTracks.length : 0,
      trending: trendingTracks ? trendingTracks.length : 0
    });

    // Track data definitions and initialization will be handled by the new system above

    // --- Mobile Menu Toggle ---
    function toggleMobileMenu() {
      const mobileNav = document.getElementById('mobileNav');
      mobileNav.classList.toggle('active');
    }

    // --- Search and Suggestions ---
    function searchHertz() {
      const query = document.getElementById('mainSearchInput').value.trim();
      if (query) {
        const results = searchHertzTracks(query);
        displaySearchResults(results, query);
        hideSearchSuggestions();
      }
    }

    function showSearchSuggestions(query) {
      const suggestionsDiv = document.getElementById('searchSuggestions');
      if (!query || query.length < 2) {
        suggestionsDiv.style.display = 'none';
        return;
      }

      const results = searchHertzTracks(query).slice(0, 8); // Limit to 8 suggestions
      const genres = getHertzGenres().filter(genre =>
        genre.toLowerCase().includes(query.toLowerCase())
      ).slice(0, 3);

      if (results.length === 0 && genres.length === 0) {
        suggestionsDiv.style.display = 'none';
        return;
      }

      let html = '';

      // Add genre suggestions
      if (genres.length > 0) {
        html += '<div style="padding: 8px 12px; color: #1db954; font-weight: bold; font-size: 0.9rem; border-bottom: 1px solid #404040;">Genres</div>';
        genres.forEach(genre => {
          html += `
            <div class="suggestion-item" onclick="selectSuggestion('${genre}')" style="padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #404040; transition: background 0.2s;"
                 onmouseover="this.style.background='#404040'" onmouseout="this.style.background='transparent'">
              <span style="color: #1db954;">🎵</span> ${genre}
            </div>
          `;
        });
      }

      // Add track suggestions
      if (results.length > 0) {
        if (genres.length > 0) {
          html += '<div style="padding: 8px 12px; color: #1db954; font-weight: bold; font-size: 0.9rem; border-bottom: 1px solid #404040;">Tracks</div>';
        }
        results.forEach(track => {
          html += `
            <div class="suggestion-item" onclick="playSuggestionTrack('${track.id}')" style="padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #404040; transition: background 0.2s; display: flex; align-items: center; gap: 8px;"
                 onmouseover="this.style.background='#404040'" onmouseout="this.style.background='transparent'">
              <img src="${track.cover}" style="width: 32px; height: 32px; border-radius: 4px; object-fit: cover;">
              <div>
                <div style="color: #fff; font-weight: 500;">${track.title}</div>
                <div style="color: #b3b3b3; font-size: 0.85rem;">${track.artist} • ${track.genre}</div>
              </div>
              <div style="margin-left: auto; color: #1db954; font-size: 1.2rem;">▶</div>
            </div>
          `;
        });
      }

      suggestionsDiv.innerHTML = html;
      suggestionsDiv.style.display = 'block';
    }

    function hideSearchSuggestions() {
      setTimeout(() => {
        const suggestionsDiv = document.getElementById('searchSuggestions');
        if (suggestionsDiv) {
          suggestionsDiv.style.display = 'none';
        }
      }, 200); // Delay to allow click events
    }

    function selectSuggestion(suggestion) {
      const searchInput = document.getElementById('mainSearchInput');
      searchInput.value = suggestion;
      searchHertz();
    }

    function displaySearchResults(results, query) {
      const main = document.querySelector('main');
      const existingResults = main.querySelector('#searchResults');

      if (existingResults) {
        existingResults.remove();
      }

      if (results.length === 0) {
        const noResults = document.createElement('div');
        noResults.id = 'searchResults';
        noResults.innerHTML = `
          <div style="margin: 2rem 0; padding: 2rem; background: #232526; border-radius: 12px; text-align: center;">
            <h3 style="color: #fff; margin-bottom: 1rem;">No results found for "${query}"</h3>
            <p style="color: #b3b3b3;">Try searching for different tracks, artists, or genres.</p>
          </div>
        `;
        main.appendChild(noResults);
        return;
      }

      const resultsSection = document.createElement('div');
      resultsSection.id = 'searchResults';
      resultsSection.innerHTML = `
        <div style="margin: 2rem 0;">
          <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 1.5rem; color: #fff;">
            Search Results for "${query}" (${results.length} found)
          </h2>
          <div class="track-row-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 1.2rem;">
            ${results.map(track => `
              <div class="track-card search-result" data-trackid="${track.id}" style="background:#232526;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,0.10);padding:1rem;display:flex;flex-direction:column;align-items:center;position:relative;transition:transform 0.2s,box-shadow 0.2s;cursor:pointer;"
                   onclick="playTrackFromSearch('${track.id}')">
                <div style="position:relative;margin-bottom:0.5rem;">
                  <img src="${track.cover}" alt="${track.title}" style="width:100px;height:100px;border-radius:8px;object-fit:cover;">
                  <div class="play-overlay" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;background:rgba(29,185,84,0.9);border-radius:50%;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.2s;pointer-events:none;">
                    <span style="color:#fff;font-size:20px;margin-left:2px;">▶</span>
                  </div>
                </div>
                <div style="font-weight:600;font-size:1.05rem;text-align:center;margin-bottom:0.3rem;color:#fff;">
                  ${track.title}
                </div>
                <div style="color:#b3b3b3;font-size:0.97rem;text-align:center;margin-bottom:0.3rem;">
                  ${track.artist}
                </div>
                <div style="color:#1db954;font-size:0.85rem;text-align:center;font-weight:500;">
                  ${track.genre}
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;

      main.appendChild(resultsSection);

      // Scroll to results
      resultsSection.scrollIntoView({ behavior: 'smooth' });
    }

    // Function to play track from search results
    window.playTrackFromSearch = function(trackId) {
      // Find the track in metadata
      const metadataTracks = [
        ...hertzMetadata.featured,
        ...hertzMetadata.trending,
        ...hertzMetadata.recommended
      ];

      const track = metadataTracks.find(t => t.id === trackId);
      if (track && track.url) {
        // Add to global player queue
        const playerTrack = {
          name: track.title + " - " + track.artist,
          id: track.id,
          url: track.url,
          title: track.title,
          artist: track.artist,
          cover: track.cover,
          genre: track.genre
        };

        // Ensure track is in global allTracks array
        const existingIndex = allTracks.findIndex(t => t.id === trackId);
        if (existingIndex === -1) {
          allTracks.push(playerTrack);
        } else {
          allTracks[existingIndex] = playerTrack; // Update existing
        }

        // Load and play
        const idx = allTracks.findIndex(t => t.id === trackId);
        if (idx !== -1) {
          loadTrack(idx, true);
        }
      } else {
        alert('This track is not available for streaming yet. Please upload an MP3 file to play it.');
      }
    };

    // Function to play track from search suggestions
    window.playSuggestionTrack = function(trackId) {
      // Find the track in metadata
      const metadataTracks = [
        ...hertzMetadata.featured,
        ...hertzMetadata.trending,
        ...hertzMetadata.recommended
      ];

      const track = metadataTracks.find(t => t.id === trackId);
      if (track && track.url) {
        // Add to global player queue
        const playerTrack = {
          name: track.title + " - " + track.artist,
          id: track.id,
          url: track.url,
          title: track.title,
          artist: track.artist,
          cover: track.cover,
          genre: track.genre
        };

        // Ensure track is in global allTracks array
        const existingIndex = allTracks.findIndex(t => t.id === trackId);
        if (existingIndex === -1) {
          allTracks.push(playerTrack);
        } else {
          allTracks[existingIndex] = playerTrack; // Update existing
        }

        // Load and play
        const idx = allTracks.findIndex(t => t.id === trackId);
        if (idx !== -1) {
          loadTrack(idx, true);
        }

        // Clear search suggestions after playing
        const suggestionList = document.getElementById('suggestionList');
        if (suggestionList) {
          suggestionList.style.display = 'none';
        }

        // Clear the search input
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
          searchInput.value = '';
        }
      } else {
        alert('This track is not available for streaming yet. Please upload an MP3 file to play it.');
      }
    };

    // --- Track Data and Persistence ---
    // Track data already defined above

    function saveCustomTrackMeta(trackId, meta) {
      try {
        let metas = JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}');
        metas[trackId] = { ...(metas[trackId] || {}), ...meta };

        const dataStr = JSON.stringify(metas);

        // Add timestamp to new entries
        if (meta.mp3) {
          metas[trackId].timestamp = Date.now();
        }

        try {
          const finalDataStr = JSON.stringify(metas);
          localStorage.setItem('hertzCustomTrackMeta', finalDataStr);

          // Also save to a backup key for extra persistence
          localStorage.setItem('hertzCustomTrackMeta_backup', finalDataStr);

          // Save a timestamp of last update
          localStorage.setItem('hertzLastUpdate', Date.now().toString());

          console.log(`Storage used: ${(new Blob([finalDataStr]).size / 1024 / 1024).toFixed(2)}MB`);

          // Update storage indicator
          updateStorageIndicator();
        } catch (storageError) {
          if (storageError.name === 'QuotaExceededError') {
            // Only if we actually hit the quota, try to clean up
            console.log('Storage quota exceeded, attempting cleanup...');

            // Try to free up space by removing oldest entries
            const sortedEntries = Object.entries(metas).sort((a, b) => {
              const aTime = a[1].timestamp || 0;
              const bTime = b[1].timestamp || 0;
              return aTime - bTime;
            });

            // Remove oldest entries until we can save
            while (sortedEntries.length > 1) {
              const [oldestTrackId] = sortedEntries.shift();
              if (oldestTrackId !== trackId) { // Don't remove the track we're trying to add
                delete metas[oldestTrackId];
                console.log(`Removed oldest track ${oldestTrackId} to free up space`);

                // Try to save again
                try {
                  const cleanedDataStr = JSON.stringify(metas);
                  localStorage.setItem('hertzCustomTrackMeta', cleanedDataStr);
                  localStorage.setItem('hertzCustomTrackMeta_backup', cleanedDataStr);
                  console.log('Storage cleaned and saved successfully');
                  break;
                } catch (e) {
                  // Continue cleaning if still failing
                  continue;
                }
              }
            }
          } else {
            throw storageError;
          }
        }

        // Save a timestamp of last update
        localStorage.setItem('hertzLastUpdate', Date.now().toString());

        // Cleanup every 10 saves to keep localStorage lean
        const saveCount = parseInt(localStorage.getItem('hertzSaveCount') || '0') + 1;
        localStorage.setItem('hertzSaveCount', saveCount.toString());
        if (saveCount % 10 === 0) {
          cleanupCustomTrackMeta();
        }

        console.log(`Storage used: ${(new Blob([finalDataStr]).size / 1024 / 1024).toFixed(2)}MB`);

        // Update storage indicator
        updateStorageIndicator();

      } catch (e) {
        if (e.name === 'QuotaExceededError') {
          // Try emergency cleanup
          console.log('Storage quota exceeded, attempting emergency cleanup...');
          emergencyCleanup();

          // Try saving again with reduced data
          try {
            let metas = JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}');
            metas[trackId] = { ...(metas[trackId] || {}), ...meta };

            // If it's still an MP3 upload, compress it
            if (meta.mp3) {
              metas[trackId].mp3 = compressAudioData(meta.mp3);
            }

            localStorage.setItem('hertzCustomTrackMeta', JSON.stringify(metas));
            localStorage.setItem('hertzCustomTrackMeta_backup', JSON.stringify(metas));
          } catch (e2) {
            alert('Storage is full! Please remove some tracks to add new ones.\n\nClick the 🗑️ button on tracks you no longer need.');
            console.error('Storage still full after cleanup');
          }
        } else {
          console.error('Error saving track metadata:', e);
        }
      }
    }

    function getCustomTrackMeta(trackId) {
      let metas = JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}');

      // If primary storage is empty, try backup
      if (Object.keys(metas).length === 0) {
        metas = JSON.parse(localStorage.getItem('hertzCustomTrackMeta_backup') || '{}');
        if (Object.keys(metas).length > 0) {
          // Restore from backup
          localStorage.setItem('hertzCustomTrackMeta', JSON.stringify(metas));
        }
      }

      return metas[trackId] || {};
    }

    function getTrackById(trackId) {
      const allTrackDefs = [...mostPopularTracks, ...recommendedTracks, ...trendingTracks];
      return allTrackDefs.find(track => track.id === trackId) || {};
    }

    function cleanupCustomTrackMeta() {
      // Remove empty metadata entries to keep localStorage clean
      let metas = JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}');
      const cleanedMetas = {};

      for (const trackId in metas) {
        const meta = metas[trackId];
        if (meta.mp3 || meta.cover || meta.name || meta.artist) {
          cleanedMetas[trackId] = meta;
        }
      }

      localStorage.setItem('hertzCustomTrackMeta', JSON.stringify(cleanedMetas));
      localStorage.setItem('hertzCustomTrackMeta_backup', JSON.stringify(cleanedMetas));
    }

    function validateAndRestoreData() {
      try {
        // Validate primary storage
        const primaryData = localStorage.getItem('hertzCustomTrackMeta');
        if (primaryData) {
          JSON.parse(primaryData);
        }
      } catch (e) {
        console.log('Primary storage corrupted, restoring from backup...');
        // Restore from backup if primary is corrupted
        const backupData = localStorage.getItem('hertzCustomTrackMeta_backup');
        if (backupData) {
          try {
            JSON.parse(backupData);
            localStorage.setItem('hertzCustomTrackMeta', backupData);
          } catch (e2) {
            console.log('Backup also corrupted, starting fresh');
            localStorage.removeItem('hertzCustomTrackMeta');
            localStorage.removeItem('hertzCustomTrackMeta_backup');
          }
        }
      }
    }

    function emergencyCleanup() {
      try {
        // Remove all non-essential data first
        const keysToRemove = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && !key.startsWith('hertzCustomTrackMeta') && !key.startsWith('hertzLiked')) {
            keysToRemove.push(key);
          }
        }

        keysToRemove.forEach(key => {
          localStorage.removeItem(key);
          console.log(`Removed ${key} during emergency cleanup`);
        });

        // Then try to compress existing track data
        const metas = JSON.parse(localStorage.getItem('hertzCustomTrackMeta') || '{}');
        let compressed = false;

        Object.keys(metas).forEach(trackId => {
          const meta = metas[trackId];
          if (meta.mp3 && meta.mp3.length > 100000) { // Only compress large files
            const compressedData = compressAudioData(meta.mp3);
            if (compressedData.length < meta.mp3.length) {
              metas[trackId].mp3 = compressedData;
              compressed = true;
            }
          }
        });

        if (compressed) {
          localStorage.setItem('hertzCustomTrackMeta', JSON.stringify(metas));
          localStorage.setItem('hertzCustomTrackMeta_backup', JSON.stringify(metas));
          console.log('Compressed existing audio data');
        }

      } catch (e) {
        console.error('Emergency cleanup failed:', e);
      }
    }

    function compressAudioData(audioDataUrl) {
      try {
        // For audio files, we can reduce quality by resampling
        // This is a simplified compression - in practice, you'd want to use a proper audio library

        // Extract the base64 data
        const base64Data = audioDataUrl.split(',')[1];
        const binaryString = atob(base64Data);

        // Simple compression by reducing data size (this is a placeholder)
        // In a real implementation, you'd use proper audio compression
        const compressed = binaryString.substring(0, Math.floor(binaryString.length * 0.7));

        return audioDataUrl.split(',')[0] + ',' + btoa(compressed);
      } catch (e) {
        console.error('Compression failed:', e);
        return audioDataUrl; // Return original if compression fails
      }
    }

    // Initialize track cards with better structure
    function initializeTrackCards() {
      console.log('🚀 Initializing track cards...');

      const main = document.querySelector('main');
      const actionButtons = main ? main.querySelector('.action-buttons') : null;

      console.log('Debug info:', {
        main: !!main,
        actionButtons: !!actionButtons,
        mostPopularTracks: mostPopularTracks.length,
        recommendedTracks: recommendedTracks.length,
        trendingTracks: trendingTracks.length
      });

      if (!main || !actionButtons) {
        console.error('❌ Could not find main or action buttons', { main, actionButtons });
        return;
      }

      // Remove any existing track rows
      const existingRows = main.querySelectorAll('.track-section');
      console.log('Removing existing rows:', existingRows.length);
      existingRows.forEach(row => row.remove());

      // Create track sections with enhanced headers
      const sections = [
        { title: 'Featured Tracks', tracks: mostPopularTracks, id: 'featuredSection' },
        { title: 'Trending Now', tracks: trendingTracks, id: 'trendingSection' },
        { title: 'Recommended For You', tracks: recommendedTracks, id: 'recommendedSection' }
      ];

      console.log('Creating sections:', sections.length);

      sections.forEach((section, index) => {
        console.log(`Creating section ${index + 1}:`, section.title);
        const sectionElement = createEnhancedTrackSection(section.title, section.tracks, section.id);

        if (index === 0) {
          actionButtons.parentNode.insertBefore(sectionElement, actionButtons.nextSibling);
          console.log('✅ Inserted first section after action buttons');
        } else {
          const previousSection = main.querySelector(`#${sections[index - 1].id}`);
          if (previousSection) {
            previousSection.parentNode.insertBefore(sectionElement, previousSection.nextSibling);
            console.log(`✅ Inserted section ${index + 1} after previous section`);
          } else {
            console.error(`❌ Could not find previous section: ${sections[index - 1].id}`);
          }
        }
      });

      // Check results
      const trackCards = document.querySelectorAll('.track-card');
      console.log(`✅ Track cards created: ${trackCards.length}`);

      // Attach event listeners after DOM is updated
      setTimeout(() => {
        if (typeof attachEventListeners === 'function') {
          attachEventListeners();
          console.log('✅ Event listeners attached');
        }

        // Restore player state after initialization
        setTimeout(() => {
          if (typeof updateAllTracksFromRows === 'function') {
            updateAllTracksFromRows();
          }
          if (typeof restorePlayerState === 'function' && restorePlayerState()) {
            console.log('✅ Player state restored from previous session');
          }
        }, 500);
      }, 100);
    }

    function createEnhancedTrackSection(title, tracks, sectionId) {
      const section = document.createElement('div');
      section.className = 'track-section';
      section.id = sectionId;

      section.innerHTML = `
        <h2 class="section-header">${title}</h2>
        <div class="track-row-list">
          ${tracks.map(track => {
            const meta = getCustomTrackMeta(track.id);
            const customCover = meta.cover || track.cover;
            const customName = meta.name || track.name;
            const customArtist = meta.artist || track.artist;
            const hasMp3 = !!meta.mp3;

            return `
              <div class="track-card" data-trackid="${track.id}" style="background:#232526;border-radius:14px;min-width:170px;max-width:170px;box-shadow:0 2px 8px rgba(0,0,0,0.10);padding:1rem;display:flex;flex-direction:column;align-items:center;position:relative;transition:transform 0.2s,box-shadow 0.2s;${hasMp3 ? 'border:2px solid #1db954;' : ''}">
                <div style="display:flex;align-items:center;width:100%;justify-content:center;margin-bottom:0.5rem;position:relative;">
                  <input type="file" accept="audio/mp3,audio/mpeg" id="mp3file_${track.id}" style="display:none">
                  <button title="Browse for mp3" class="mp3-btn" data-trackid="${track.id}" style="background:#1db954;border:none;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;padding:0;margin-right:7px;z-index:10;">
                    <span style="font-size:1.1em;color:#181818;">&#128190;</span>
                  </button>
                  <div style="position:relative;">
                    <img id="cover_${track.id}" src="${customCover}" alt="${customName} cover" style="width:100px;height:100px;border-radius:8px;object-fit:cover;cursor:${hasMp3 ? 'pointer' : 'default'};">
                    ${hasMp3 ? '<div class="play-overlay" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;background:rgba(29,185,84,0.9);border-radius:50%;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.2s;pointer-events:none;"><span style="color:#fff;font-size:20px;margin-left:2px;">▶</span></div>' : ''}
                  </div>
                  <input type="file" accept="image/*" id="file_${track.id}" style="display:none">
                  <button title="Change cover" class="cover-btn" data-trackid="${track.id}" style="position:absolute;top:6px;right:6px;background:#1db954;border:none;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;padding:0;z-index:10;">
                    <span style="font-size:1.1em;color:#181818;">&#128247;</span>
                  </button>
                </div>
                <div style="font-weight:600;font-size:1.05rem;text-align:center;margin-bottom:0.3rem;">
                  <span id="name_${track.id}" style="cursor:pointer;">${customName}</span>
                  <input type="text" id="input_name_${track.id}" value="${customName}" style="display:none;width:90%;margin-top:2px;border-radius:6px;border:none;padding:2px 6px;">
                  <button title="Edit name" class="edit-name-btn" data-trackid="${track.id}" style="background:none;border:none;cursor:pointer;padding:0 0 0 4px;color:#1db954;font-size:1em;">&#9998;</button>
                </div>
                <div style="color:#b3b3b3;font-size:0.97rem;text-align:center;margin-bottom:0.3rem;">
                  <span id="artist_${track.id}" style="cursor:pointer;">${customArtist}</span>
                  <input type="text" id="input_artist_${track.id}" value="${customArtist}" style="display:none;width:90%;margin-top:2px;border-radius:6px;border:none;padding:2px 6px;">
                  <button title="Edit artist" class="edit-artist-btn" data-trackid="${track.id}" style="background:none;border:none;cursor:pointer;padding:0 0 0 4px;color:#1db954;font-size:1em;">&#9998;</button>
                </div>
                <div style="margin-top:0.5rem;display:flex;gap:0.5rem;justify-content:center;">
                  <button class="play-mp3-btn" data-trackid="${track.id}" style="background:${hasMp3 ? '#1db954' : '#404040'};border:none;border-radius:20px;padding:0.4rem 1.2rem;font-size:0.97rem;cursor:pointer;color:${hasMp3 ? '#181818' : '#b3b3b3'};font-weight:600;transition:all 0.2s;">
                    ${hasMp3 ? '🎵 Ready to Play' : '📁 Upload MP3'}
                  </button>
                  ${hasMp3 ? `<button class="remove-mp3-btn" data-trackid="${track.id}" title="Remove MP3" style="background:#ff4444;border:none;border-radius:20px;padding:0.4rem 0.8rem;font-size:0.9rem;cursor:pointer;color:#fff;font-weight:600;transition:all 0.2s;">🗑️</button>` : ''}
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;

      return section;
    }

    // EMERGENCY FALLBACK - Simple track card creation
    function createSimpleTrackCards() {
      console.log('🆘 EMERGENCY: Creating simple track cards...');

      const main = document.querySelector('main');
      const actionButtons = main?.querySelector('.action-buttons');

      if (!main || !actionButtons) {
        console.error('❌ EMERGENCY: No main or action buttons found');
        return;
      }

      // Remove existing
      const existing = main.querySelectorAll('.track-section, .track-row');
      existing.forEach(el => el.remove());

      // Create sections HTML directly
      const sectionsHTML = `
        <div class="track-section" id="featuredSection">
          <h2 class="section-header">FEATURED TRACKS</h2>
          <div class="track-row-list">
            ${mostPopularTracks.slice(0, 10).map(track => `
              <div class="track-card" data-trackid="${track.id}" style="background:#232526;border-radius:14px;min-width:170px;max-width:170px;box-shadow:0 2px 8px rgba(0,0,0,0.10);padding:1rem;display:flex;flex-direction:column;align-items:center;position:relative;transition:transform 0.2s,box-shadow 0.2s;">
                <div style="position:relative;margin-bottom:0.5rem;">
                  <img src="${track.cover}" alt="${track.name}" style="width:100px;height:100px;border-radius:8px;object-fit:cover;">
                </div>
                <div style="font-weight:600;font-size:1.05rem;text-align:center;margin-bottom:0.3rem;color:#fff;">
                  ${track.name}
                </div>
                <div style="color:#b3b3b3;font-size:0.97rem;text-align:center;">
                  ${track.artist}
                </div>
                <div style="margin-top:0.5rem;">
                  <button style="background:#404040;border:none;border-radius:20px;padding:0.4rem 1.2rem;font-size:0.97rem;cursor:pointer;color:#b3b3b3;font-weight:600;">
                    📁 Upload MP3
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>

        <div class="track-section" id="trendingSection">
          <h2 class="section-header">TRENDING NOW</h2>
          <div class="track-row-list">
            ${trendingTracks.slice(0, 10).map(track => `
              <div class="track-card" data-trackid="${track.id}" style="background:#232526;border-radius:14px;min-width:170px;max-width:170px;box-shadow:0 2px 8px rgba(0,0,0,0.10);padding:1rem;display:flex;flex-direction:column;align-items:center;position:relative;transition:transform 0.2s,box-shadow 0.2s;">
                <div style="position:relative;margin-bottom:0.5rem;">
                  <img src="${track.cover}" alt="${track.name}" style="width:100px;height:100px;border-radius:8px;object-fit:cover;">
                </div>
                <div style="font-weight:600;font-size:1.05rem;text-align:center;margin-bottom:0.3rem;color:#fff;">
                  ${track.name}
                </div>
                <div style="color:#b3b3b3;font-size:0.97rem;text-align:center;">
                  ${track.artist}
                </div>
                <div style="margin-top:0.5rem;">
                  <button style="background:#404040;border:none;border-radius:20px;padding:0.4rem 1.2rem;font-size:0.97rem;cursor:pointer;color:#b3b3b3;font-weight:600;">
                    📁 Upload MP3
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>

        <div class="track-section" id="recommendedSection">
          <h2 class="section-header">RECOMMENDED FOR YOU</h2>
          <div class="track-row-list">
            ${recommendedTracks.slice(0, 10).map(track => `
              <div class="track-card" data-trackid="${track.id}" style="background:#232526;border-radius:14px;min-width:170px;max-width:170px;box-shadow:0 2px 8px rgba(0,0,0,0.10);padding:1rem;display:flex;flex-direction:column;align-items:center;position:relative;transition:transform 0.2s,box-shadow 0.2s;">
                <div style="position:relative;margin-bottom:0.5rem;">
                  <img src="${track.cover}" alt="${track.name}" style="width:100px;height:100px;border-radius:8px;object-fit:cover;">
                </div>
                <div style="font-weight:600;font-size:1.05rem;text-align:center;margin-bottom:0.3rem;color:#fff;">
                  ${track.name}
                </div>
                <div style="color:#b3b3b3;font-size:0.97rem;text-align:center;">
                  ${track.artist}
                </div>
                <div style="margin-top:0.5rem;">
                  <button style="background:#404040;border:none;border-radius:20px;padding:0.4rem 1.2rem;font-size:0.97rem;cursor:pointer;color:#b3b3b3;font-weight:600;">
                    📁 Upload MP3
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;

      // Insert after action buttons
      actionButtons.insertAdjacentHTML('afterend', sectionsHTML);

      console.log('✅ EMERGENCY: Simple track cards created!');
      console.log('Track cards in DOM:', document.querySelectorAll('.track-card').length);
    }

    // IMMEDIATE INITIALIZATION - Force track cards to display
    console.log('🚀 IMMEDIATE: Starting track card initialization...');

    // Force initialization immediately
    setTimeout(() => {
      console.log('🔥 FORCED INITIALIZATION: Creating track cards NOW...');
      if (typeof initializeTrackCards === 'function') {
        initializeTrackCards();
      }
    }, 50);

    // Ensure track cards are shown when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🎯 DOM Content Loaded - Initializing track cards...');
      if (typeof initializeTrackCards === 'function') {
        initializeTrackCards();
      }
      if (typeof updateStorageIndicator === 'function') {
        updateStorageIndicator();
      }
    });

    // Fallback initialization - Multiple attempts
    setTimeout(() => {
      if (document.querySelectorAll('.track-card').length === 0) {
        console.log('🔄 Fallback initialization attempt 1...');
        if (typeof initializeTrackCards === 'function') {
          initializeTrackCards();
        }
      }
    }, 500);

    setTimeout(() => {
      if (document.querySelectorAll('.track-card').length === 0) {
        console.log('🔄 Fallback initialization attempt 2...');
        if (typeof createSimpleTrackCards === 'function') {
          createSimpleTrackCards();
        }
      }
    }, 1000);

    setTimeout(() => {
      if (document.querySelectorAll('.track-card').length === 0) {
        console.log('🔄 Fallback initialization attempt 3 - EMERGENCY...');
        if (typeof createSimpleTrackCards === 'function') {
          createSimpleTrackCards();
        }
      }
    }, 2000);

    // Force show track cards on page load
    window.addEventListener('load', function() {
      console.log('🎯 Window loaded - Ensuring track cards display...');
      if (document.querySelectorAll('.track-card').length === 0) {
        console.log('🔄 Window load initialization - EMERGENCY...');
        if (typeof createSimpleTrackCards === 'function') {
          createSimpleTrackCards();
        }
      }
    });

    // --- Enhanced Persistent Player Logic ---
    let allTracks = [];
    let currentIndex = 0;
    let isPlaying = false;
    let isLoop = false;
    let isShuffle = false;

    // Global function to play track from card click - defined early to avoid timing issues
    window.playTrackFromCard = function(trackId) {
      updateAllTracksFromRows();
      const idx = allTracks.findIndex(t => t.id === trackId);
      if (idx !== -1) {
        loadTrack(idx, true);
      }
    };

    const stickyPlayer = document.getElementById('stickyPlayer');
    const playerAudio = document.getElementById('playerAudio');
    const playerTrackTitle = document.getElementById('playerTrackTitle');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const loopBtn = document.getElementById('loopBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const volumeRange = document.getElementById('volumeRange');
    const progressBar = document.getElementById('progressBar');
    const currentTimeSpan = document.getElementById('currentTime');
    const durationSpan = document.getElementById('duration');

    // Enhanced player state management for cross-page persistence
    function savePlayerState() {
      if (!allTracks[currentIndex]) return;

      const playerState = {
        track: {
          name: allTracks[currentIndex].name,
          id: allTracks[currentIndex].id,
          url: allTracks[currentIndex].url || null,
          title: allTracks[currentIndex].title || allTracks[currentIndex].name.split(' - ')[0],
          artist: allTracks[currentIndex].artist || allTracks[currentIndex].name.split(' - ')[1],
          cover: allTracks[currentIndex].cover,
          genre: allTracks[currentIndex].genre
        },
        currentTime: playerAudio.currentTime || 0,
        isPlaying: isPlaying,
        volume: playerAudio.volume || 0.7,
        isLoop: isLoop,
        isShuffle: isShuffle,
        currentIndex: currentIndex,
        allTracks: allTracks.map(t => ({
          id: t.id,
          name: t.name,
          url: t.url,
          title: t.title,
          artist: t.artist,
          cover: t.cover,
          genre: t.genre
        })),
        timestamp: Date.now()
      };

      // Save to both session and local storage for maximum persistence
      sessionStorage.setItem('hertzPlayerState', JSON.stringify(playerState));
      localStorage.setItem('hertzPlayerState', JSON.stringify(playerState));
      localStorage.setItem('hertzPlayerLastUpdate', Date.now().toString());
    }

    function restorePlayerState() {
      // Try session storage first, then local storage
      let playerStateData = sessionStorage.getItem('hertzPlayerState') || localStorage.getItem('hertzPlayerState');

      if (!playerStateData) return false;

      try {
        const playerState = JSON.parse(playerStateData);

        // Check if state is recent (within last 24 hours)
        const timeDiff = Date.now() - (playerState.timestamp || 0);
        if (timeDiff > 24 * 60 * 60 * 1000) {
          console.log('Player state too old, skipping restore');
          return false;
        }

        // Restore tracks array
        if (playerState.allTracks && playerState.allTracks.length > 0) {
          allTracks = playerState.allTracks;
        }

        // Restore player state
        if (playerState.track && playerState.track.url) {
          const trackIndex = allTracks.findIndex(t => t.id === playerState.track.id);
          if (trackIndex !== -1) {
            currentIndex = trackIndex;
            loadTrack(currentIndex, false);

            // Restore playback position
            playerAudio.currentTime = playerState.currentTime || 0;

            // Restore volume
            if (playerState.volume !== undefined) {
              playerAudio.volume = playerState.volume;
              volumeRange.value = playerState.volume;
            }

            // Restore control states
            isLoop = playerState.isLoop || false;
            isShuffle = playerState.isShuffle || false;
            loopBtn.classList.toggle('active', isLoop);
            shuffleBtn.classList.toggle('active', isShuffle);
            playerAudio.loop = isLoop;

            // Restore playback state if it was playing
            if (playerState.isPlaying) {
              setTimeout(() => {
                playPause();
              }, 500); // Small delay to ensure audio is loaded
            }

            console.log('✅ Player state restored successfully');
            return true;
          }
        }

        return false;
      } catch (error) {
        console.error('Error restoring player state:', error);
        return false;
      }
    }

    function loadTrack(idx, autoplay = true) {
      if (!allTracks[idx] || !allTracks[idx].url) return;
      stickyPlayer.style.display = 'flex';
      playerAudio.src = allTracks[idx].url;
      playerTrackTitle.textContent = allTracks[idx].name;
      currentIndex = idx;
      playPauseBtn.innerHTML = '&#9654;';
      isPlaying = false;
      progressBar.value = 0;
      currentTimeSpan.textContent = "0:00";
      durationSpan.textContent = "0:00";
      if (autoplay) playPause();
      savePlayerState();
    }

    function playPause() {
      if (!allTracks[currentIndex] || !allTracks[currentIndex].url) return;
      if (isPlaying) {
        playerAudio.pause();
        playPauseBtn.innerHTML = '&#9654;'; // Show play button when paused
        isPlaying = false;
      } else {
        playerAudio.play();
        playPauseBtn.innerHTML = '&#10073;&#10073;'; // Show pause button when playing
        isPlaying = true;
      }
      savePlayerState();
    }

    function playNext() {
      if (isShuffle) {
        currentIndex = Math.floor(Math.random() * allTracks.length);
      } else {
        currentIndex = (currentIndex + 1) % allTracks.length;
      }
      loadTrack(currentIndex);
    }

    function playPrev() {
      if (isShuffle) {
        currentIndex = Math.floor(Math.random() * allTracks.length);
      } else {
        currentIndex = (currentIndex - 1 + allTracks.length) % allTracks.length;
      }
      loadTrack(currentIndex);
    }

    function toggleLoop() {
      isLoop = !isLoop;
      playerAudio.loop = isLoop;
      loopBtn.classList.toggle('active', isLoop);
      savePlayerState();
    }

    function toggleShuffle() {
      isShuffle = !isShuffle;
      shuffleBtn.classList.toggle('active', isShuffle);
      savePlayerState();
    }

    // Enhanced event listeners with state saving
    playerAudio.addEventListener('timeupdate', function() {
      if (!playerAudio.duration) return;
      progressBar.value = (playerAudio.currentTime / playerAudio.duration) * 100;
      currentTimeSpan.textContent = formatTime(playerAudio.currentTime);
      durationSpan.textContent = formatTime(playerAudio.duration);

      // Save state periodically (every 5 seconds)
      if (Math.floor(playerAudio.currentTime) % 5 === 0) {
        savePlayerState();
      }
    });

    progressBar.addEventListener('input', function() {
      if (!playerAudio.duration) return;
      playerAudio.currentTime = (progressBar.value / 100) * playerAudio.duration;
      savePlayerState();
    });

    volumeRange.addEventListener('input', function() {
      playerAudio.volume = volumeRange.value;
      savePlayerState();
    });

    playPauseBtn.addEventListener('click', playPause);
    prevBtn.addEventListener('click', playPrev);
    nextBtn.addEventListener('click', playNext);
    loopBtn.addEventListener('click', toggleLoop);
    shuffleBtn.addEventListener('click', toggleShuffle);

    // Sync button state with actual audio player state
    playerAudio.addEventListener('play', function() {
      playPauseBtn.innerHTML = '&#10073;&#10073;'; // Show pause button when playing
      isPlaying = true;
    });

    playerAudio.addEventListener('pause', function() {
      playPauseBtn.innerHTML = '&#9654;'; // Show play button when paused
      isPlaying = false;
    });

    playerAudio.addEventListener('ended', function() {
      playPauseBtn.innerHTML = '&#9654;'; // Show play button when ended
      isPlaying = false;
      if (!isLoop) {
        playNext(); // Auto-play next track if not looping
      }
    });

    // --- Enhanced Like Button Logic with Full Track Data ---
    function saveLikedTrackWithFullData(track) {
      try {
        let likedTracks = JSON.parse(localStorage.getItem('hertzLikedTracks') || '{}');

        // Enhance track data with metadata if available
        const allTracksMetadata = [
          ...hertzMetadata.featured,
          ...hertzMetadata.trending,
          ...hertzMetadata.recommended
        ];

        const trackMetadata = allTracksMetadata.find(t => t.id === track.id);

        // Save comprehensive track data
        likedTracks[track.id] = {
          id: track.id,
          name: trackMetadata?.title || track.title || track.name,
          artist: trackMetadata?.artist || track.artist,
          cover: trackMetadata?.cover || track.cover,
          genre: trackMetadata?.genre || track.genre || 'Unknown',
          url: track.url || trackMetadata?.url, // Prefer uploaded MP3, fallback to metadata URL
          mp3: track.url, // Store as MP3 for backward compatibility
          timestamp: Date.now(),
          source: 'hertz_app', // Track where it was liked from
          likedFrom: window.location.pathname || 'Hertz App.html'
        };

        localStorage.setItem('hertzLikedTracks', JSON.stringify(likedTracks));
        localStorage.setItem('hertzLikedTracks_backup', JSON.stringify(likedTracks));

        console.log('✅ Saved liked track with full data:', track.name || trackMetadata?.title);

        // Trigger update event for other tabs
        localStorage.setItem('hertzLikedTracksUpdate', Date.now().toString());

        // Show notification
        showLikeNotification(track.name || trackMetadata?.title, 'liked');
      } catch (error) {
        console.error('❌ Error saving liked track:', error);
      }
    }

    function removeLikedTrackWithFullData(trackId) {
      try {
        let likedTracks = JSON.parse(localStorage.getItem('hertzLikedTracks') || '{}');
        const trackName = likedTracks[trackId]?.name;

        if (likedTracks[trackId]) {
          delete likedTracks[trackId];
          localStorage.setItem('hertzLikedTracks', JSON.stringify(likedTracks));
          localStorage.setItem('hertzLikedTracks_backup', JSON.stringify(likedTracks));

          console.log('✅ Removed liked track:', trackId);

          // Trigger update event for other tabs
          localStorage.setItem('hertzLikedTracksUpdate', Date.now().toString());

          // Show notification
          showLikeNotification(trackName, 'unliked');
        }
      } catch (error) {
        console.error('❌ Error removing liked track:', error);
      }
    }

    function isTrackLiked(track) {
      if (!track) return false;
      const likedTracks = JSON.parse(localStorage.getItem('hertzLikedTracks') || '{}');
      return !!likedTracks[track.id];
    }

    function updateLikeBtn(track) {
      const likeBtn = document.getElementById('likeBtn');
      if (!likeBtn) return;
      if (isTrackLiked(track)) {
        likeBtn.style.color = "#ff4081";
        likeBtn.title = "Unlike - Remove from Liked";
        likeBtn.innerHTML = "&#10084;"; // Filled heart
      } else {
        likeBtn.style.color = "#b3b3b3";
        likeBtn.title = "Like - Add to Liked";
        likeBtn.innerHTML = "&#9825;"; // Empty heart
      }
    }

    function toggleCurrentTrackLike() {
      if (!allTracks[currentIndex]) return;

      const track = allTracks[currentIndex];

      if (isTrackLiked(track)) {
        // Unlike: remove from synced storage
        removeLikedTrackWithFullData(track.id);
      } else {
        // Like: save with full data to synced storage
        saveLikedTrackWithFullData(track);
      }

      // Update UI
      updateLikeBtn(track);
    }

    // Show like/unlike notification
    function showLikeNotification(trackName, action) {
      // Remove any existing notification
      const existingNotification = document.getElementById('likeNotification');
      if (existingNotification) {
        existingNotification.remove();
      }

      // Create notification element
      const notification = document.createElement('div');
      notification.id = 'likeNotification';
      notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: ${action === 'liked' ? '#1db954' : '#ff4444'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        font-weight: 600;
        font-size: 0.95rem;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        max-width: 300px;
        word-wrap: break-word;
      `;

      const icon = action === 'liked' ? '❤️' : '💔';
      const verb = action === 'liked' ? 'Added to' : 'Removed from';
      notification.innerHTML = `${icon} ${verb} Liked: ${trackName}`;

      document.body.appendChild(notification);

      // Animate in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);

      // Animate out and remove
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Add like button event listener
    const likeBtn = document.getElementById('likeBtn');
    if (likeBtn) {
      likeBtn.addEventListener('click', toggleCurrentTrackLike);
    }

    // Update like button when track changes
    function updateLikeBtnForCurrent() {
      const track = allTracks[currentIndex];
      updateLikeBtn(track);
    }

    // Patch loadTrack to update like button
    const enhancedLoadTrack = loadTrack;
    loadTrack = function(idx, autoplay = true) {
      enhancedLoadTrack(idx, autoplay);
      updateLikeBtnForCurrent();
    };

    // Listen for liked list updates from other tabs
    window.addEventListener('storage', function(e) {
      if (e.key === 'hertzLikedTracksUpdate') {
        updateLikeBtnForCurrent();
        // Update account stats if account page is open
        const accountOverlay = document.getElementById('accountPageOverlay');
        if (accountOverlay && accountOverlay.style.display === 'block') {
          loadAccountInfo();
        }
      }

      // Update account stats for any storage changes that affect user data
      if (e.key && (e.key.startsWith('hertz') || e.key === 'hertzUsername' || e.key === 'hertzUserEmail')) {
        const accountOverlay = document.getElementById('accountPageOverlay');
        if (accountOverlay && accountOverlay.style.display === 'block') {
          setTimeout(() => loadAccountInfo(), 100); // Small delay to ensure storage is updated
        }
      }
    });

    // Add functions to track playlists and followed artists
    function addToPlaylist(playlistName, trackData) {
      const playlists = JSON.parse(localStorage.getItem('hertzPlaylists') || '[]');
      let playlist = playlists.find(p => p.name === playlistName);

      if (!playlist) {
        playlist = {
          id: Date.now().toString(),
          name: playlistName,
          tracks: [],
          created: new Date().toISOString(),
          description: `My ${playlistName} playlist`
        };
        playlists.push(playlist);
      }

      if (!playlist.tracks.find(t => t.id === trackData.id)) {
        playlist.tracks.push(trackData);
        localStorage.setItem('hertzPlaylists', JSON.stringify(playlists));
        localStorage.setItem('hertzPlaylistsUpdate', Date.now().toString());
        console.log(`Added track to playlist: ${playlistName}`);
      }
    }

    function followArtist(artistName) {
      const followedArtists = JSON.parse(localStorage.getItem('hertzFollowedArtists') || '[]');

      if (!followedArtists.find(a => a.name === artistName)) {
        const artist = {
          id: Date.now().toString(),
          name: artistName,
          followed: new Date().toISOString(),
          genre: 'Unknown'
        };
        followedArtists.push(artist);
        localStorage.setItem('hertzFollowedArtists', JSON.stringify(followedArtists));
        localStorage.setItem('hertzFollowedArtistsUpdate', Date.now().toString());
        console.log(`Now following artist: ${artistName}`);
      }
    }

    function unfollowArtist(artistName) {
      const followedArtists = JSON.parse(localStorage.getItem('hertzFollowedArtists') || '[]');
      const filteredArtists = followedArtists.filter(a => a.name !== artistName);

      if (filteredArtists.length !== followedArtists.length) {
        localStorage.setItem('hertzFollowedArtists', JSON.stringify(filteredArtists));
        localStorage.setItem('hertzFollowedArtistsUpdate', Date.now().toString());
        console.log(`Unfollowed artist: ${artistName}`);
      }
    }

    // Track listening time more accurately
    function trackListeningTime(duration) {
      const currentTime = parseInt(localStorage.getItem('hertzTotalListeningTime') || '0');
      const newTime = currentTime + Math.floor(duration);
      localStorage.setItem('hertzTotalListeningTime', newTime.toString());
      localStorage.setItem('hertzListeningTimeUpdate', Date.now().toString());
    }

    // Enhanced like tracking with automatic artist following
    function enhancedLikeTrack(trackData) {
      // Add to liked tracks
      let likedTracks = JSON.parse(localStorage.getItem('hertzLikedTracks') || '{}');
      if (trackData && trackData.id) {
        likedTracks[trackData.id] = {
          ...trackData,
          likedAt: new Date().toISOString()
        };
        localStorage.setItem('hertzLikedTracks', JSON.stringify(likedTracks));

        // Auto-follow artist if we like 3+ of their songs
        if (trackData.artist) {
          const artistTracks = Object.values(likedTracks).filter(t => t.artist === trackData.artist);
          if (artistTracks.length >= 3) {
            followArtist(trackData.artist);
          }
        }

        // Auto-create "Favorites" playlist and add to it
        addToPlaylist('Favorites', trackData);
      }
    }

    // --- Persistent Player State Sync (Spotify-style) ---
    (function() {
      function savePlayerState() {
        const audio = document.getElementById('playerAudio');
        const state = {
          track: window.currentTrack || null,
          currentTime: audio ? audio.currentTime : 0,
          paused: audio ? audio.paused : true
        };
        localStorage.setItem('playerState', JSON.stringify(state));
      }

      function loadPlayerState() {
        const state = JSON.parse(localStorage.getItem('playerState') || '{}');
        if (state && state.track) {
          window.currentTrack = state.track;
          if (typeof playOfflineTrack === 'function') {
            playOfflineTrack(
              (window.offlineTracks || []).findIndex(t => t.id === state.track.id),
              true
            );
          }
          const audio = document.getElementById('playerAudio');
          if (audio && typeof state.currentTime === 'number') {
            audio.currentTime = state.currentTime;
            if (!state.paused) {
              audio.play();
            }
          }
        }
      }

      window.addEventListener('storage', function(e) {
        if (e.key === 'playerState') {
          loadPlayerState();
          if (typeof updateLikeButtons === 'function') updateLikeButtons();
        }
      });

      function setupPlayerStateSync() {
        const audio = document.getElementById('playerAudio');
        if (!audio) return;
        audio.addEventListener('play', savePlayerState);
        audio.addEventListener('pause', savePlayerState);
        audio.addEventListener('seeked', savePlayerState);
        audio.addEventListener('timeupdate', function() {
          if (!audio.paused) savePlayerState();
        });
      }

      document.addEventListener('DOMContentLoaded', function() {
        loadPlayerState();
        setupPlayerStateSync();
      });
    })();

    // Track list interaction functions
    function playTrack(trackId) {
      console.log('Playing track:', trackId);
      // Simulate track playing
      const stickyPlayer = document.getElementById('stickyPlayer');
      if (stickyPlayer) {
        stickyPlayer.style.display = 'flex';
      }
    }

    function playAllTracks() {
      console.log('Playing all tracks');
      playTrack('popular1');
    }

    function toggleLike(button, event) {
      event.stopPropagation();

      if (button.classList.contains('liked')) {
        button.classList.remove('liked');
        button.innerHTML = '♡';
        button.style.color = '#a7a7a7';
      } else {
        button.classList.add('liked');
        button.innerHTML = '♥';
        button.style.color = '#1db954';
      }
    }

    function showTrackMenu(event) {
      event.stopPropagation();

      // Create context menu
      const menu = document.createElement('div');
      menu.style.position = 'fixed';
      menu.style.left = event.clientX + 'px';
      menu.style.top = event.clientY + 'px';
      menu.style.background = '#282828';
      menu.style.border = '1px solid #3e3e3e';
      menu.style.borderRadius = '4px';
      menu.style.padding = '8px 0';
      menu.style.zIndex = '10000';
      menu.style.minWidth = '200px';
      menu.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.5)';

      const menuItems = [
        'Add to queue',
        'Go to song radio',
        'Add to playlist',
        'Share',
        'Copy song link'
      ];

      menuItems.forEach(item => {
        const menuItem = document.createElement('div');
        menuItem.textContent = item;
        menuItem.style.padding = '8px 16px';
        menuItem.style.color = '#ffffff';
        menuItem.style.fontSize = '0.875rem';
        menuItem.style.cursor = 'pointer';
        menuItem.style.transition = 'background 0.1s ease';

        menuItem.addEventListener('mouseenter', () => {
          menuItem.style.background = '#3e3e3e';
        });

        menuItem.addEventListener('mouseleave', () => {
          menuItem.style.background = 'transparent';
        });

        menuItem.addEventListener('click', () => {
          console.log('Menu action:', item);
          document.body.removeChild(menu);
        });

        menu.appendChild(menuItem);
      });

      document.body.appendChild(menu);

      // Remove menu when clicking elsewhere
      const removeMenu = (e) => {
        if (!menu.contains(e.target)) {
          document.body.removeChild(menu);
          document.removeEventListener('click', removeMenu);
        }
      };

      setTimeout(() => {
        document.addEventListener('click', removeMenu);
      }, 10);
    }

    // Update greeting based on time
    function updateGreeting() {
      const hour = new Date().getHours();
      const greetingElement = document.getElementById('greetingText');

      if (greetingElement) {
        if (hour >= 6 && hour < 18) {
          // Day time (6 AM to 6 PM): Show "Shine & Prosper"
          greetingElement.textContent = 'Shine & Prosper';
        } else {
          // Night time (6 PM to 6 AM): Show "Good evening"
          greetingElement.textContent = 'Good evening';
        }
      }
    }

    // Initialize greeting
    updateGreeting();

  </script>
</body>
</html>
<script>
// Mini Video Player Logic (from Offline25App.html, adapted)
const videoOverlay = document.getElementById('videoOverlay');
const miniVideoPlayer = document.getElementById('miniVideoPlayer');
const miniVideoElement = document.getElementById('miniVideoElement');
const miniPlayPauseBtn = document.getElementById('miniPlayPauseBtn');
const miniMuteBtn = document.getElementById('miniMuteBtn');
const miniFullscreenBtn = document.getElementById('miniFullscreenBtn');
const miniCloseBtn = document.getElementById('miniCloseBtn');

let isMiniPlaying = false;
let isMiniMuted = true;
let isMiniFullscreen = false;

function showMiniVideoPlayer(src) {
  miniVideoElement.src = src;
  miniVideoPlayer.style.display = 'block';
  videoOverlay.style.display = 'block';
  miniVideoElement.muted = true;
  miniVideoElement.volume = 0.1;
  miniVideoElement.play().then(() => {
    miniPlayPauseBtn.textContent = '⏸';
    isMiniPlaying = true;
  }).catch(() => {
    miniPlayPauseBtn.textContent = '▶';
    isMiniPlaying = false;
  });
}

miniPlayPauseBtn.addEventListener('click', () => {
  if (isMiniPlaying) {
    miniVideoElement.pause();
    miniPlayPauseBtn.textContent = '▶';
    isMiniPlaying = false;
  } else {
    miniVideoElement.play();
    miniPlayPauseBtn.textContent = '⏸';
    isMiniPlaying = true;
  }
});

miniMuteBtn.addEventListener('click', () => {
  if (isMiniMuted) {
    miniVideoElement.muted = false;
    miniMuteBtn.textContent = '🔊';
    isMiniMuted = false;
  } else {
    miniVideoElement.muted = true;
    miniMuteBtn.textContent = '🔇';
    isMiniMuted = true;
  }
});

miniFullscreenBtn.addEventListener('click', () => {
  if (!isMiniFullscreen) {
    if (miniVideoPlayer.requestFullscreen) miniVideoPlayer.requestFullscreen();
    isMiniFullscreen = true;
  } else {
    if (document.exitFullscreen) document.exitFullscreen();
    isMiniFullscreen = false;
  }
});

miniCloseBtn.addEventListener('click', () => {
  miniVideoPlayer.style.display = 'none';
  videoOverlay.style.display = 'none';
  miniVideoElement.pause();
  miniVideoElement.src = '';
  isMiniPlaying = false;
});

videoOverlay.addEventListener('click', () => {
  miniCloseBtn.click();
});

// Example usage: showMiniVideoPlayer('path/to/video.mp4');
// You can call showMiniVideoPlayer with the video URL to open the popup player.
</script>
