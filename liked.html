<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hertz - Liked Tracks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #181818; color: #fff; min-height: 100vh; display: flex; flex-direction: column; }
    header { position: sticky; top: 0; background: #121212; padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 1000; }
    .logo-btn { display: inline-block; font-size: 1.7rem; font-weight: bold; color: #1db954; background: transparent; border: 2px solid #1db954; border-radius: 30px; padding: 0.4rem 1.6rem; text-decoration: none; letter-spacing: 2px; cursor: pointer; transition: background 0.2s, color 0.2s;}
    .logo-btn:hover, .logo-btn:focus { background: #1db954; color: #181818; outline: none;}
    nav { display: flex; gap: 1rem;}
    nav a { text-decoration: none; color: #fff; background: #282828; padding: 0.6rem 1.4rem; border-radius: 30px; font-weight: 500; transition: background 0.2s, color 0.2s; border: 2px solid transparent;}
    nav a:hover, nav a.active { background: #1db954; color: #181818; border-color: #1db954;}
    .mobile-menu-btn { display: none; background: none; border: 2px solid #1db954; color: #1db954; font-size: 1.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
    .mobile-menu-btn:hover { background: #1db954; color: #181818; }
    .mobile-nav { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(18, 18, 18, 0.95); z-index: 1000; padding-top: 4rem; }
    .mobile-nav.active { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
    .mobile-nav a { color: #fff; background: #282828; padding: 1rem 2rem; border-radius: 30px; font-weight: 500; text-decoration: none; font-size: 1.1rem; border: 2px solid transparent; transition: all 0.2s; }
    .mobile-nav a:hover, .mobile-nav a.active { background: #1db954; color: #181818; border-color: #1db954; }
    .mobile-nav .close-btn { position: absolute; top: 1rem; right: 2rem; background: none; border: none; color: #fff; font-size: 2rem; cursor: pointer; }
    .container { display: flex; flex: 1; min-height: 0;}
    aside { width: 220px; background: #121212; padding: 2rem 1rem; display: flex; flex-direction: column; gap: 1.5rem; border-right: 1px solid #232323;}
    aside h2 { font-size: 1.1rem; color: #b3b3b3; margin-bottom: 1rem; letter-spacing: 1px;}
    aside ul { list-style: none; display: flex; flex-direction: column; gap: 1rem;}
    aside ul li a { color: #b3b3b3; text-decoration: none; font-size: 1rem; transition: color 0.2s;}
    aside ul li a:hover { color: #1db954;}
    main { flex: 1; padding: 2rem; overflow-y: auto; background: linear-gradient(135deg, #232526 0%, #181818 100%); border-radius: 0 0 0 30px;}
    h2 { margin-bottom: 1.5rem; }
    .desc { color: #b3b3b3; font-size: 1.1rem; margin-bottom: 1.5rem;}
    .liked-list { margin-top: 2rem; }
    .track-title { font-weight: bold; }
    .liked-track { margin-bottom: 1.2rem; }
    .liked-track .track-title { font-size: 1rem; }
    .liked-track .track-actions { margin-top: 0.3rem; }
    .liked-track .track-actions button { background: #1db954; color: #181818; border: none; border-radius: 20px; padding: 0.2rem 1rem; font-size: 0.95rem; cursor: pointer; margin-right: 0.5rem;}
    .liked-track .track-actions button:hover { background: #17a74a; color: #fff;}
    .sticky-player { 
      position: fixed; 
      bottom: 0; 
      left: 0; 
      width: 100%; 
      background: #232526; 
      z-index: 1000; 
      box-shadow: 0 -2px 8px rgba(0,0,0,0.2); 
      display: flex; 
      align-items: center; 
      padding: 0.5rem 2rem;
    }
    .player-controls { display: flex; align-items: center; gap: 1rem; }
    .player-btn { background: none; border: none; color: #1db954; font-size: 1.5rem; cursor: pointer; transition: color 0.2s;}
    .player-btn:hover { color: #fff; }
    .player-title { margin-left: 1.5rem; font-weight: bold; color: #fff; min-width: 120px; }
    .player-audio { width: 250px; margin-left: 1.5rem; }
    .player-loop.active, .player-shuffle.active { color: #fff700; }
    .spacer { height: 70px; }
    @media (max-width: 900px) { aside { display: none; } .container { flex-direction: column; } main { border-radius: 0; } }
    @media (max-width: 768px) { 
      nav { display: none; } 
      .mobile-menu-btn { display: block; }
      header { flex-wrap: wrap; padding: 1rem; }
    }
    @media (max-width: 700px) {
      .sticky-player { flex-direction: column; align-items: flex-start; padding: 0.5rem 0.5rem; }
      .player-title, .player-audio { margin-left: 0; }
    }
    @media (max-width: 600px) { header { flex-direction: column; gap: 1rem; } main { padding: 1rem; } }

    /* Suggestion box styles */
    #likedSuggestionBox {
      position: absolute;
      background: #232526;
      color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 1001;
      width: 240px;
      max-width: 400px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 1rem;
      display: none;
    }
    .liked-suggestion-item {
      padding: 0.7rem 1rem;
      cursor: pointer;
      border-bottom: 1px solid #232323;
    }
    .liked-suggestion-item:last-child {
      border-bottom: none;
    }
    .liked-suggestion-item.active, .liked-suggestion-item:hover {
      background: #1db954;
      color: #181818;
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="logo-btn" aria-label="Go to Hertz homepage">Hertz</a>
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">â˜°</button>
    <nav style="display:flex;align-items:center;gap:1rem;">
      <a href="index.html">Home</a>
      <a href="online.html">Online</a>
      <a href="offline.html">Offline</a>
      <a href="playlists.html">Playlists</a>
      <a href="favorites.html">Favorites</a>
      <a href="liked.html" class="active">Liked</a>
      <a href="Account.html">Account</a>
      <a href="settings.html">Settings</a>
      <!-- Liked search bar aligned with Settings button -->
      <div class="search-bar" style="display:flex;align-items:center;gap:1rem;margin-left:0.5rem;height:100%;">
        <input type="text" id="likedSearchInput" placeholder="Search your liked..." style="flex:1; padding:0.7rem; border-radius:20px; border:none; font-size:1rem; width:180px;">
        <button id="likedSearchBtn" style="padding:0.7rem 1.5rem; border-radius:20px; border:none; background:#1db954; color:#181818; font-weight:bold; cursor:pointer; transition:background 0.2s;">Search</button>
      </div>
    </nav>
    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
      <button class="close-btn" onclick="toggleMobileMenu()">&times;</button>
      <a href="index.html">Home</a>
      <a href="online.html">Online</a>
      <a href="offline.html">Offline</a>
      <a href="playlists.html">Playlists</a>
      <a href="favorites.html">Favorites</a>
      <a href="liked.html" class="active">Liked</a>
      <a href="Account.html">Account</a>
      <a href="settings.html">Settings</a>
    </div>
  </header>
  <div class="spacer"></div>
  <div class="feature-container">
    <h2>Liked Tracks</h2>
    <p class="desc">Listen to your favorite tracks you liked.</p>
    <div style="margin:1rem 0;">
      <input type="file" id="likedFiles" accept="audio/*" multiple>
      <span style="color:#b3b3b3;font-size:0.95em;">(Re-upload your liked files to enable playback after refresh)</span>
    </div>
    <div class="liked-list" id="likedList"></div>
  </div>
  <div class="sticky-player" id="stickyPlayer" style="display:none;">
    <div class="player-controls">
      <button class="player-btn" id="prevBtn" title="Previous">&#9198;</button>
      <button class="player-btn" id="playPauseBtn" title="Play/Pause">&#9654;</button>
      <button class="player-btn" id="nextBtn" title="Next">&#9197;</button>
      <button class="player-btn player-loop" id="loopBtn" title="Loop">&#128257;</button>
      <button class="player-btn player-shuffle" id="shuffleBtn" title="Shuffle">&#128256;</button>
      <!-- Add the heart/like button here -->
      <button id="likeBtn" title="Like" style="margin-left:1.5rem;background:none;border:none;cursor:pointer;font-size:1.7rem;color:#b3b3b3;transition:color 0.2s;">&#10084;</button>
      <label for="volumeRange" style="margin-left:1rem;color:#b3b3b3;font-size:0.95em;">Volume</label>
      <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="0.7" style="width:100px;">
    </div>
    <span class="player-title" id="playerTrackTitle"></span>
    <div style="display:flex;align-items:center;gap:0.7rem;width:320px;max-width:90%;">
      <span id="currentTime" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
      <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1" style="flex:1;">
      <span id="duration" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
    </div>
    <audio id="playerAudio" class="player-audio"></audio>
  </div>

  <!-- Sticky Player Markup (identical on all pages) -->
<div class="sticky-player" id="stickyPlayer" style="display:none; flex-direction:column;">
  <div style="display:flex;align-items:center;width:100%;">
    <div class="player-controls">
      <button class="player-btn" id="prevBtn" title="Previous">&#9198;</button>
      <button class="player-btn" id="playPauseBtn" title="Play/Pause">&#9654;</button>
      <button class="player-btn" id="nextBtn" title="Next">&#9197;</button>
      <button class="player-btn player-loop" id="loopBtn" title="Loop">&#128257;</button>
      <button class="player-btn player-shuffle" id="shuffleBtn" title="Shuffle">&#128256;</button>
      <button class="player-btn" id="lyricsBtn" title="Show/Hide Lyrics" style="color:#1db954;font-size:1.3em;">&#119070;</button>
      <label for="volumeRange" style="margin-left:1rem;color:#b3b3b3;font-size:0.95em;">Volume</label>
      <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="0.7" style="width:100px;">
    </div>
    <span class="player-title" id="playerTrackTitle"></span>
    <div style="display:flex;align-items:center;gap:0.7rem;width:320px;max-width:90%;">
      <span id="currentTime" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
      <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1" style="flex:1;">
      <span id="duration" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
    </div>
    <!-- Heart/Like button -->
    <button id="likeBtn" title="Like" style="margin-left:1.5rem;background:none;border:none;cursor:pointer;font-size:1.7rem;color:#b3b3b3;transition:color 0.2s;">&#10084;</button>
  </div>
  <audio id="playerAudio" class="player-audio"></audio>
</div>
<script>
    // --- Mobile Menu Toggle ---
    function toggleMobileMenu() {
      const mobileNav = document.getElementById('mobileNav');
      mobileNav.classList.toggle('active');
    }

    // Track data for liked tracks from sync system
    let likedTracks = [];
    let currentIndex = 0;
    let isPlaying = false;
    let isLoop = false;
    let isShuffle = false;

    const likedList = document.getElementById('likedList');
    const stickyPlayer = document.getElementById('stickyPlayer');
    const playerAudio = document.getElementById('playerAudio');
    const playerTrackTitle = document.getElementById('playerTrackTitle');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const loopBtn = document.getElementById('loopBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const volumeRange = document.getElementById('volumeRange');
    const progressBar = document.getElementById('progressBar');
    const currentTimeSpan = document.getElementById('currentTime');
    const durationSpan = document.getElementById('duration');
    const likeBtn = document.getElementById('likeBtn');
    const likedSearchInput = document.getElementById('likedSearchInput');
    const likedSearchBtn = document.getElementById('likedSearchBtn');

    // Load liked tracks from the new sync system
    function loadLikedTracksFromSync() {
      try {
        const syncedTracks = JSON.parse(localStorage.getItem('hertzLikedTracks') || '{}');
        return Object.values(syncedTracks).map(track => ({
          id: track.id,
          name: track.name,
          artist: track.artist,
          cover: track.cover,
          url: track.mp3, // MP3 data URL from offline sync
          timestamp: track.timestamp,
          source: track.source
        }));
      } catch (e) {
        console.error('Error loading synced liked tracks:', e);
        return [];
      }
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', function() {
      console.log('ðŸŽµ Loading synced liked tracks...');
      likedTracks = loadLikedTracksFromSync();
      console.log(`âœ… Loaded ${likedTracks.length} liked tracks from sync`);
      
      if (likedTracks.length === 0) {
        likedList.innerHTML = '<div style="color:#b3b3b3;text-align:center;padding:2rem;">No liked tracks yet. Like tracks from the offline page to see them here!</div>';
      } else {
        renderLikedList();
      }
    });

    // Listen for updates from other pages
    window.addEventListener('storage', function(e) {
      if (e.key === 'hertzLikedTracksUpdate') {
        console.log('ðŸ”„ Liked tracks updated from another page, refreshing...');
        likedTracks = loadLikedTracksFromSync();
        renderLikedList();
      }
    });

    // Render the liked tracks list with cards
    function renderLikedList() {
      likedList.innerHTML = '';
      
      if (likedTracks.length === 0) {
        likedList.innerHTML = '<div style="color:#b3b3b3;text-align:center;padding:2rem;">No liked tracks yet. Like tracks from the offline page to see them here!</div>';
        return;
      }

      // Filter by search if any
      const query = likedSearchInput.value.trim().toLowerCase();
      const filteredTracks = query ? 
        likedTracks.filter(track => 
          track.name.toLowerCase().includes(query) || 
          track.artist.toLowerCase().includes(query)
        ) : likedTracks;

      if (filteredTracks.length === 0 && query) {
        likedList.innerHTML = '<div style="color:#b3b3b3;text-align:center;padding:2rem;">No tracks found matching your search.</div>';
        return;
      }

      // Create track cards
      filteredTracks.forEach((track, index) => {
        const trackCard = document.createElement('div');
        trackCard.className = 'liked-track-card';
        trackCard.style.cssText = `
          display: flex;
          align-items: center;
          background: #232526;
          border-radius: 12px;
          padding: 1rem;
          margin-bottom: 1rem;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          transition: transform 0.2s, box-shadow 0.2s;
          cursor: pointer;
        `;
        
        trackCard.innerHTML = `
          <div style="position: relative; margin-right: 1rem;">
            <img src="${track.cover}" alt="${track.name}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
            <div class="play-overlay" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 30px; height: 30px; background: rgba(29, 185, 84, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.2s;">
              <span style="color: #fff; font-size: 14px; margin-left: 2px;">â–¶</span>
            </div>
          </div>
          <div style="flex: 1;">
            <div style="font-weight: 600; font-size: 1.1rem; color: #fff; margin-bottom: 0.2rem;">${track.name}</div>
            <div style="color: #b3b3b3; font-size: 0.9rem;">${track.artist}</div>
            <div style="color: #1db954; font-size: 0.8rem; margin-top: 0.2rem;">From: ${track.source || 'offline'}</div>
          </div>
          <div style="display: flex; gap: 0.5rem; align-items: center;">
            <button class="play-btn" onclick="playTrack(${index})" style="background: #1db954; border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s;">
              <span style="color: #181818; font-size: 16px; margin-left: 2px;">â–¶</span>
            </button>
            <button class="unlike-btn" onclick="unlikeTrack('${track.id}')" title="Remove from liked" style="background: none; border: none; cursor: pointer; font-size: 1.5rem; color: #ff4444; transition: color 0.2s;">
              &#10084;
            </button>
          </div>
        `;

        // Add hover effects
        trackCard.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-2px)';
          this.style.boxShadow = '0 4px 16px rgba(0,0,0,0.2)';
          this.querySelector('.play-overlay').style.opacity = '1';
        });

        trackCard.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
          this.querySelector('.play-overlay').style.opacity = '0';
        });

        // Click to play
        trackCard.addEventListener('click', function(e) {
          if (!e.target.closest('button')) {
            playTrack(index);
          }
        });

        likedList.appendChild(trackCard);
      });
    }

    // Play a track from the liked list
    window.playTrack = function(index) {
      const track = likedTracks[index];
      if (!track || !track.url) {
        alert('This track cannot be played. The audio file may be missing.');
        return;
      }

      currentIndex = index;
      stickyPlayer.style.display = 'flex';
      playerAudio.src = track.url;
      playerTrackTitle.textContent = `${track.name} - ${track.artist}`;
      playPauseBtn.innerHTML = '&#10073;&#10073;';
      isPlaying = true;
      progressBar.value = 0;
      currentTimeSpan.textContent = "0:00";
      durationSpan.textContent = "0:00";
      
      playerAudio.play().catch(e => {
        console.error('Error playing track:', e);
        alert('Error playing this track. The audio data may be corrupted.');
      });

      updateLikeBtn(track);
    };

    // Unlike a track
    window.unlikeTrack = function(trackId) {
      if (confirm('Remove this track from your liked tracks?')) {
        try {
          let likedTracksData = JSON.parse(localStorage.getItem('hertzLikedTracks') || '{}');
          delete likedTracksData[trackId];
          localStorage.setItem('hertzLikedTracks', JSON.stringify(likedTracksData));
          localStorage.setItem('hertzLikedTracks_backup', JSON.stringify(likedTracksData));
          
          // Update local array
          likedTracks = likedTracks.filter(track => track.id !== trackId);
          
          // Re-render
          renderLikedList();
          
          // Notify other pages
          localStorage.setItem('hertzLikedTracksUpdate', Date.now().toString());
          
          console.log(`âœ… Removed track ${trackId} from liked tracks`);
        } catch (e) {
          console.error('Error removing track:', e);
        }
      }
    };

    // Search functionality
    likedSearchBtn.onclick = function() {
      renderLikedList();
    };

    likedSearchInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        renderLikedList();
      }
    });

    likedSearchInput.addEventListener('input', function() {
      renderLikedList();
    });

    // Audio player functions
    function playPause() {
      if (!likedTracks[currentIndex] || !likedTracks[currentIndex].url) return;
      if (isPlaying) {
        playerAudio.pause();
        playPauseBtn.innerHTML = '&#9654;';
        isPlaying = false;
      } else {
        playerAudio.play();
        playPauseBtn.innerHTML = '&#10073;&#10073;';
        isPlaying = true;
      }
    }

    function playNext() {
      if (isShuffle) {
        currentIndex = Math.floor(Math.random() * likedTracks.length);
      } else {
        currentIndex = (currentIndex + 1) % likedTracks.length;
      }
      playTrack(currentIndex);
    }

    function playPrev() {
      if (isShuffle) {
        currentIndex = Math.floor(Math.random() * likedTracks.length);
      } else {
        currentIndex = (currentIndex - 1 + likedTracks.length) % likedTracks.length;
      }
      playTrack(currentIndex);
    }

    function toggleLoop() {
      isLoop = !isLoop;
      playerAudio.loop = isLoop;
      loopBtn.classList.toggle('active', isLoop);
    }

    function toggleShuffle() {
      isShuffle = !isShuffle;
      shuffleBtn.classList.toggle('active', isShuffle);
    }

    // Like button functions
    function isTrackLiked(trackId) {
      try {
        const likedTracksData = JSON.parse(localStorage.getItem('hertzLikedTracks') || '{}');
        return !!likedTracksData[trackId];
      } catch (e) {
        return false;
      }
    }

    function updateLikeBtn(track) {
      if (!likeBtn || !track) return;
      if (isTrackLiked(track.id)) {
        likeBtn.style.color = "#ff4081";
        likeBtn.title = "Unlike";
      } else {
        likeBtn.style.color = "#b3b3b3";
        likeBtn.title = "Like";
      }
    }

    // Event listeners
    playPauseBtn.addEventListener('click', playPause);
    prevBtn.addEventListener('click', playPrev);
    nextBtn.addEventListener('click', playNext);
    loopBtn.addEventListener('click', toggleLoop);
    shuffleBtn.addEventListener('click', toggleShuffle);

    playerAudio.addEventListener('timeupdate', function() {
      if (!playerAudio.duration) return;
      progressBar.value = (playerAudio.currentTime / playerAudio.duration) * 100;
      currentTimeSpan.textContent = formatTime(playerAudio.currentTime);
      durationSpan.textContent = formatTime(playerAudio.duration);
    });

    progressBar.addEventListener('input', function() {
      if (!playerAudio.duration) return;
      playerAudio.currentTime = (progressBar.value / 100) * playerAudio.duration;
    });

    volumeRange.addEventListener('input', function() {
      playerAudio.volume = volumeRange.value;
    });

    playerAudio.addEventListener('ended', function() {
      if (isLoop) {
        playerAudio.currentTime = 0;
        playerAudio.play();
      } else {
        playNext();
      }
    });

    likeBtn.addEventListener('click', function() {
      const track = likedTracks[currentIndex];
      if (track) {
        unlikeTrack(track.id);
      }
    });

    function formatTime(sec) {
      sec = Math.floor(sec);
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return m + ':' + (s < 10 ? '0' : '') + s;
    }
  </script>

  <!-- Sticky Player Markup (identical on all pages) -->
<div class="sticky-player" id="stickyPlayer" style="display:none; flex-direction:column;">
  <div style="display:flex;align-items:center;width:100%;">
    <div class="player-controls">
      <button class="player-btn" id="prevBtn" title="Previous">&#9198;</button>
      <button class="player-btn" id="playPauseBtn" title="Play/Pause">&#9654;</button>
      <button class="player-btn" id="nextBtn" title="Next">&#9197;</button>
      <button class="player-btn player-loop" id="loopBtn" title="Loop">&#128257;</button>
      <button class="player-btn player-shuffle" id="shuffleBtn" title="Shuffle">&#128256;</button>
      <button class="player-btn" id="lyricsBtn" title="Show/Hide Lyrics" style="color:#1db954;font-size:1.3em;">&#119070;</button>
      <label for="volumeRange" style="margin-left:1rem;color:#b3b3b3;font-size:0.95em;">Volume</label>
      <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="0.7" style="width:100px;">
    </div>
    <span class="player-title" id="playerTrackTitle"></span>
    <div style="display:flex;align-items:center;gap:0.7rem;width:320px;max-width:90%;">
      <span id="currentTime" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
      <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1" style="flex:1;">
      <span id="duration" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
    </div>
    <!-- Heart/Like button -->
    <button id="likeBtn" title="Like" style="margin-left:1.5rem;background:none;border:none;cursor:pointer;font-size:1.7rem;color:#b3b3b3;transition:color 0.2s;">&#10084;</button>
  </div>
  <audio id="playerAudio" class="player-audio"></audio>
</div>
<script>
// --- Like Button Logic (universal for all pages) ---

// Get liked tracks from localStorage
function getLikedTracks() {
  return JSON.parse(localStorage.getItem('hertzLikedTracks') || '[]');
}

// Save liked tracks to localStorage
function saveLikedTracks(tracks) {
  localStorage.setItem('hertzLikedTracks', JSON.stringify(tracks));
}

// Check if a track is liked
function isTrackLiked(track) {
  if (!track) return false;
  const liked = getLikedTracks();
  return liked.some(t => t.id === track.id);
}

// Update like button UI (pink if liked, grey if not)
function updateLikeBtn(track) {
  if (!window.likeBtn) return;
  if (isTrackLiked(track)) {
    likeBtn.style.color = "#ff4081"; // pink
    likeBtn.title = "Unlike";
  } else {
    likeBtn.style.color = "#b3b3b3"; // grey
    likeBtn.title = "Like";
  }
}

// Toggle like for the current track and update liked.html immediately
if (window.likeBtn) {
  likeBtn.onclick = function() {
    // Use allTracks if available, otherwise fallback to filteredTracks
    const track = (typeof allTracks !== "undefined" && allTracks[currentIndex]) ||
                  (typeof filteredTracks !== "undefined" && filteredTracks[currentIndex]);
    if (!track) return;
    let liked = getLikedTracks();
    const idx = liked.findIndex(t => t.id === track.id);
    if (idx === -1) {
      // Add to liked and update storage
      liked.push({ name: track.name, id: track.id, url: track.url });
      saveLikedTracks(liked);
      updateLikeBtn(track);
      // If on liked.html, update the list immediately
      if (typeof renderLikedList === "function") renderLikedList(getLikedTracks());
    } else {
      // Remove from liked and update storage
      liked.splice(idx, 1);
      saveLikedTracks(liked);
      updateLikeBtn(track);
      // If on liked.html, update the list immediately
      if (typeof renderLikedList === "function") renderLikedList(getLikedTracks());
    }
  };
}

// Update like button when track changes
function updateLikeBtnForCurrent() {
  const track = (typeof allTracks !== "undefined" && allTracks[currentIndex]) ||
                (typeof filteredTracks !== "undefined" && filteredTracks[currentIndex]);
  updateLikeBtn(track);
}

// Patch loadTrack to always update like button after loading a track
(function() {
  const origLoadTrack = window.loadTrack;
  window.loadTrack = function(idx, ...args) {
    if (typeof origLoadTrack === "function") {
      origLoadTrack.call(this, idx, ...args);
    }
    updateLikeBtnForCurrent();
  };
})();

// Also update like button on initial load
window.addEventListener('DOMContentLoaded', function() {
  updateLikeBtnForCurrent();
  // If on liked.html, render the liked list on load
  if (typeof renderLikedList === "function") renderLikedList(getLikedTracks());
});

// --- End Like Button Logic ---

// ...rest of your player and page logic...
</script>
</body>
</html>