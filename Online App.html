<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hertz - Online Streaming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #181818; color: #fff; margin: 0; }
    header { position: sticky; top: 0; background: #121212; padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .logo-btn { font-size: 1.7rem; font-weight: bold; color: #1db954; background: transparent; border: 2px solid #1db954; border-radius: 30px; padding: 0.4rem 1.6rem; text-decoration: none; letter-spacing: 2px; cursor: pointer; transition: background 0.2s, color 0.2s;}
    .logo-btn:hover, .logo-btn:focus { background: #1db954; color: #181818; outline: none;}
    nav { display: flex; gap: 1rem;}
    nav a { text-decoration: none; color: #fff; background: #282828; padding: 0.6rem 1.4rem; border-radius: 30px; font-weight: 500; transition: background 0.2s, color 0.2s; border: 2px solid transparent;}
    nav a:hover, nav a.active { background: #1db954; color: #181818; border-color: #1db954;}
    .mobile-menu-btn { display: none; background: none; border: 2px solid #1db954; color: #1db954; font-size: 1.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
    .mobile-menu-btn:hover { background: #1db954; color: #181818; }
    .mobile-nav { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(18, 18, 18, 0.95); z-index: 1000; padding-top: 4rem; }
    .mobile-nav.active { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
    .mobile-nav a { color: #fff; background: #282828; padding: 1rem 2rem; border-radius: 30px; font-weight: 500; text-decoration: none; font-size: 1.1rem; border: 2px solid transparent; transition: all 0.2s; }
    .mobile-nav a:hover, .mobile-nav a.active { background: #1db954; color: #181818; border-color: #1db954; }
    .mobile-nav .close-btn { position: absolute; top: 1rem; right: 2rem; background: none; border: none; color: #fff; font-size: 2rem; cursor: pointer; }
    .feature-container { max-width: 900px; margin: 3rem auto; background: #232526; padding: 2rem; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);}
    h2 { margin-bottom: 1.5rem; }
    .search-bar button:hover { background: #17a74a; color: #fff;}
    .media-player { margin-bottom: 2rem; background: #181818; padding: 1.5rem; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);}
    .media-player .track-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;}
    .track-list, .genre-section { margin-top: 2rem; }
    .track { margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem;}
    .track-title { font-weight: bold; }
    .track-img { width: 100px; height: 100px; object-fit: cover; border-radius: 10px; border: 2px solid #1db954; background: #222;}
    .genre-section { margin-bottom: 2rem; }
    .genre-title { font-size: 1.1rem; color: #1db954; margin-bottom: 0.7rem; }
    .genre-tracks { display: flex; flex-wrap: wrap; gap: 1.5rem; }
    .genre-track { background: #181818; border-radius: 10px; padding: 1rem; width: 260px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center;}
    .genre-track .track-title { font-size: 1rem; }
    .like-btn { background: none; border: none; color: #1db954; cursor: pointer; font-size: 1.1rem; margin-left: 0.5rem; }
    .like-btn.liked { color: #fff700; }
    .lyrics-link { color: #1db954; text-decoration: underline; font-size: 0.95em; margin-left: 0.5em;}
    #ytSuggestionBox {
      position: absolute;
      background: #232526;
      color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 1001;
      width: 100%;
      max-width: 500px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 1rem;
    }
    .yt-suggestion-item { display: flex; align-items: center; gap: 1rem; cursor: pointer; }
    .yt-suggestion-item:hover, .yt-suggestion-item.active { background: #1db954 !important; color: #181818 !important; }
    @media (max-width: 900px) {
      .feature-container { max-width: 100%; }
      .genre-tracks { flex-direction: column; gap: 1rem; }
      .genre-track { width: 100%; }
      .track { flex-direction: column; align-items: flex-start; }
    }
    @media (max-width: 768px) { 
      nav { display: none; } 
      .mobile-menu-btn { display: block; }
      header { flex-wrap: wrap; padding: 1rem; }
      .search-bar { order: 3; width: 100%; margin-top: 1rem; max-width: none !important; }
    }
  </style>
</head>
<body>
  <header>
    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1.5rem; width: 100%;">
      <a href="Hertz App.html" class="logo-btn" aria-label="Go to Hertz homepage">Hertz</a>
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">â˜°</button>
      <nav style="flex: 1;">
        <a href="Hertz App.html">Home</a>
        <a href="Online App.html" class="active">Online</a>
        <a href="Offline App.html">Offline</a>
        <a href="Playlist App.html">Playlists</a>
        <a href="Favorites App.html">Favorites</a>
        <a href="Liked App.html">Liked</a>
        <a href="Account App.html">Account</a>
        <a href="Settings App.html">Settings</a>
      </nav>
      <div class="search-bar" style="max-width:350px; min-width:200px; flex: 0 0 350px; display:flex; gap:1rem; align-items:center; position:relative;">
        <input type="text" id="searchInput" placeholder="Search for tracks, artists, genres..." autocomplete="off" style="flex:1; padding:0.7rem; border-radius:20px; border:none; font-size:1rem;">
        <button onclick="searchTracks()" style="padding:0.7rem 1.5rem; border-radius:20px; border:none; background:#1db954; color:#181818; font-weight:bold; cursor:pointer; transition:background 0.2s;">Search</button>
      </div>
    </div>
    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
      <button class="close-btn" onclick="toggleMobileMenu()">&times;</button>
      <a href="Hertz App.html">Home</a>
      <a href="Online App.html" class="active">Online</a>
      <a href="Offline App.html">Offline</a>
      <a href="Playlist App.html">Playlists</a>
      <a href="Favorites App.html">Favorites</a>
      <a href="Liked App.html">Liked</a>
      <a href="Account App.html">Account</a>
      <a href="Settings App.html">Settings</a>
    </div>
  </header>
  <div class="feature-container">
    <h2>Online Streaming</h2>
    <div class="media-player" id="mediaPlayer" style="display:none;">
      <div class="track-title" id="playerTrackTitle" style="text-align:center; font-size:1.3rem; font-weight:bold; margin-bottom:1rem;"></div>
      <iframe id="playerIframe" width="100%" height="100" style="border:none;" allow="autoplay"></iframe>
      <div><a id="lyricsLink" class="lyrics-link" href="#" target="_blank" style="display:none;">View Lyrics on YouTube</a></div>
    </div>
    <div id="searchResults"></div>
    <h3 style="margin-top:2rem;">Most Liked & Featured Tracks by Genre</h3>
    <div id="genresContainer"></div>
  </div>
  <script>
  // --- Mobile Menu Toggle ---
  function toggleMobileMenu() {
    const mobileNav = document.getElementById('mobileNav');
    mobileNav.classList.toggle('active');
  }

  // --- Local tracks for genre/like/featured display ---
  const tracks = [
    {
      title: "Billie Eilish - bad guy",
      artist: "Billie Eilish",
      genre: "Pop",
      youtubeId: "DyDfgMOUjCI",
      img: "https://i.scdn.co/image/ab67616d0000b273b8e2f6b3e7e7e3e8e8e8",
      likes: 120,
      featured: true
    },
    {
      title: "The Weeknd - Blinding Lights",
      artist: "The Weeknd",
      genre: "Pop",
      youtubeId: "fHI8X4OXluQ",
      img: "https://i1.sndcdn.com/artworks-000652232857-4n7j7d-t500x500.jpg",
      likes: 200,
      featured: true
    },
    {
      title: "Imagine Dragons - Believer",
      artist: "Imagine Dragons",
      genre: "Rock",
      youtubeId: "7wtfhZwyrcc",
      img: "https://i.scdn.co/image/ab67616d0000b273b2e2f6b3e7e7e3e8e8e8e8e8",
      likes: 180,
      featured: true
    },
    {
      title: "Drake - God's Plan",
      artist: "Drake",
      genre: "Hip-Hop",
      youtubeId: "xpVfcZ0ZcFM",
      img: "https://i1.sndcdn.com/artworks-000304681792-2bq8w6-t500x500.jpg",
      likes: 150,
      featured: true
    },
    {
      title: "Ed Sheeran - Shape of You",
      artist: "Ed Sheeran",
      genre: "Pop",
      youtubeId: "JGwWNGJdvx8",
      img: "https://i.scdn.co/image/ab67616d0000b273e8e8e8e8e8e8e8e8e8e8e8e8",
      likes: 170,
      featured: false
    },
    {
      title: "Eminem - Lose Yourself",
      artist: "Eminem",
      genre: "Hip-Hop",
      youtubeId: "_Yhyp-_hX2s",
      img: "https://i1.sndcdn.com/artworks-000239443123-2bq8w6-t500x500.jpg",
      likes: 210,
      featured: false
    },
    {
      title: "Queen - Bohemian Rhapsody",
      artist: "Queen",
      genre: "Rock",
      youtubeId: "fJ9rUzIMcZQ",
      img: "https://i.scdn.co/image/ab67616d0000b273b3e2f6b3e7e7e3e8e8e8e8e8",
      likes: 300,
      featured: false
    },
    {
      title: "Miles Davis - So What",
      artist: "Miles Davis",
      genre: "Jazz",
      youtubeId: "zqNTltOGh5c",
      img: "https://i1.sndcdn.com/artworks-000239443123-2bq8w6-t500x500.jpg",
      likes: 90,
      featured: true
    }
  ];

  let likedTracks = JSON.parse(localStorage.getItem('hertzLikedTracks') || '{}');
  const genres = [...new Set(tracks.map(t => t.genre))];

  // --- Use only these 2 API keys and rotate between them ---
  const YT_API_KEYS = [
    'AIzaSyAdRN2jhOaF6ul_mSz_xQGXSyqlTvRhSXQ',
    'AIzaSyAp60G0VgTBwhz32wQMK7hHdsBtg0LyAsM'
  ];
  let ytApiKeyIndex = 0;
  function getYTApiKey() {
    const key = YT_API_KEYS[ytApiKeyIndex];
    ytApiKeyIndex = (ytApiKeyIndex + 1) % YT_API_KEYS.length;
    return key;
  }

  function renderGenres() {
    const container = document.getElementById('genresContainer');
    container.innerHTML = '';
    genres.forEach(genre => {
      const genreTracks = tracks.filter(t => t.genre === genre);
      const mostLiked = [...genreTracks].sort((a, b) => b.likes - a.likes)[0];
      const featured = genreTracks.find(t => t.featured) || mostLiked;
      container.innerHTML += `
        <div class="genre-section">
          <div class="genre-title">${genre}</div>
          <div class="genre-tracks">
            <div class="genre-track">
              <img class="track-img" src="${mostLiked.img}" alt="${mostLiked.title}">
              <div class="track-title">Most Liked: ${mostLiked.title}</div>
              <div>Artist: ${mostLiked.artist}</div>
              <div>Likes: <span id="likes-${mostLiked.youtubeId}">${mostLiked.likes + (likedTracks[mostLiked.youtubeId] ? 1 : 0)}</span>
                <button class="like-btn${likedTracks[mostLiked.youtubeId] ? ' liked' : ''}" onclick="likeTrack('${mostLiked.youtubeId}')">&#9733;</button>
              </div>
              <button onclick="playTrack('${mostLiked.youtubeId}')">Play</button>
              <a class="lyrics-link" href="https://www.youtube.com/results?search_query=${encodeURIComponent(mostLiked.title + ' lyrics')}" target="_blank">Lyrics</a>
            </div>
            <div class="genre-track">
              <img class="track-img" src="${featured.img}" alt="${featured.title}">
              <div class="track-title">Featured: ${featured.title}</div>
              <div>Artist: ${featured.artist}</div>
              <div>Likes: <span id="likes-${featured.youtubeId}">${featured.likes + (likedTracks[featured.youtubeId] ? 1 : 0)}</span>
                <button class="like-btn${likedTracks[featured.youtubeId] ? ' liked' : ''}" onclick="likeTrack('${featured.youtubeId}')">&#9733;</button>
              </div>
              <button onclick="playTrack('${featured.youtubeId}')">Play</button>
              <a class="lyrics-link" href="https://www.youtube.com/results?search_query=${encodeURIComponent(featured.title + ' lyrics')}" target="_blank">Lyrics</a>
            </div>
          </div>
        </div>
      `;
    });
  }

  function playTrack(youtubeId) {
    const track = tracks.find(t => t.youtubeId === youtubeId);
    if (!track) return;
    document.getElementById('mediaPlayer').style.display = 'block';
    document.getElementById('playerTrackTitle').textContent = `${track.title} - ${track.artist}`;
    document.getElementById('playerIframe').src = `https://www.youtube.com/embed/${track.youtubeId}?autoplay=1`;
    const lyricsLink = document.getElementById('lyricsLink');
    lyricsLink.href = `https://www.youtube.com/results?search_query=${encodeURIComponent(track.title + ' lyrics')}`;
    lyricsLink.style.display = 'inline';
  }

  function likeTrack(youtubeId) {
    likedTracks[youtubeId] = !likedTracks[youtubeId];
    localStorage.setItem('hertzLikedTracks', JSON.stringify(likedTracks));
    renderGenres();
    renderSearchResults(currentSearchResults);
  }

  const searchInput = document.getElementById('searchInput');
  const searchResults = document.getElementById('searchResults');
  let suggestionBox = null;
  let ytSuggestions = [];
  let suggestionIndex = -1;

  // --- Always show and update recommendations as user types ---
  function createSuggestionBox() {
    if (!suggestionBox) {
      suggestionBox = document.createElement('div');
      suggestionBox.id = 'ytSuggestionBox';
      suggestionBox.style.position = 'absolute';
      suggestionBox.style.background = '#232526';
      suggestionBox.style.color = '#fff';
      suggestionBox.style.borderRadius = '10px';
      suggestionBox.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
      suggestionBox.style.zIndex = '1001';
      suggestionBox.style.width = searchInput.offsetWidth + 'px';
      suggestionBox.style.maxWidth = '500px';
      suggestionBox.style.maxHeight = '300px';
      suggestionBox.style.overflowY = 'auto';
      suggestionBox.style.fontSize = '1rem';
      suggestionBox.style.left = searchInput.getBoundingClientRect().left + 'px';
      suggestionBox.style.top = (searchInput.getBoundingClientRect().bottom + window.scrollY) + 'px';
      document.body.appendChild(suggestionBox);
    }
  }

  function positionSuggestionBox() {
    if (suggestionBox) {
      suggestionBox.style.width = searchInput.offsetWidth + 'px';
      suggestionBox.style.left = searchInput.getBoundingClientRect().left + 'px';
      suggestionBox.style.top = (searchInput.getBoundingClientRect().bottom + window.scrollY) + 'px';
    }
  }

  // --- Robust YouTube Suggestions with API key rotation ---
  async function fetchYTSuggestions(query) {
    if (!query) {
      ytSuggestions = [];
      renderSuggestions();
      return;
    }
    let success = false;
    for (let i = 0; i < YT_API_KEYS.length; i++) {
      try {
        const key = getYTApiKey();
        const resp = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=7&q=${encodeURIComponent(query)}&key=${key}`);
        const data = await resp.json();
        if (data && data.items) {
          ytSuggestions = (data.items || []).map(item => ({
            title: item.snippet.title,
            videoId: item.id.videoId,
            channel: item.snippet.channelTitle,
            thumb: item.snippet.thumbnails && item.snippet.thumbnails.default ? item.snippet.thumbnails.default.url : ''
          }));
          success = true;
          break;
        }
      } catch (e) {
        // Try next key
      }
    }
    if (!success) ytSuggestions = [];
    renderSuggestions();
  }

  function renderSuggestions() {
    if (!suggestionBox) createSuggestionBox();
    if (!ytSuggestions.length) {
      suggestionBox.style.display = 'none';
      return;
    }
    suggestionBox.innerHTML = ytSuggestions.map((s, i) => `
      <div class="yt-suggestion-item${i===suggestionIndex?' active':''}" data-index="${i}" style="padding:0.7rem 1rem;">
        <img src="${s.thumb}" alt="" style="width:40px;height:40px;border-radius:6px;object-fit:cover;">
        <div>
          <div style="font-weight:600;">${s.title}</div>
          <div style="font-size:0.95em;color:#b3b3b3;">${s.channel}</div>
        </div>
      </div>
    `).join('');
    suggestionBox.style.display = 'block';
    positionSuggestionBox();
    suggestionBox.querySelectorAll('.yt-suggestion-item').forEach(item => {
      item.onclick = function() {
        const idx = parseInt(item.getAttribute('data-index'));
        selectSuggestion(idx);
      };
    });
  }

  function selectSuggestion(idx) {
    if (!ytSuggestions[idx]) return;
    searchInput.value = ytSuggestions[idx].title;
    suggestionBox.style.display = 'none';
    playYouTubeVideo(ytSuggestions[idx].videoId, ytSuggestions[idx].title);
  }

  function playYouTubeVideo(videoId, title) {
    document.getElementById('mediaPlayer').style.display = 'block';
    document.getElementById('playerTrackTitle').textContent = title;
    const iframe = document.getElementById('playerIframe');
    iframe.src = '';
    setTimeout(() => {
      iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
    }, 50);
    const lyricsLink = document.getElementById('lyricsLink');
    lyricsLink.href = `https://www.youtube.com/results?search_query=${encodeURIComponent(title + ' lyrics')}`;
    lyricsLink.style.display = 'inline';
    // Restore the user's search text in the search bar
    if (window.lastSearchText !== undefined) {
      searchInput.value = window.lastSearchText;
    }
    // Set the document title to the video title
    document.title = title + " - Hertz";
  }

  // --- Show recommendations as user types and on focus ---
  searchInput.addEventListener('input', function() {
    window.lastSearchText = searchInput.value; // Store the latest search text
    fetchYTSuggestions(searchInput.value.trim());
    suggestionIndex = -1;
  });

  searchInput.addEventListener('focus', function() {
    fetchYTSuggestions(searchInput.value.trim());
  });

  searchInput.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowDown' && ytSuggestions.length) {
      suggestionIndex = (suggestionIndex + 1) % ytSuggestions.length;
      renderSuggestions();
      e.preventDefault();
    } else if (e.key === 'ArrowUp' && ytSuggestions.length) {
      suggestionIndex = (suggestionIndex - 1 + ytSuggestions.length) % ytSuggestions.length;
      renderSuggestions();
      e.preventDefault();
    } else if (e.key === 'Enter') {
      if (ytSuggestions.length && suggestionIndex >= 0) {
        selectSuggestion(suggestionIndex);
        e.preventDefault();
      } else if (ytSuggestions.length) {
        selectSuggestion(0);
        e.preventDefault();
      } else {
        searchTracks();
        e.preventDefault();
      }
    }
  });

  document.addEventListener('mousedown', function(e) {
    if (suggestionBox && !suggestionBox.contains(e.target) && e.target !== searchInput) {
      suggestionBox.style.display = 'none';
    }
  });

  window.addEventListener('resize', positionSuggestionBox);

  // --- Robust YouTube Search with API key rotation ---
  let currentSearchResults = [];
  async function searchTracks() {
    const query = searchInput.value.trim();
    if (!query) {
      searchResults.innerHTML = '';
      return;
    }
    // Try local tracks first
    const localResults = tracks.filter(t =>
      t.title.toLowerCase().includes(query.toLowerCase()) ||
      t.artist.toLowerCase().includes(query.toLowerCase()) ||
      t.genre.toLowerCase().includes(query.toLowerCase())
    );
    if (localResults.length > 0) {
      currentSearchResults = localResults;
      renderSearchResults(localResults);
      return;
    }
    // If no local, fetch from YouTube
    let data = null;
    for (let i = 0; i < YT_API_KEYS.length; i++) {
      try {
        const key = getYTApiKey();
        const resp = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=5&q=${encodeURIComponent(query)}&key=${key}`);
        data = await resp.json();
        if (data && data.items && data.items.length) break;
      } catch (e) {
        // Try next key
      }
    }
    if (!data || !data.items || !data.items.length) {
      searchResults.innerHTML = '<div style="color:#b3b3b3;">No tracks found.</div>';
      return;
    }
    searchResults.innerHTML = data.items.map(item => `
      <div class="track" style="cursor:pointer;" onclick="playYouTubeVideo('${item.id.videoId}', '${item.snippet.title.replace(/'/g,"&#39;")}')">
        <img class="track-img" src="${item.snippet.thumbnails.default.url}" alt="${item.snippet.title}">
        <div>
          <div class="track-title">${item.snippet.title}</div>
          <div style="color:#b3b3b3;">${item.snippet.channelTitle}</div>
          <button style="background:#1db954;color:#181818;border:none;border-radius:20px;padding:0.2rem 1.1rem;font-size:0.97rem;cursor:pointer;font-weight:600;margin-top:0.5rem;">Play</button>
        </div>
      </div>
    `).join('');
  }

  function renderSearchResults(results) {
    const container = document.getElementById('searchResults');
    if (!results || results.length === 0) {
      container.innerHTML = '<div style="color:#b3b3b3;">No tracks found.</div>';
      return;
    }
    container.innerHTML = results.map(track => `
      <div class="track">
        <img class="track-img" src="${track.img}" alt="${track.title}">
        <div>
          <div class="track-title">${track.title} - ${track.artist} <span style="color:#1db954;font-size:0.95em;">(${track.genre})</span></div>
          <div>Likes: <span id="likes-${track.youtubeId}">${track.likes + (likedTracks[track.youtubeId] ? 1 : 0)}</span>
            <button class="like-btn${likedTracks[track.youtubeId] ? ' liked' : ''}" onclick="likeTrack('${track.youtubeId}')">&#9733;</button>
          </div>
          <button onclick="playTrack('${track.youtubeId}')">Play</button>
          <a class="lyrics-link" href="https://www.youtube.com/results?search_query=${encodeURIComponent(track.title + ' lyrics')}" target="_blank">Lyrics</a>
        </div>
      </div>
    `).join('');
  }

  // Expose for inline onclick
  window.playYouTubeVideo = playYouTubeVideo;

  // Initial render
  renderGenres();
  </script>
</body>
</html>