<html lang="en"><head>
  <meta charset="UTF-8">
  <title>HZ Liked Songs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CjxyYWRpYWxHcmFkaWVudCBpZD0iZ29sZGVuIiBjeD0iNTAlIiBjeT0iNTAlIiByPSI1MCUiPgo8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojRkZENzAwO3N0b3Atb3BhY2l0eToxIiAvPgo8c3RvcCBvZmZzZXQ9IjMwJSIgc3R5bGU9InN0b3AtY29sb3I6I0ZGQTUwMDtzdG9wLW9wYWNpdHk6MSIgLz4KPHN0b3Agb2Zmc2V0PSI3MCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNEQTdGMDA7c3RvcC1vcGFjaXR5OjEiIC8+CjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6Izg4NEQwMDtzdG9wLW9wYWNpdHk6MSIgLz4KPC9yYWRpYWxHcmFkaWVudD4KPC9kZWZzPgo8Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNiIgZmlsbD0idXJsKCNnb2xkZW4pIi8+CjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2LDE2KSI+CjxnPgo8cGF0aCBkPSJNLTEwIDAgTDEwIDAiIHN0cm9rZT0iI0ZGRDQ0NCIgc3Ryb2tlLXdpZHRoPSIwLjUiIG9wYWNpdHk9IjAuOCIvPgo8cGF0aCBkPSJNMCAtMTAgTDAgMTAiIHN0cm9rZT0iI0ZGRDQ0NCIgc3Ryb2tlLXdpZHRoPSIwLjUiIG9wYWNpdHk9IjAuOCIvPgo8L2c+CjxnIHRyYW5zZm9ybT0icm90YXRlKDQ1KSI+CjxwYXRoIGQ9Ik0tOCAwIEw4IDAiIHN0cm9rZT0iI0ZGRjY2NiIgc3Ryb2tlLXdpZHRoPSIwLjMiIG9wYWNpdHk9IjAuNiIvPgo8cGF0aCBkPSJNMCAtOCBMMCA4IiBzdHJva2U9IiNGRkY2NjYiIHN0cm9rZS13aWR0aD0iMC4zIiBvcGFjaXR5PSIwLjYiLz4KPC9nPgo8ZyB0cmFuc2Zvcm09InJvdGF0ZSgyMi41KSI+CjxwYXRoIGQ9Ik0tNiAwIEw2IDAiIHN0cm9rZT0iI0ZGRjg4OCIgc3Ryb2tlLXdpZHRoPSIwLjIiIG9wYWNpdHk9IjAuNCIvPgo8cGF0aCBkPSJNMCAtNiBMMCA2IiBzdHJva2U9IiNGRkY4ODgiIHN0cm9rZS13aWR0aD0iMC4yIiBvcGFjaXR5PSIwLjQiLz4KPC9nPgo8Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iMyIgZmlsbD0iI0ZGRjAwMCIgb3BhY2l0eT0iMC45Ii8+CjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIxLjUiIGZpbGw9IiNGRkZGRkYiIG9wYWNpdHk9IjAuOCIvPgo8L2c+Cjwvc3ZnPg==">
  <style>
    /* Exact sizing for liked tracks (matches Spotify/Apple Music) */
    .liked-track-card {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      background: #232526;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 0.8rem 1.2rem;
      margin-bottom: 1.1rem;
      min-height: 72px;
      max-height: 80px;
      width: 100%;
      transition: box-shadow 0.2s;
    }
    .liked-track-card:hover {
      box-shadow: 0 4px 16px rgba(29,185,84,0.18);
      background: #282828;
    }
    .liked-track-cover {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    }
    .liked-track-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-width: 0;
    }
    .liked-track-title {
      font-size: 1.08rem;
      font-weight: 600;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .liked-track-artist {
      font-size: 0.95rem;
      color: #b3b3b3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* Track Card Sizing for Liked Page (matches Spotify/Apple Music) */
    .liked-track-card {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      background: #232526;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 0.8rem 1.2rem;
      margin-bottom: 1.1rem;
      min-height: 72px;
      max-height: 80px;
      width: 100%;
      transition: box-shadow 0.2s;
    }
    .liked-track-card:hover {
      box-shadow: 0 4px 16px rgba(29,185,84,0.18);
      background: #282828;
    }
    .liked-track-cover {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    }
    .liked-track-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-width: 0;
    }
    .liked-track-title {
      font-size: 1.08rem;
      font-weight: 600;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .liked-track-artist {
      font-size: 0.95rem;
      color: #b3b3b3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* --- Professional, Appealing, Unified CSS --- */
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #181818;
      color: #fff;
      margin: 0;
    }
    header {
      position: sticky;
      top: 0;
      background: #121212;
      padding: 1rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .logo-btn {
      font-size: 1.7rem;
      font-weight: bold;
      color: #1db954;
      background: transparent;
      border: 2px solid #1db954;
      border-radius: 30px;
      padding: 0.4rem 1.6rem;
      text-decoration: none;
      letter-spacing: 2px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .logo-btn:hover, .logo-btn:focus {
      background: #0066ff;
      color: #fff;
      border-color: #0066ff;
      outline: none;
    }
    nav {
      display: flex;
      gap: 1rem;
    }
    nav a {
      text-decoration: none;
      color: #fff;
      background: #232526;
      padding: 0.6rem 1.4rem;
      border-radius: 30px;
      font-weight: 500;
      transition: background 0.2s, color 0.2s;
      border: 2px solid transparent;
    }
    nav a:hover, nav a.active {
      background: #1db954;
      color: #181818;
      border-color: #1db954;
    }
    .mobile-menu-btn {
      display: none;
      background: gold !important;
      color: black !important;
      border-color: gold !important;
      font-size: 1.5rem;
      padding: 0.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .mobile-menu-btn:hover, .mobile-menu-btn:focus {
      background: #ffd700 !important;
      color: black !important;
      border-color: #ffd700 !important;
    }
    .mobile-nav {
      display: none !important;
      position: absolute;
      top: calc(100% + 10px);
      left: 0;
      background: linear-gradient(135deg, #232526 0%, #181818 100%);
      border-radius: 15px;
      padding: 1rem;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      z-index: 3002;
      min-width: 250px;
      backdrop-filter: blur(10px);
      border: 1px solid #404040;
    }
    .mobile-nav.active {
      display: block !important;
    }
    .mobile-nav .nav-btn {
      width: 100%;
      margin: 0.2rem 0;
      font-size: 0.9rem;
      text-align: left;
      padding: 0.6rem 1rem;
      border-radius: 10px;
      background: linear-gradient(45deg, #1db954, #1ed760);
      color: #fff;
      border: none;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(29, 185, 84, 0.2);
      text-decoration: none;
    }
    .mobile-nav .nav-btn:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(29, 185, 84, 0.4);
    }
    .mobile-nav .nav-btn.active {
      background: linear-gradient(45deg, #0066ff, #4d94ff);
      box-shadow: 0 2px 8px rgba(0, 102, 255, 0.2);
    }
    .mobile-nav .nav-btn.active:hover {
      box-shadow: 0 4px 12px rgba(0, 102, 255, 0.4);
    }
    .hamburger-menu {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 2000;
      background: linear-gradient(45deg, #FFD700, #FFA500);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
    }
    .hamburger-menu:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
    }
    .hamburger-line {
      width: 20px;
      height: 2px;
      background: #000;
      border-radius: 1px;
      transition: all 0.3s ease;
    }
    .hamburger-menu.active .hamburger-line:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    .hamburger-menu.active .hamburger-line:nth-child(2) {
      opacity: 0;
    }
    .hamburger-menu.active .hamburger-line:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }
    .nav-dropdown {
      position: fixed;
      top: 80px;
      left: 20px;
      z-index: 1900;
      background: linear-gradient(145deg, #1a1a1a 0%, #2a2a2a 100%);
      border-radius: 15px;
      padding: 1rem;
      min-width: 200px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      border: 2px solid #404040;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-20px);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .nav-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    .nav-dropdown .nav-btn {
      display: block;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 0.5rem;
      text-align: left;
      padding: 0.8rem 1rem;
      border-radius: 8px;
      background: transparent;
      border: 1px solid transparent;
      transition: all 0.2s ease;
      text-decoration: none;
      color: #fff;
      font-size: 0.95rem;
      font-weight: 600;
      overflow: hidden;
    }
    .nav-dropdown .nav-btn:last-child {
      margin-bottom: 0;
    }
    .nav-dropdown .nav-btn:hover {
      background: linear-gradient(45deg, #FFD700, #FFA500);
      color: #000;
      transform: translateX(5px);
      border-color: #FFD700;
    }
    .nav-dropdown .nav-btn.active {
      background: linear-gradient(45deg, #0066ff, #4d94ff);
      color: #fff;
      border-color: #0066ff;
    }
    .nav-dropdown .nav-btn.active:hover {
      background: linear-gradient(45deg, #FFD700, #FFA500);
      color: #000;
      border-color: #FFD700;
    }
    .mobile-nav .close-btn {
      display: none;
    }
    .spacer { height: 20px; }
    /* --- Sticky Player Redesign --- */
#stickyPlayer {
  position: fixed;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  transform: none !important;
  width: 100vw !important;
  min-width: 100vw !important;
  height: 44px !important;
  min-height: 44px !important;
  border-radius: 0 !important;
  padding: 0 18px !important;
  box-shadow: 0 -2px 16px rgba(0,0,0,0.13);
}
#stickyPlayer .cover {
  width: 32px !important;
  height: 32px !important;
  border-radius: 8px !important;
  margin-right: 12px !important;
}
#stickyPlayer .info {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 2px;
}
#stickyPlayer .title {
  color: #fff;
  font-size: 1.02rem;
  font-weight: 600;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 100vw;
  width: 100%;
  flex: 1 1 auto;
  min-width: 0;
}
@media (max-width: 600px) {
  #stickyPlayer {
    padding: 0 6px !important;
  }
  #stickyPlayer .title {
    font-size: 0.97rem;
    max-width: 60vw;
  }
}
#stickyPlayer .artist {
  color: #b3b3b3;
  font-size: 0.93rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
#stickyPlayer .controls {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: 10px;
  height: 100%;
}
#stickyPlayer button {
  background: none !important;
  border: none !important;
  color: #fff !important;
  font-size: 1.15rem !important;
  cursor: pointer;
  padding: 0 6px !important;
  height: 32px !important;
  width: 32px !important;
  border-radius: 6px !important;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: none !important;
}
#stickyPlayer button:active {
  color: #FFD700 !important;
}
#stickyPlayer #stickyPlayPause {
  background: none !important;
  box-shadow: none !important;
}
#stickyPlayer #stickyPlayPause svg {
  background: none !important;
  border-radius: 0 !important;
  box-shadow: none !important;
}
#stickyTime {
  color: #FFD700;
  font-size: 0.98rem;
  margin-left: 10px;
  min-width: 60px;
  text-align: right;
  font-family: monospace;
  font-weight: 600;
}
    /* --- Popup Player Redesign --- */
#popupPlayer {
  position: fixed;
  left: 50%;
  bottom: 0;
  transform: translateX(-50%);
  width: 400px;
  height: 420px;
  background: rgba(24,24,24,0.99);
  border-radius: 24px 24px 0 0;
  box-shadow: 0 8px 32px rgba(0,0,0,0.22);
  display: none;
  flex-direction: column;
  align-items: center;
  z-index: 10000;
  padding: 0 0 18px 0;
}
#popupPlayer .cover {
  width: 180px;
  height: 180px;
  border-radius: 18px;
  background: #181818 url('HZ.png') center/cover no-repeat;
  margin-top: 32px;
  box-shadow: 0 4px 18px rgba(0,0,0,0.18);
}
#popupPlayer .info {
  margin-top: 18px;
  text-align: center;
}
#popupPlayer .title {
  color: #fff;
  font-size: 1.18rem;
  font-weight: 700;
  margin-bottom: 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
#popupPlayer .artist {
  color: #b3b3b3;
  font-size: 1.02rem;
  margin-bottom: 10px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
#popupPlayer .controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 18px;
  margin-top: 18px;
}
#popupPlayer button {
  background: none;
  border: none;
  color: #fff;
  font-size: 2.1rem;
  cursor: pointer;
  padding: 0 8px;
  transition: color 0.18s;
}
#popupPlayer button:active {
  color: #FFD700;
}
#popupPlayer .close {
  position: absolute;
  top: 18px;
  right: 18px;
  font-size: 1.5rem;
  color: #b3b3b3;
  background: none;
  border: none;
  cursor: pointer;
}
/* --- Sticky Player Button Color & Functionality --- */
stickyPlayerStyle.innerHTML += `
#stickyPlayer button, #stickyPlayer #stickyPlayPause, #stickyPlayer #stickyLoop, #stickyPlayer #stickyShuffle {
  background: none !important;
  color: #fff !important;
  box-shadow: none !important;
  border: none !important;
}
#stickyPlayer button:active {
  color: #FFD700 !important;
}
`;
    /* --- Popup Player Time Bar Like Spotify/Soundcloud --- */
popupPlayerStyle.innerHTML += `
#popupPlayer .time-bar {
  width: 90%;
  margin: 18px auto 0 auto;
  display: flex;
  align-items: center;
  gap: 10px;
}
#popupPlayer .time-current {
  color: #FFD700;
  font-size: 1.01rem;
  font-family: monospace;
  font-weight: 600;
  min-width: 48px;
  text-align: left;
}
#popupPlayer .time-total {
  color: #b3b3b3;
  font-size: 1.01rem;
  font-family: monospace;
  font-weight: 600;
  min-width: 48px;
  text-align: right;
}
#popupPlayer .progress {
  flex: 1;
  height: 4px;
  background: #333;
  border-radius: 2px;
  position: relative;
}
#popupPlayer .progress-filled {
  height: 100%;
  background: #FFD700;
  border-radius: 2px;
  position: absolute;
  left: 0;
  top: 0;
}
`;
  </style>
</head>
<body>
  <!-- Top Bar: Hamburger + Centered Title -->
  <header style="width:100%;display:flex;align-items:center;justify-content:center;position:relative;margin-top:1.5rem;margin-bottom:1.5rem;">
    <button class="hamburger-menu" id="hamburgerMenu" title="Open Menu" aria-label="Open navigation menu" style="position:absolute;left:0;top:50%;transform:translateY(-50%);margin-left:1.5rem;"><span class="hamburger-line"></span><span class="hamburger-line"></span><span class="hamburger-line"></span></button>
    <span style="font-size:2.3rem;font-weight:bold;color:gold;letter-spacing:2px;">HZ <span style='color:#ff4081;font-size:1.5rem;'>‚ù§Ô∏è</span> Liked Tracks</span>
  </header>

  <!-- Navigation Dropdown (hidden by default, will be populated by JS) -->
  <div class="nav-dropdown" id="navDropdown">
    <a href="index.html" class="nav-btn">üè† Home</a>
    <a href="Online25App.html" class="nav-btn">üåê Online</a>
    <a href="Offline25App.html" class="nav-btn">üì± Offline</a>
    <a href="Playlist25App.html" class="nav-btn">üìã Playlists</a>
    <a href="Liked25App.html" class="nav-btn active">‚ù§Ô∏è Liked</a>
    <a href="Account25App.html" class="nav-btn">üë§ Account</a>
    <a href="Settings25App.html" class="nav-btn">‚öôÔ∏è Settings</a>
    <button class="nav-btn" onclick="openDashboard()" style="width: 100%; text-align: left; cursor: pointer;">üìä Dashboard</button>
  </div>

  <!-- Sticky Player (copied and adapted from Playlist25App.html for professional look/functionality) -->
  <div class="sticky-player" id="stickyPlayer" style="position:fixed;bottom:0;left:0;right:0;z-index:1000;background:linear-gradient(90deg,#181818 0%,#232526 100%);border-top:1px solid #404040;padding:0.7rem 2rem;display:flex;align-items:center;gap:1.5rem;box-shadow:0 -2px 16px rgba(0,0,0,0.18);height:44px;min-height:44px;max-height:80px;">
  <div id="stickyPlayerMain" style="display:flex;align-items:center;width:100%;height:100%;cursor:pointer;">
      <div class="player-controls" style="display:flex;align-items:center;gap:1.1rem;">
  <button class="player-btn" id="stickyPrev" title="Previous" style="width:44px;height:44px;border-radius:50%;font-size:1.3rem;background:#232526;color:#fff;border:none;box-shadow:0 2px 8px rgba(0,0,0,0.12);transition:background 0.2s;">&#9198;</button>
  <button class="player-btn" id="stickyPlayPause" title="Play/Pause" style="width:54px;height:54px;border-radius:50%;font-size:1.5rem;background:#1db954;color:#fff;border:none;box-shadow:0 2px 8px rgba(29,185,84,0.18);transition:background 0.2s;">‚ñ∂Ô∏è</button>
  <button class="player-btn" id="stickyNext" title="Next" style="width:44px;height:44px;border-radius:50%;font-size:1.3rem;background:#232526;color:#fff;border:none;box-shadow:0 2px 8px rgba(0,0,0,0.12);transition:background 0.2s;">&#9197;</button>
        <button class="player-btn player-loop" id="loopBtn" title="Loop" style="width:38px;height:38px;border-radius:50%;font-size:1.1rem;background:#232526;color:#FFD700;border:none;box-shadow:0 2px 8px rgba(255,215,0,0.12);transition:background 0.2s;">&#128257;</button>
        <button class="player-btn player-shuffle" id="shuffleBtn" title="Shuffle" style="width:38px;height:38px;border-radius:50%;font-size:1.1rem;background:#232526;color:#FFD700;border:none;box-shadow:0 2px 8px rgba(255,215,0,0.12);transition:background 0.2s;">&#128256;</button>
        <label for="volumeRange" style="margin-left:1rem;color:#b3b3b3;font-size:0.95em;">Volume</label>
        <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="0.7" style="width:100px;">
      </div>
      <span class="player-title" id="playerTrackTitle"></span>
  <span id="playerArtist" style="margin-left:0.7rem;color:#b3b3b3;font-size:0.98em;"></span>
      <div style="display:flex;align-items:center;gap:0.7rem;width:320px;max-width:90%;">
        <span id="currentTime" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
        <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1" style="flex:1;">
        <span id="duration" style="font-size:0.95em;color:#b3b3b3;">0:00</span>
      </div>
      <button id="likeBtn" title="Like Track">&#10084;</button>
  <button id="stickyClose" title="Close Player" style="margin-left:1.2rem;background:none;border:none;color:#b3b3b3;font-size:1.3rem;cursor:pointer;">‚úñ</button>
    </div>
    <audio id="playerAudio" style="display:none;" preload="metadata"></audio>
  <script>
  // Sticky player controls
  document.addEventListener('DOMContentLoaded', function() {
    const stickyPlayer = document.getElementById('stickyPlayer');
    const playPauseBtn = document.getElementById('stickyPlayPause');
    const nextBtn = document.getElementById('stickyNext');
    const prevBtn = document.getElementById('stickyPrev');
    const closeBtn = document.getElementById('stickyClose');
    const audio = document.getElementById('playerAudio');
    const timeDisplay = document.getElementById('stickyTime');
    let currentTrackIndex = -1;
    function updatePlayPauseIcon() {
      playPauseBtn.textContent = audio.paused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
    }
    playPauseBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      if (audio.paused) {
        audio.play();
      } else {
        audio.pause();
      }
      updatePlayPauseIcon();
    });
    audio.addEventListener('play', updatePlayPauseIcon);
    audio.addEventListener('pause', updatePlayPauseIcon);
    nextBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      if (likedTracks.length > 0) {
        currentTrackIndex = (currentTrackIndex + 1) % likedTracks.length;
        playTrackInStickyPlayer(likedTracks[currentTrackIndex]);
      }
    });
    prevBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      if (likedTracks.length > 0) {
        currentTrackIndex = (currentTrackIndex - 1 + likedTracks.length) % likedTracks.length;
        playTrackInStickyPlayer(likedTracks[currentTrackIndex]);
      }
    });
    closeBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      stickyPlayer.style.display = 'none';
      audio.pause();
    });
    // Live track time display logic
const updateStickyTime = () => {
  if (!audio || !timeDisplay) return;
  const format = s => {
    if (!isFinite(s)) return '0:00';
    const m = Math.floor(s/60);
    const sec = Math.floor(s%60);
    return `${m}:${sec.toString().padStart(2,'0')}`;
  };
  timeDisplay.textContent = `${format(audio.currentTime)} / ${format(audio.duration||0)}`;
};
setInterval(updateStickyTime, 500);
audio.addEventListener('timeupdate', updateStickyTime);
audio.addEventListener('loadedmetadata', updateStickyTime);
audio.addEventListener('play', updateStickyTime);
audio.addEventListener('pause', updateStickyTime);
// When a track is played, update index
    window.playTrackInStickyPlayer = function(track, recursionDepth = 0) {
      const stickyPlayer = document.getElementById('stickyPlayer');
      const audio = document.getElementById('playerAudio');
      const idx = likedTracks.findIndex(t => t.id === track.id);
      if (idx !== -1) currentTrackIndex = idx;
      stickyPlayer.style.display = 'flex';
      document.getElementById('playerTrackTitle').textContent = track.name;
      document.getElementById('playerArtist').textContent = track.artist;
      let src = track.url && track.url.trim() ? track.url : '';
      const isOnline = src.startsWith('http://') || src.startsWith('https://');
      // If missing or not online, try to fill from featuredTracks
      if ((!src || !isOnline) && track.name) {
        // Try to match by name (case-insensitive, partial match)
        const match = featuredTracks.find(ft => ft.url.toLowerCase().includes(track.name.replace(/[^a-zA-Z0-9]/g, '').toLowerCase()));
        if (match) {
          src = match.url;
        }
      }
      if ((!src || !src.startsWith('http')) && track.id && recursionDepth < 2) {
        try {
          if (window.opener) {
            window.opener.postMessage({ type: 'hertz-request-track-url', id: track.id }, '*');
          } else if (window.parent && window.parent !== window) {
            window.parent.postMessage({ type: 'hertz-request-track-url', id: track.id }, '*');
          }
        } catch {}
        document.getElementById('playerTrackTitle').textContent = track.name + ' (Loading...)';
        document.getElementById('playerArtist').textContent = track.artist;
        stickyPlayer.dataset.currentTrack = JSON.stringify(track);
        return;
      }
      if (!src || !src.startsWith('http')) {
        alert('This track is only available offline and cannot be played in the browser.');
        src = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
      }
      if (audio.src !== src) {
        audio.src = src;
      }
      audio.currentTime = 0;
      audio.play();
      stickyPlayer.dataset.currentTrack = JSON.stringify(track);
      document.getElementById('popupPlayer').style.display = 'none';
      if (typeof updatePlayPauseIcon === 'function') updatePlayPauseIcon();
    }
  });
  </script>
  </div>
  <script>
  // Hamburger Menu Functionality (copied/adapted from Playlist25App.html)
  document.addEventListener('DOMContentLoaded', function() {
    const hamburgerBtn = document.getElementById('hamburgerMenu');
    const dropdown = document.getElementById('navDropdown');
    if (!hamburgerBtn || !dropdown) return;
    let isMenuOpen = false;
    function toggleMenu() {
      isMenuOpen = !isMenuOpen;
      if (isMenuOpen) {
        dropdown.classList.add('show');
        hamburgerBtn.classList.add('active');
        dropdown.style.display = 'flex';
      } else {
        dropdown.classList.remove('show');
        hamburgerBtn.classList.remove('active');
        dropdown.style.display = 'none';
      }
    }
    function closeMenu() {
      isMenuOpen = false;
      dropdown.classList.remove('show');
      hamburgerBtn.classList.remove('active');
      dropdown.style.display = 'none';
    }
    hamburgerBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      toggleMenu();
    });
    document.addEventListener('click', function(e) {
      if (isMenuOpen && !dropdown.contains(e.target) && !hamburgerBtn.contains(e.target)) {
        closeMenu();
      }
    });
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && isMenuOpen) {
        closeMenu();
      }
    });
    // Close when clicking navigation links
    const navLinks = dropdown.querySelectorAll('.nav-btn');
    navLinks.forEach(link => {
      link.addEventListener('click', closeMenu);
    });
    // Ensure correct display on load
    dropdown.style.display = 'none';
  });
  // Dummy openDashboard for nav button
  function openDashboard() { window.open('admin-dashboard.html', 'dashboard', 'width=1400,height=900,scrollbars=yes,resizable=yes'); }
  </script>

  <!-- Single Popup Player -->
  <div class="popup-backdrop" id="popupPlayer" style="display:none;">
    <div class="popup-player">
      <button onclick="closePopupPlayer()" style="position:absolute;top:20px;right:20px;background:none;border:none;color:#b3b3b3;font-size:24px;cursor:pointer;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all 0.2s;" onmouseover="this.style.color='#fff';this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.color='#b3b3b3';this.style.background='none'" title="Close">√ó</button>
      <button id="queueBtnPopup" class="popup-btn" aria-label="Queue" onclick="toggleQueue()" style="position:absolute;top:20px;left:20px;background:none;border:none;box-shadow:none;color:#1db954;font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:8px;width:32px;height:32px;border-radius:50%;transition:all 0.2s;" onmouseover="this.style.background='rgba(29,185,84,0.1)'" onmouseout="this.style.background='none'" title="Queue">
        <span style="display:inline-block;line-height:1;">
          <span style="display:block;height:2px;width:16px;background:currentColor;border-radius:2px;margin:2px 0;"></span>
          <span style="display:block;height:2px;width:16px;background:currentColor;border-radius:2px;margin:2px 0;"></span>
          <span style="display:block;height:2px;width:16px;background:currentColor;border-radius:2px;margin:2px 0;"></span>
        </span>
      </button>
      <!-- Bass Detection Control Button -->
      <button onclick="toggleBassDetection()" id="bassDetectionBtn" style="position:absolute;top:60px;left:20px;background:#333;border:2px solid #666;color:#999;font-size:10px;cursor:pointer;padding:4px 8px;border-radius:4px;font-weight:bold;" title="Enable Bass Detection (Currently Disabled for Stability)">BASS OFF</button>

      <!-- Vertical volume control on the right side -->
      <div style="position:absolute;right:60px;top:60px;bottom:60px;display:flex;flex-direction:column;align-items:center;gap:10px;">
        <svg width="16" height="16" fill="gold" viewBox="0 0 16 16"><path d="M9 4a1 1 0 0 0-2 0v4a1 1 0 0 0 2 0V4zM6 6a1 1 0 0 1 2 0v2a1 1 0 1 1-2 0V6zM5 9a1 1 0 0 0 2 0V7a1 1 0 0 0-2 0v2zm8-3a1 1 0 0 0-2 0v4a1 1 0 0 0 2 0V6z"></path></svg>
        <input type="range" id="popupVolumeRangeVertical" min="0" max="1" step="0.01" value="0.7" style="writing-mode:bt-lr;-webkit-appearance:slider-vertical;appearance:slider-vertical;width:6px;height:200px;background:gold;outline:none;border:none;border-radius:2px;">
      </div>
      <div style="display:flex;flex-direction:column;align-items:center;">
        <!-- Rotating gold HZ circle with live Hertz visualization -->
        <div id="popupCover" class="popup-cover" style="margin-bottom:0.8rem;display:flex;align-items:center;justify-content:center;background:transparent;border:none;box-shadow:none;width:120px;height:120px;">
          <!-- Live Hertz Waveform Visualization -->
          <div class="hertz-visualizer">
            <canvas id="hertzCanvas" width="140" height="140"></canvas>
          </div>
          <!-- Center HZ Circle -->
          <svg width="120" height="120" xmlns="http://www.w3.org/2000/svg" class="hz-circle" style="z-index: 2; position: relative;">
            <defs>
              <radialGradient id="goldenPopup" cx="50%" cy="50%" r="50%">
                <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1"></stop>
                <stop offset="30%" style="stop-color:#FFA500;stop-opacity:1"></stop>
                <stop offset="70%" style="stop-color:#DA7F00;stop-opacity:1"></stop>
                <stop offset="100%" style="stop-color:#884D00;stop-opacity:1"></stop>
              </radialGradient>
            </defs>
            <circle cx="60" cy="60" r="55" fill="url(#goldenPopup)"></circle>
            <text x="60" y="75" font-family="Arial, sans-serif" font-size="42" font-weight="bold" text-anchor="middle" fill="#000000">HZ</text>
          </svg>
        </div>
        <!-- Track name and artist info -->
        <div class="player-meta" style="margin-bottom:0.8rem;text-align:center;max-width:300px;">
          <div style="font-size:1.1rem;font-weight:600;color:#fff;margin-bottom:0.3rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" id="popupTitle">Track Name</div>
          <div style="font-size:0.9rem;color:#b3b3b3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" id="popupArtist">Artist Name</div>
        </div>
        <!-- Progress bar with Spotify-like styling -->
        <div class="player-progress" style="display:flex;align-items:center;justify-content:center;gap:0.8rem;margin-bottom:1rem;width:100%;max-width:300px;">
          <span id="popupCurrentTime" style="font-size:0.85rem;color:gold;min-width:35px;font-weight:600;">1:49</span>
          <input type="range" id="popupProgressBar" min="0" max="100" value="0" step="0.1" style="flex:1;height:4px;background:#404040;outline:none;border:none;border-radius:2px;-webkit-appearance:none;appearance:none;">
          <span id="popupDuration" style="font-size:0.85rem;color:gold;min-width:35px;font-weight:600;">1:49</span>
        </div>
        <!-- Spotify-like control buttons -->
        <div class="player-controls" style="display:flex;align-items:center;gap:1.5rem;margin-bottom:1rem;">
          <button id="popupShuffleBtn" class="player-btn" style="background:none;border:none;color:#b3b3b3;font-size:1rem;cursor:pointer;padding:8px;border-radius:50%;transition:all 0.2s;" title="Shuffle">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"></path><path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"></path></svg>
          </button>
          <button id="popupPrevBtn" class="player-btn" style="background:none;border:none;color:#b3b3b3;font-size:1.2rem;cursor:pointer;padding:8px;border-radius:50%;transition:all 0.2s;" title="Previous">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="m9.729 5.055a.5.5 0 0 0-.52.026L5 7.055a.5.5 0 0 0 0 .89l4.209 1.973A.5.5 0 0 0 10 9.5V6.5a.5.5 0 0 0-.271-.445z"></path></svg>
          </button>
          <button class="player-btn" id="popupPlayPauseBtn" style="background:none;border:none;color:#b3b3b3;font-size:1.5rem;cursor:pointer;padding:12px;border-radius:50%;transition:all 0.2s;width:48px;height:48px;display:flex;align-items:center;justify-content:center;" title="Play/Pause">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"></path></svg>
          </button>
          <button id="popupNextBtn" class="player-btn" style="background:none;border:none;color:#b3b3b3;font-size:1.2rem;cursor:pointer;padding:8px;border-radius:50%;transition:all 0.2s;" title="Next">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M6.271 5.055a.5.5 0 0 1 .52.026L11 7.055a.5.5 0 0 1 0 .89L6.791 9.919A.5.5 0 0 1 6 9.5V6.5a.5.5 0 0 1 .271-.445z"></path></svg>
          </button>
          <button id="popupLikeBtn" class="player-btn like-btn" style="background:none;border:none;color:#b3b3b3;font-size:1.2rem;cursor:pointer;padding:8px;border-radius:50%;transition:all 0.2s;position:relative;overflow:visible;" title="Like" onclick="togglePopupLike()">
            <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.011L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"></path></svg>
          </button>
          <button id="popupLoopBtn" class="player-btn" style="background:none;border:none;color:#b3b3b3;font-size:1rem;cursor:pointer;padding:8px;border-radius:50%;transition:all 0.2s;" title="Repeat">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966A.25.25 0 0 1 11 5.466zm-6 4.534V11h6a4 4 0 0 0 3.584-5.777.5.5 0 1 1 .896-.446A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.3.3 0 0 1 0-.384l2.36-1.966A.25.25 0 0 1 5 10.534z"></path></svg>
          </button>
        </div>
      </div>
    </div>
  <audio id="popupAudio" class="player-audio" src="https://storage.googleapis.com/hertz-music-folder/Believe%20Prod.%20Tedla.mp3" style="display: none;"></audio></div>

  <!-- Liked Tracks List -->
  <div class="liked-tracks" id="likedTracksList" style="display:flex;flex-direction:column;gap:1rem;max-width:700px;margin:2rem auto 0 auto;">
    <!-- Liked tracks will be rendered here by JS -->
  </div>
  </head>
  </html>
<script>
    // Utility: Format time in mm:ss
    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = Math.floor(seconds % 60);
      return m + ':' + (s < 10 ? '0' : '') + s;
    }

    // Sticky Player Controls
    document.addEventListener('DOMContentLoaded', function() {
      const audio = document.getElementById('playerAudio');
      const playPauseBtn = document.getElementById('playPauseBtn');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const progressBar = document.getElementById('progressBar');
      const currentTime = document.getElementById('currentTime');
      const duration = document.getElementById('duration');
      const volumeRange = document.getElementById('volumeRange');

      // Play/Pause
      playPauseBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (audio.paused) {
          audio.play();
        } else {
          audio.pause();
        }
      });

      // Update play/pause button icon based on playback
      audio.addEventListener('play', function() {
        playPauseBtn.innerHTML = '<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><rect x="3" y="2" width="3" height="12"/><rect x="10" y="2" width="3" height="12"/></svg>';
      });
      audio.addEventListener('pause', function() {
        playPauseBtn.innerHTML = '<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/></svg>';
      });

      // Progress bar update
      audio.addEventListener('timeupdate', function() {
        progressBar.value = audio.duration ? (audio.currentTime / audio.duration) * 100 : 0;
        currentTime.textContent = formatTime(audio.currentTime);
        duration.textContent = formatTime(audio.duration || 0);
      });
      progressBar.addEventListener('input', function(e) {
        if (audio.duration) {
          audio.currentTime = (progressBar.value / 100) * audio.duration;
        }
      });

      // Volume
      volumeRange.addEventListener('input', function() {
        audio.volume = volumeRange.value;
      });
      audio.volume = volumeRange.value;

      // Previous/Next (no playlist, just reset)
      prevBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        audio.currentTime = 0;
      });
      nextBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        audio.currentTime = audio.duration || 0;
      });

      // Ensure only one audio plays at a time (pause popup audio if sticky plays)
      audio.addEventListener('play', function() {
        const popupAudio = document.getElementById('popupAudio');
        if (popupAudio && !popupAudio.paused) popupAudio.pause();
      });
    });

    // --- Ensure playTrackInStickyPlayer always plays the selected track ---
    function playTrackInStickyPlayer(track, recursionDepth = 0) {
      const stickyPlayer = document.getElementById('stickyPlayer');
      stickyPlayer.style.display = 'flex';
      document.getElementById('playerTrackTitle').textContent = track.name;
      document.getElementById('playerArtist').textContent = track.artist;
      const audio = document.getElementById('playerAudio');
      let src = track.url && track.url.trim() ? track.url : '';
      // Check if the URL is likely to be online (http/https)
      const isOnline = src.startsWith('http://') || src.startsWith('https://');
      if ((!src || !isOnline) && track.name) {
        // Try to match by name (case-insensitive, partial match)
        const match = featuredTracks.find(ft => ft.url.toLowerCase().includes(track.name.replace(/[^a-zA-Z0-9]/g, '').toLowerCase()));
        if (match) {
          src = match.url;
        }
      }
      if ((!src || !src.startsWith('http')) && track.id && recursionDepth < 2) {
        // Request the correct URL from Playlist25App.html if possible
        try {
          if (window.opener) {
            window.opener.postMessage({ type: 'hertz-request-track-url', id: track.id }, '*');
          } else if (window.parent && window.parent !== window) {
            window.parent.postMessage({ type: 'hertz-request-track-url', id: track.id }, '*');
          }
        } catch {}
        // Show a loading message while waiting
        document.getElementById('playerTrackTitle').textContent = track.name + ' (Loading...)';
        document.getElementById('playerArtist').textContent = track.artist;
        // Save the current track in stickyPlayer for the handler
        stickyPlayer.dataset.currentTrack = JSON.stringify(track);
        return;
      }
      if (!src || !src.startsWith('http')) {
        // Fallback: Show a user-friendly message and use fallback audio
        alert('This track is only available offline and cannot be played in the browser.');
        src = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
      }
      if (audio.src !== src) {
        audio.src = src;
      }
      audio.currentTime = 0;
      audio.play(); // Always play the selected track
      stickyPlayer.dataset.currentTrack = JSON.stringify(track);
      document.getElementById('popupPlayer').style.display = 'none';
    }

    // --- Autoplay/user interaction logic (ported from Playlist25App.html) ---
if (typeof window.userHasInteracted === 'undefined') {
  window.userHasInteracted = false;
}
function enableAutoplay() {
  if (!window.userHasInteracted) {
    window.userHasInteracted = true;
    try {
      const silentAudio = new Audio();
      silentAudio.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAAAQQBgADAADAAxAAEAAEEiSgLDUAAA';
      silentAudio.volume = 0;
      silentAudio.play().catch(()=>{});
    } catch (e) {}
  }
}
function attemptAutoplay(audio, playPauseBtn) {
  if (!window.userHasInteracted) {
    return;
  }
  if (audio.readyState < 2) {
    window.autoplayTimeout = setTimeout(() => {
      attemptAutoplay(audio, playPauseBtn);
    }, 200);
    return;
  }
  audio.play().then(() => {
    if (playPauseBtn) playPauseBtn.textContent = '‚è∏Ô∏è';
  }).catch(()=>{});
}

// Load liked tracks from localStorage
let likedTracks = [];
function loadLikedTracks() {
  try {
    likedTracks = JSON.parse(localStorage.getItem('hertz_liked_tracks') || '[]');
  } catch {
    likedTracks = [];
  }
}

// Save liked tracks to localStorage
function saveLikedTracks() {
  localStorage.setItem('hertz_liked_tracks', JSON.stringify(likedTracks));
}

// Add a track to liked tracks
function addLikedTrack(track) {
  // Always ensure the liked track has a valid url (from url or audioUrl)
  let url = track.url || track.audioUrl || '';
  // If the track is from the DOM, try to get the data-track-url attribute
  if (!url && track.id) {
    const domItem = document.querySelector(`[data-track-id="${track.id}"]`);
    if (domItem) {
      url = domItem.getAttribute('data-track-url') || '';
    }
  }
  // If still no url, try to request it from Playlist25App.html via postMessage
  if (!url && track.id) {
    // Listen for URL via BroadcastChannel and postMessage
    let urlReceived = false;
    function handleUrlMessage(e) {
      let data = e.data;
      if (data && data.type === 'hertz-track-url' && data.id === track.id && data.url) {
        urlReceived = true;
        likedTracks = likedTracks.map(t => t.id === track.id ? { ...t, url: data.url } : t);
        saveLikedTracks();
        renderLikedTracks();
        // If the sticky player is waiting for this track, play it now
        const stickyPlayer = document.getElementById('stickyPlayer');
        if (stickyPlayer && stickyPlayer.dataset.currentTrack) {
          let waitingTrack = JSON.parse(stickyPlayer.dataset.currentTrack);
          if (waitingTrack.id === track.id) {
            playTrackInStickyPlayer({ ...waitingTrack, url: data.url });
          }
        }
        window.removeEventListener('message', handleUrlMessage);
        if (window.hertzLikedTracksChannel) {
          window.hertzLikedTracksChannel.removeEventListener('message', handleUrlMessage);
        }
      }
    }
    window.addEventListener('message', handleUrlMessage);
    // BroadcastChannel support
    if (!window.hertzLikedTracksChannel) {
      try {
        window.hertzLikedTracksChannel = new BroadcastChannel('hertz-liked-tracks');
      } catch {}
    }
    if (window.hertzLikedTracksChannel) {
      window.hertzLikedTracksChannel.addEventListener('message', handleUrlMessage);
    }
    // Send request to parent/opener (if exists) and via BroadcastChannel
    try {
      if (window.opener) {
        window.opener.postMessage({ type: 'hertz-request-track-url', id: track.id }, '*');
      } else if (window.parent && window.parent !== window) {
        window.parent.postMessage({ type: 'hertz-request-track-url', id: track.id }, '*');
      }
      if (window.hertzLikedTracksChannel) {
        window.hertzLikedTracksChannel.postMessage({ type: 'hertz-request-track-url', id: track.id });
      }
    } catch {}
  }
  const likedTrack = {
    ...track,
    url: url,
    likedAt: new Date().toISOString()
  };
  likedTracks.unshift(likedTrack);
  saveLikedTracks();
  renderLikedTracks();
  return true;
}

// Remove a track from liked tracks
function removeLikedTrack(trackId) {
  const index = likedTracks.findIndex(t => t.id === trackId);
  if (index > -1) {
    likedTracks.splice(index, 1);
    saveLikedTracks();
    renderLikedTracks();
    return true;
  }
  return false;
}

// Check if a track is liked
function isTrackLiked(trackId) {
  return likedTracks.some(t => t.id === trackId);
}

// Render liked tracks list
function renderLikedTracks() {
  const container = document.getElementById('likedTracksList');
  if (likedTracks.length === 0) {
    container.innerHTML = '<div class="empty-state">No liked songs yet. Start liking tracks from the music player!</div>';
    return;
  }
  let html = '';
  likedTracks.forEach(track => {
    const likedDate = new Date(track.likedAt).toLocaleDateString();
    const hasUrl = track.url && (track.url.startsWith('http://') || track.url.startsWith('https://'));
    html += `
      <div class="track-item pro-track" data-track-id="${track.id}" data-track-name="${track.name}" data-track-artist="${track.artist || 'Unknown Artist'}" data-track-url="${track.url || ''}" style="display:flex;align-items:center;gap:1.2rem;padding:1.1rem 1.5rem;background:#232526;border-radius:14px;box-shadow:0 2px 12px rgba(0,0,0,0.10);cursor:pointer;transition:box-shadow 0.18s,background 0.18s;position:relative;">
        <div class="track-cover" style="width:56px;height:56px;min-width:56px;min-height:56px;border-radius:10px;background:#181818;display:flex;align-items:center;justify-content:center;color:#FFD700;font-weight:bold;font-size:1.5rem;letter-spacing:2px;border:2px solid #FFD700;box-shadow:0 2px 8px rgba(255,215,0,0.13);">HZ</div>
        <div class="track-info" style="flex:1;min-width:0;display:flex;flex-direction:column;gap:0.2rem;">
          <div class="track-title" style="color:#fff;font-size:1.08rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${track.name}</div>
          <div class="track-artist" style="color:#b3b3b3;font-size:0.97rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${track.artist || 'Unknown Artist'}</div>
          <div class="track-date" style="color:#888;font-size:0.85rem;margin-top:0.1rem;">Liked on ${likedDate}</div>
          ${!hasUrl ? `<div style='color:#ff4081;font-size:0.92em;margin-top:0.2em;'>No online audio available</div>` : ''}
        </div>
        <button class="pro-play-btn" title="Play" style="background:linear-gradient(135deg,#FFD700,#FFA500);border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(255,215,0,0.13);cursor:pointer;transition:background 0.18s;outline:none;margin-right:0.7rem;" ${!hasUrl ? 'disabled style="opacity:0.5;pointer-events:none;"' : ''}>
          <svg width="20" height="20" fill="#181818" viewBox="0 0 16 16"><path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"></path></svg>
        </button>
        <button class="remove-btn pro-remove-btn" title="Remove from liked" onclick="removeLikedTrack('${track.id}');event.stopPropagation();" style="background:none;border:none;color:#ff4081;font-size:1.3rem;position:absolute;top:12px;right:12px;cursor:pointer;opacity:0.7;transition:opacity 0.15s;"><svg width="18" height="18" fill="#ff4081" viewBox="0 0 16 16"><path d="M2.146 2.146a.5.5 0 0 1 .708 0L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854a.5.5 0 0 1 0-.708z"/></svg></button>
      </div>
    `;
  });
  container.innerHTML = html;
  // Add click event listeners to play track in sticky player
  Array.from(container.getElementsByClassName('pro-track')).forEach(item => {
    function handlePlay(e) {
      if (e.target.closest('.remove-btn')) return;
      const url = item.getAttribute('data-track-url');
      const track = {
        id: item.getAttribute('data-track-id'),
        name: item.getAttribute('data-track-name'),
        artist: item.getAttribute('data-track-artist'),
        url: url
      };
      enableAutoplay();
      const idx = likedTracks.findIndex(t => t.id === track.id);
      if (idx !== -1) {
        window.currentTrackIndex = idx;
      }
      window.playTrackInStickyPlayer(track);
    }
    item.addEventListener('click', handlePlay);
    const playBtn = item.querySelector('.pro-play-btn');
    if (playBtn) {
      playBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        handlePlay(e);
      });
    }
  });
    }

    // --- Persistent handler for receiving track URLs from Playlist25App.html ---
window.addEventListener('message', function handleUrlMessage(e) {
  if (e.data && e.data.type === 'hertz-track-url' && e.data.id) {
    // Update the likedTracks array and save
    likedTracks = likedTracks.map(t => t.id === e.data.id ? { ...t, url: e.data.url } : t);
    saveLikedTracks();
    // If the sticky player is waiting for this track, play it now
    const stickyPlayer = document.getElementById('stickyPlayer');
    let currentTrack = null;
    try {
      currentTrack = JSON.parse(stickyPlayer.dataset.currentTrack || '{}');
    } catch {}
    if (currentTrack && currentTrack.id === e.data.id) {
      // Play the track with the new URL
      playTrackInStickyPlayer({ ...currentTrack, url: e.data.url }, 2);
    }
  }
});

    // Play track in sticky player and show it
    function playTrackInStickyPlayer(track, recursionDepth = 0) {
      const stickyPlayer = document.getElementById('stickyPlayer');
      stickyPlayer.style.display = 'flex';
      document.getElementById('playerTrackTitle').textContent = track.name;
      document.getElementById('playerArtist').textContent = track.artist;
      const audio = document.getElementById('playerAudio');
      let src = track.url && track.url.trim() ? track.url : '';
      // Check if the URL is likely to be online (http/https)
      const isOnline = src.startsWith('http://') || src.startsWith('https://');
      if ((!src || !isOnline) && track.name) {
        // Try to match by name (case-insensitive, partial match)
        const match = featuredTracks.find(ft => ft.url.toLowerCase().includes(track.name.replace(/[^a-zA-Z0-9]/g, '').toLowerCase()));
        if (match) {
          src = match.url;
        }
      }
      if ((!src || !src.startsWith('http')) && track.id && recursionDepth < 2) {
        // Request the correct URL from Playlist25App.html if possible
        try {
          if (window.opener) {
            window.opener.postMessage({ type: 'hertz-request-track-url', id: track.id }, '*');
          } else if (window.parent && window.parent !== window) {
            window.parent.postMessage({ type: 'hertz-request-track-url', id: track.id }, '*');
          }
        } catch {}
        // Show a loading message while waiting
        document.getElementById('playerTrackTitle').textContent = track.name + ' (Loading...)';
        document.getElementById('playerArtist').textContent = track.artist;
        // Save the current track in stickyPlayer for the handler
        stickyPlayer.dataset.currentTrack = JSON.stringify(track);
        return;
      }
      if (!src || !src.startsWith('http')) {
        alert('This track is only available offline and cannot be played in the browser.');
        src = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
      }
      if (audio.src !== src) {
        audio.src = src;
      }
      audio.currentTime = 0;
      audio.play();
      stickyPlayer.dataset.currentTrack = JSON.stringify(track);
      document.getElementById('popupPlayer').style.display = 'none';
    }

    // Sticky player click: open popup player if not clicking a control
    document.addEventListener('DOMContentLoaded', function() {
      const stickyPlayer = document.getElementById('stickyPlayer');
      const playPauseBtn = document.getElementById('stickyPlayPause');
      const closeBtn = document.getElementById('stickyClose');
      const audio = document.getElementById('playerAudio');
      // Play/Pause button
      playPauseBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (audio.paused) {
          audio.play();
          playPauseBtn.textContent = '‚è∏Ô∏è';
        } else {
          audio.pause();
          playPauseBtn.textContent = '‚ñ∂Ô∏è';
        }
      });
      // Close button
      closeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        stickyPlayer.style.display = 'none';
        audio.pause();
      });
      // Always show popup player on sticky click (not on buttons)
      stickyPlayer.addEventListener('click', function(e) {
        if (e.target.closest('button') || e.target.tagName === 'INPUT') return;
        const popup = document.getElementById('popupPlayer');
        const popupAudio = document.getElementById('popupAudio');
        const popupTitle = document.getElementById('popupTrackTitle');
        const popupArtist = document.getElementById('popupArtist');
        // Get current track from sticky
        let track = null;
        try {
          track = JSON.parse(stickyPlayer.dataset.currentTrack || '{}');
        } catch {}
        if (track && track.name) {
          popupTitle.textContent = track.name;
          popupArtist.textContent = track.artist || '';
          let src = track.url && track.url.trim() ? track.url : '';
          if (!src) src = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
          popupAudio.src = src;
          popupAudio.currentTime = audio.currentTime;
          if (!popupAudio.paused) popupAudio.pause();
        }
        popup.style.display = 'block';
      });
      // Popup close
      document.getElementById('popupClose').addEventListener('click', function() {
        document.getElementById('popupPlayer').style.display = 'none';
        document.getElementById('popupAudio').pause();
      });
    });


    // Always display liked tracks instantly and clearly
    function syncAndRenderLikedTracks() {
      loadLikedTracks();
      renderLikedTracks();
    }

    // On page load, render immediately
    syncAndRenderLikedTracks();

    // Also keep the old DOMContentLoaded for safety
    document.addEventListener('DOMContentLoaded', function() {
      syncAndRenderLikedTracks();
      window.addEventListener('storage', function(e) {
        const relevantKeys = [
          'hertz_liked_tracks',
          'hertzLikedTracks',
          'likedTracks',
          'playlistLikedTracks',
          'hertzLikedTracksUpdate'
        ];
        if (relevantKeys.includes(e.key)) {
          syncAndRenderLikedTracks();
        }
      });
    });

    // Expose functions to window for external access
    window.addLikedTrack = addLikedTrack;
    window.removeLikedTrack = removeLikedTrack;
    window.isTrackLiked = isTrackLiked;

    // Add: Like button handler for popup player
    window.togglePopupLike = function() {
      // Get the current track from the popup player UI
      const popupTitle = document.getElementById('popupTitle');
                     const popupArtist = document.getElementById('popupArtist');
      const popupAudio = document.getElementById('popupAudio');
      // Try to get the track info from the sticky player if available
      let track = null;

      try {
        const stickyPlayer = document.getElementById('stickyPlayer');
        if (stickyPlayer && stickyPlayer.dataset.currentTrack) {
          track = JSON.parse(stickyPlayer.dataset.currentTrack);
        }
      } catch {}
      // Fallback: build track from popup UI
      if (!track || !track.name) {
        track = {
          id: popupTitle.textContent.replace(/\s+/g, '_').toLowerCase() + '_' + Date.now(),
          name: popupTitle.textContent,
          artist: popupArtist.textContent,
          url: popupAudio.src || '',
        };
      } else {
        // Always update url to current popup audio src
        track.url = popupAudio.src || track.url || '';
      }
      // Add to liked tracks
      addLikedTrack(track);
    };



</script>
</body>
</html>
